/**
 * almond 0.0.3 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*!
 * JavaScript Cookie v2.0.4
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */

//     (c) 2010-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*!
 * jsUri
 * https://github.com/derek-watson/jsUri
 *
 * Copyright 2013, Derek Watson
 * Released under the MIT license.
 *
 * Includes parseUri regular expressions
 * http://blog.stevenlevithan.com/archives/parseuri
 * Copyright 2007, Steven Levithan
 * Released under the MIT license.
 */

/* Web Font Loader v1.6.16 - (c) Adobe Systems, Google. License: Apache 2.0 */

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */

/*! tocca v1.0.0 || Gianluca Guarini */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*

 The MIT License

 Copyright (c) 2007 Cybozu Labs, Inc.
 Copyright (c) 2012 Google Inc.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 IN THE SOFTWARE.
*/

/**
     * Copyright 2012, Digital Fusion
     * Licensed under the MIT license.
     * http://teamdf.com/jquery-plugins/license/
     *
     * @author Sam Sehnert
     * @desc A small plugin that checks whether elements are within
     *       the user visible viewport of a web browser.
     *       can accounts for vertical position, horizontal, or both
     */

(function(w){var IEVersion=-1;if(w.navigator.appName=="Microsoft Internet Explorer"){var ua=w.navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");re.exec(ua)!=null&&(IEVersion=parseFloat(RegExp.$1))}if(IEVersion<=9&&IEVersion!=-1)return!1;try{w.glzOldDefine=w.define,delete w.define}catch(er){}var requirejs,require,define;(function(e){function o(e,t){if(e&&e.charAt(0)==="."&&t){t=t.split("/"),t=t.slice(0,t.length-1),e=t.concat(e.split("/"));var n,r;for(n=0;r=e[n];n++)if(r===".")e.splice(n,1),n-=1;else if(r===".."){if(n===1&&(e[2]===".."||e[0]===".."))break;n>0&&(e.splice(n-1,2),n-=2)}e=e.join("/")}return e}function u(t,n){return function(){return s.apply(e,r.call(arguments,0).concat([t,n]))}}function a(e){return function(t){return o(t,e)}}function f(e){return function(n){t[e]=n}}function l(r){if(n.hasOwnProperty(r)){var s=n[r];delete n[r],i.apply(e,s)}return t[r]}function c(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=o(e.slice(0,i),t),e=e.slice(i+1),r=l(n),r&&r.normalize?e=r.normalize(e,a(t)):e=o(e,t)):e=o(e,t),{f:n?n+"!"+e:e,n:e,p:r}}var t={},n={},r=[].slice,i,s;if(typeof define=="function")return;i=function(r,i,s,o){var a=[],h,p,d,v,m,g;o||(o=r);if(typeof s=="function"){!i.length&&s.length&&(i=["require","exports","module"]);for(v=0;v<i.length;v++){g=c(i[v],o),d=g.f;if(d==="require")a[v]=u(r);else if(d==="exports")a[v]=t[r]={},h=!0;else if(d==="module")p=a[v]={id:r,uri:"",exports:t[r]};else if(t.hasOwnProperty(d)||n.hasOwnProperty(d))a[v]=l(d);else{if(!g.p)throw r+" missing "+d;g.p.load(g.n,u(o,!0),f(d),{}),a[v]=t[d]}}m=s.apply(t[r],a),r&&(p&&p.exports!==e?t[r]=p.exports:h||(t[r]=m))}else r&&(t[r]=s)},requirejs=s=function(t,n,r,o){return typeof t=="string"?l(c(t,n).f):(t.splice||(n.splice?(t=n,n=arguments[2]):t=[]),o?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},15),s)},s.config=function(){return s},require||(require=s),define=function(e,t,r){t.splice||(r=t,t=[]),define.unordered?n[e]=[e,t,r]:i(e,t,r)},define.amd={jQuery:!0}})(),define("../lib/almond",function(){}),define("jquery",["require"],function(e){if(window.$||window.jQuery)return window.$||window.jQuery;throw new Error("jQuery was not found")}),function(){function x(e){function t(t,n,r,i,s,o){for(;s>=0&&s<o;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=v(r,s,4);var o=!S(n)&&d.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function C(e){return function(t,n,r){n=m(n,r);var i=E(t),s=e>0?0:i-1;for(;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}function k(e,t,n){return function(r,i,s){var u=0,a=E(r);if(typeof s=="number")e>0?u=s>=0?s:Math.max(s+a,u):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(o.call(r,u,a),d.isNaN),s>=0?s+u:-1;for(s=e>0?u:a-1;s>=0&&s<a;s+=e)if(r[s]===i)return s;return-1}}function M(e,t){var n=O.length,i=e.constructor,s=d.isFunction(i)&&i.prototype||r,o="constructor";d.has(e,o)&&!d.contains(t,o)&&t.push(o);while(n--)o=O[n],o in e&&e[o]!==s[o]&&!d.contains(t,o)&&t.push(o)}var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=r.toString,a=r.hasOwnProperty,f=Array.isArray,l=Object.keys,c=i.bind,h=Object.create,p=function(){},d=function(e){if(e instanceof d)return e;if(!(this instanceof d))return new d(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=d),exports._=d):e._=d,d.VERSION="1.8.3";var v=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},m=function(e,t,n){return e==null?d.identity:d.isFunction(e)?v(e,t,n):d.isObject(e)?d.matcher(e):d.property(e)};d.iteratee=function(e,t){return m(e,t,Infinity)};var g=function(e,t){return function(n){var r=arguments.length;if(r<2||n==null)return n;for(var i=1;i<r;i++){var s=arguments[i],o=e(s),u=o.length;for(var a=0;a<u;a++){var f=o[a];if(!t||n[f]===void 0)n[f]=s[f]}}return n}},y=function(e){if(!d.isObject(e))return{};if(h)return h(e);p.prototype=e;var t=new p;return p.prototype=null,t},b=function(e){return function(t){return t==null?void 0:t[e]}},w=Math.pow(2,53)-1,E=b("length"),S=function(e){var t=E(e);return typeof t=="number"&&t>=0&&t<=w};d.each=d.forEach=function(e,t,n){t=v(t,n);var r,i;if(S(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=d.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},d.map=d.collect=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length,s=Array(i);for(var o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},d.reduce=d.foldl=d.inject=x(1),d.reduceRight=d.foldr=x(-1),d.find=d.detect=function(e,t,n){var r;S(e)?r=d.findIndex(e,t,n):r=d.findKey(e,t,n);if(r!==void 0&&r!==-1)return e[r]},d.filter=d.select=function(e,t,n){var r=[];return t=m(t,n),d.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},d.reject=function(e,t,n){return d.filter(e,d.negate(m(t)),n)},d.every=d.all=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},d.some=d.any=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},d.contains=d.includes=d.include=function(e,t,n,r){S(e)||(e=d.values(e));if(typeof n!="number"||r)n=0;return d.indexOf(e,t,n)>=0},d.invoke=function(e,t){var n=o.call(arguments,2),r=d.isFunction(t);return d.map(e,function(e){var i=r?t:e[t];return i==null?i:i.apply(e,n)})},d.pluck=function(e,t){return d.map(e,d.property(t))},d.where=function(e,t){return d.filter(e,d.matcher(t))},d.findWhere=function(e,t){return d.find(e,d.matcher(t))},d.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=S(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},d.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=S(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},d.shuffle=function(e){var t=S(e)?e:d.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=d.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},d.sample=function(e,t,n){return t==null||n?(S(e)||(e=d.values(e)),e[d.random(e.length-1)]):d.shuffle(e).slice(0,Math.max(0,t))},d.sortBy=function(e,t,n){return t=m(t,n),d.pluck(d.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var T=function(e){return function(t,n,r){var i={};return n=m(n,r),d.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};d.groupBy=T(function(e,t,n){d.has(e,n)?e[n].push(t):e[n]=[t]}),d.indexBy=T(function(e,t,n){e[n]=t}),d.countBy=T(function(e,t,n){d.has(e,n)?e[n]++:e[n]=1}),d.toArray=function(e){return e?d.isArray(e)?o.call(e):S(e)?d.map(e,d.identity):d.values(e):[]},d.size=function(e){return e==null?0:S(e)?e.length:d.keys(e).length},d.partition=function(e,t,n){t=m(t,n);var r=[],i=[];return d.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},d.first=d.head=d.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:d.initial(e,e.length-t)},d.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},d.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:d.rest(e,Math.max(0,e.length-t))},d.rest=d.tail=d.drop=function(e,t,n){return o.call(e,t==null||n?1:t)},d.compact=function(e){return d.filter(e,d.identity)};var N=function(e,t,n,r){var i=[],s=0;for(var o=r||0,u=E(e);o<u;o++){var a=e[o];if(S(a)&&(d.isArray(a)||d.isArguments(a))){t||(a=N(a,t,n));var f=0,l=a.length;i.length+=l;while(f<l)i[s++]=a[f++]}else n||(i[s++]=a)}return i};d.flatten=function(e,t){return N(e,t,!1)},d.without=function(e){return d.difference(e,o.call(arguments,1))},d.uniq=d.unique=function(e,t,n,r){d.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=m(n,r));var i=[],s=[];for(var o=0,u=E(e);o<u;o++){var a=e[o],f=n?n(a,o,e):a;t?((!o||s!==f)&&i.push(a),s=f):n?d.contains(s,f)||(s.push(f),i.push(a)):d.contains(i,a)||i.push(a)}return i},d.union=function(){return d.uniq(N(arguments,!0,!0))},d.intersection=function(e){var t=[],n=arguments.length;for(var r=0,i=E(e);r<i;r++){var s=e[r];if(d.contains(t,s))continue;for(var o=1;o<n;o++)if(!d.contains(arguments[o],s))break;o===n&&t.push(s)}return t},d.difference=function(e){var t=N(arguments,!0,!0,1);return d.filter(e,function(e){return!d.contains(t,e)})},d.zip=function(){return d.unzip(arguments)},d.unzip=function(e){var t=e&&d.max(e,E).length||0,n=Array(t);for(var r=0;r<t;r++)n[r]=d.pluck(e,r);return n},d.object=function(e,t){var n={};for(var r=0,i=E(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},d.findIndex=C(1),d.findLastIndex=C(-1),d.sortedIndex=function(e,t,n,r){n=m(n,r,1);var i=n(t),s=0,o=E(e);while(s<o){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},d.indexOf=k(1,d.findIndex,d.sortedIndex),d.lastIndexOf=k(-1,d.findLastIndex),d.range=function(e,t,n){t==null&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var L=function(e,t,n,r,i){if(r instanceof t){var s=y(e.prototype),o=e.apply(s,i);return d.isObject(o)?o:s}return e.apply(n,i)};d.bind=function(e,t){if(c&&e.bind===c)return c.apply(e,o.call(arguments,1));if(!d.isFunction(e))throw new TypeError("Bind must be called on a function");var n=o.call(arguments,2),r=function(){return L(e,r,t,this,n.concat(o.call(arguments)))};return r},d.partial=function(e){var t=o.call(arguments,1),n=function(){var r=0,i=t.length,s=Array(i);for(var o=0;o<i;o++)s[o]=t[o]===d?arguments[r++]:t[o];while(r<arguments.length)s.push(arguments[r++]);return L(e,n,this,this,s)};return n},d.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=d.bind(e[r],e);return e},d.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return d.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},d.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},d.defer=d.partial(d.delay,d,1),d.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:d.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=d.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},d.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=d.now()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=d.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},d.wrap=function(e,t){return d.partial(t,e)},d.negate=function(e){return function(){return!e.apply(this,arguments)}},d.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},d.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},d.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},d.once=d.partial(d.before,2);var A=!{toString:null}.propertyIsEnumerable("toString"),O=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];d.keys=function(e){if(!d.isObject(e))return[];if(l)return l(e);var t=[];for(var n in e)d.has(e,n)&&t.push(n);return A&&M(e,t),t},d.allKeys=function(e){if(!d.isObject(e))return[];var t=[];for(var n in e)t.push(n);return A&&M(e,t),t},d.values=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},d.mapObject=function(e,t,n){t=m(t,n);var r=d.keys(e),i=r.length,s={},o;for(var u=0;u<i;u++)o=r[u],s[o]=t(e[o],o,e);return s},d.pairs=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},d.invert=function(e){var t={},n=d.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},d.functions=d.methods=function(e){var t=[];for(var n in e)d.isFunction(e[n])&&t.push(n);return t.sort()},d.extend=g(d.allKeys),d.extendOwn=d.assign=g(d.keys),d.findKey=function(e,t,n){t=m(t,n);var r=d.keys(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s];if(t(e[i],i,e))return i}},d.pick=function(e,t,n){var r={},i=e,s,o;if(i==null)return r;d.isFunction(t)?(o=d.allKeys(i),s=v(t,n)):(o=N(arguments,!1,!1,1),s=function(e,t,n){return t in n},i=Object(i));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=i[f];s(l,f,i)&&(r[f]=l)}return r},d.omit=function(e,t,n){if(d.isFunction(t))t=d.negate(t);else{var r=d.map(N(arguments,!1,!1,1),String);t=function(e,t){return!d.contains(r,t)}}return d.pick(e,t,n)},d.defaults=g(d.allKeys,!0),d.create=function(e,t){var n=y(e);return t&&d.extendOwn(n,t),n},d.clone=function(e){return d.isObject(e)?d.isArray(e)?e.slice():d.extend({},e):e},d.tap=function(e,t){return t(e),e},d.isMatch=function(e,t){var n=d.keys(t),r=n.length;if(e==null)return!r;var i=Object(e);for(var s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var _=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var i=u.call(e);if(i!==u.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s=i==="[object Array]";if(!s){if(typeof e!="object"||typeof t!="object")return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(d.isFunction(o)&&o instanceof o&&d.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];var f=n.length;while(f--)if(n[f]===e)return r[f]===t;n.push(e),r.push(t);if(s){f=e.length;if(f!==t.length)return!1;while(f--)if(!_(e[f],t[f],n,r))return!1}else{var l=d.keys(e),c;f=l.length;if(d.keys(t).length!==f)return!1;while(f--){c=l[f];if(!d.has(t,c)||!_(e[c],t[c],n,r))return!1}}return n.pop(),r.pop(),!0};d.isEqual=function(e,t){return _(e,t)},d.isEmpty=function(e){return e==null?!0:S(e)&&(d.isArray(e)||d.isString(e)||d.isArguments(e))?e.length===0:d.keys(e).length===0},d.isElement=function(e){return!!e&&e.nodeType===1},d.isArray=f||function(e){return u.call(e)==="[object Array]"},d.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},d.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){d["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),d.isArguments(arguments)||(d.isArguments=function(e){return d.has(e,"callee")}),typeof /./!="function"&&typeof Int8Array!="object"&&(d.isFunction=function(e){return typeof e=="function"||!1}),d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},d.isNaN=function(e){return d.isNumber(e)&&e!==+e},d.isBoolean=function(e){return e===!0||e===!1||u.call(e)==="[object Boolean]"},d.isNull=function(e){return e===null},d.isUndefined=function(e){return e===void 0},d.has=function(e,t){return e!=null&&a.call(e,t)},d.noConflict=function(){return e._=t,this},d.identity=function(e){return e},d.constant=function(e){return function(){return e}},d.noop=function(){},d.property=b,d.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}},d.matcher=d.matches=function(e){return e=d.extendOwn({},e),function(t){return d.isMatch(t,e)}},d.times=function(e,t,n){var r=Array(Math.max(0,e));t=v(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},d.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},d.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},P=d.invert(D),H=function(e){var t=function(t){return e[t]},n="(?:"+d.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};d.escape=H(D),d.unescape=H(P),d.result=function(e,t,n){var r=e==null?void 0:e[t];return r===void 0&&(r=n),d.isFunction(r)?r.call(e):r};var B=0;d.uniqueId=function(e){var t=++B+"";return e?e+t:t},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+F[e]};d.template=function(e,t,n){!t&&n&&(t=n),t=d.defaults({},t,d.templateSettings);var r=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(I,q),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,d)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},d.chain=function(e){var t=d(e);return t._chain=!0,t};var R=function(e,t){return e._chain?d(t).chain():t};d.mixin=function(e){d.each(d.functions(e),function(t){var n=d[t]=e[t];d.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),R(this,n.apply(d,e))}})},d.mixin(d),d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];d.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],R(this,n)}}),d.each(["concat","join","slice"],function(e){var t=n[e];d.prototype[e]=function(){return R(this,t.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},d.prototype.valueOf=d.prototype.toJSON=d.prototype.value,d.prototype.toString=function(){return""+this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return d})}.call(this),define("underscoreprivate",["require","underscore"],function(e){var t=e("underscore");return t.noConflict()}),define("Settings",["require"],function(e){return{cssPath:"/snippet/snippet.min.css",cssDevPath:"/dev-snippet/snippet.min.css",googleFonts:"//fonts.googleapis.com/css?family=Open+Sans|Roboto|Slabo+27px|Lato|Oswald|Lora|PT+Sans|Montserrat|Raleway|Ubuntu|Arimo|Noto+Sans",ajaxTimeout:7e3,minWindowWidth:320,glazeAutosaveInterval:6e4,glazeAutoScrollOffset:30,glazeAutoScrollSpeed:0,glazeMobileIntentTimeout:3e3,glazeDataStorageKey:"glz_data",glazeDataStorageTTL:3024e7,api:{clientData:"/api/track/init",responseTime:"/api/track/responseTime",trackingShow:"/api/track/show",trackingConversion:"/api/track/conversion",trackingVtc:"/api/track/vtc",trackingAbandon:"/api/track/abandon",trackingRestart:"/api/track/restart",user:"/api/user",notification:"/api/notifications/no-element"},defaultGlazeSettings:{timer_in:5e3,timer_out:1e4,opacity:".5"},excludedFonts:["Arial","Helvetica Neue","Sans Serif"]}}),define("utils/Logger",["require","jquery","underscore","Settings"],function(e){var t=e("jquery"),n=e("underscore"),r=e("Settings");return{queue:[],launched:!1,console:null,log:function(e,t){t=t||!1;if(!this.launched)this.queue.push({args:arguments});else{t&&(arguments=[arguments[0]],arguments[0]+=" %c"+t.title+" %c"+"("+t.campaign_title+")",arguments.push("color: red;"),arguments.push("color: blue;"));if(!window.console||!window.console.log){var n=document.createElement("iframe");n.style.display="none",document.body.appendChild(n),this.console=n.contentWindow.console}else this.console=window.console;this.console.log.apply(null,arguments)}},launch:function(){this.launched=!0,window._glazeLogger=this,this.log("Glaze: logger available"),n.each(this.queue,n.bind(function(e){this.log.apply(this,e.args)},this))}}}),define("utils/MiscUtils",["require","jquery","underscore","Settings","utils/Logger"],function(e){var t=e("jquery"),n=e("underscore"),r=e("Settings"),i=e("utils/Logger"),s={easeInOutQuad:function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},getParameterByName:function(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=n.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},eraseCookieFromAllPaths:function(e){var t=location.pathname.split("/"),n=" path=";document.cookie=e+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT;";for(var r=0;r<t.length;r++)n+=(n.substr(-1)!="/"?"/":"")+t[r],document.cookie=e+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT;"+n+";"},checkStorageAvailability:function(){var e="glaze_storage_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch(t){return!1}},localStorage:function(){return this.checkStorageAvailability()?window.localStorage:{setItem:function(){},getItem:function(){},clear:function(){}}},sessionStorage:function(){return this.checkStorageAvailability()?window.sessionStorage:{setItem:function(){},getItem:function(){}}},similarity:function(e,t){var n=e,r=t;e.length<t.length&&(n=t,r=e);var i=n.length;return i==0?1:(i-this.editDistance(n,r))/parseFloat(i)},editDistance:function(e,t){e=e.toLowerCase(),t=t.toLowerCase();var n=[];for(var r=0;r<=e.length;r++){var i=r;for(var s=0;s<=t.length;s++)if(r==0)n[s]=s;else if(s>0){var o=n[s-1];e.charAt(r-1)!=t.charAt(s-1)&&(o=Math.min(Math.min(o,i),n[s])+1),n[s-1]=i,i=o}r>0&&(n[t.length]=i)}return n[t.length]},reportInitTime:function(e){t.ajax({type:"post",url:r.apiHost+r.api.responseTime,data:{response_time:e},crossDomain:!0,timeout:r.ajaxTimeout,success:function(e){}})},prepareActionCode:function(e,t,n,r,i,s,o){return t+=o?" (with Glaze)":" (without Glaze)",e=e.replace(/ACTION/g,"'"+t+"'"),e=e.replace(/GLAZE_ID/g,"'"+n+"'"),e=e.replace(/GLAZE_TITLE/g,"'"+r+"'"),e=e.replace(/CAMPAIGN_ID/g,"'"+i+"'"),e=e.replace(/CAMPAIGN_TITLE/g,"'"+s+"'"),e=e.replace(/[‘’]+/g,"'"),e}};return s}),function(e){if(typeof define=="function"&&define.amd)define("cookie",e);else if(typeof exports=="object")module.exports=e();else{var t=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=t,n}}}(function(){function e(){var e=0,t={};for(;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(n){function r(t,i,s){var o;if(arguments.length>1){s=e({path:"/"},r.defaults,s);if(typeof s.expires=="number"){var u=new Date;u.setMilliseconds(u.getMilliseconds()+s.expires*864e5),s.expires=u}try{o=JSON.stringify(i),/^[\{\[]/.test(o)&&(i=o)}catch(a){}return i=encodeURIComponent(String(i)),i=i.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",i,s.expires&&"; expires="+s.expires.toUTCString(),s.path&&"; path="+s.path,s.domain&&"; domain="+s.domain,s.secure?"; secure":""].join("")}t||(o={});var f=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,c=0;for(;c<f.length;c++){var h=f[c].split("="),p=h[0].replace(l,decodeURIComponent),d=h.slice(1).join("=");d.charAt(0)==='"'&&(d=d.slice(1,-1));try{d=n&&n(d,p)||d.replace(l,decodeURIComponent);if(this.json)try{d=JSON.parse(d)}catch(a){}if(t===p){o=d;break}t||(o[p]=d)}catch(a){}}return o}return r.get=r.set=r,r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,n){r(t,"",e(n,{expires:-1}))},r.withConverter=t,r}return t()}),function(e){var t=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){t.Backbone=e(t,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore"),r;try{r=require("jquery")}catch(i){}e(t,exports,n,r)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice;t.VERSION="1.2.3",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=function(e,t,r){switch(e){case 1:return function(){return n[t](this[r])};case 2:return function(e){return n[t](this[r],e)};case 3:return function(e,i){return n[t](this[r],a(e,this),i)};case 4:return function(e,i,s){return n[t](this[r],a(e,this),i,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[r]),n[t].apply(n,e)}}},u=function(e,t,r){n.each(t,function(t,i){n[i]&&(e.prototype[i]=o(t,i,r))})},a=function(e,t){return n.isFunction(e)?e:n.isObject(e)&&!t._isModel(e)?f(e):n.isString(e)?function(t){return t.get(e)}:e},f=function(e){var t=n.matches(e);return function(e){return t(e.attributes)}},l=t.Events={},c=/\s+/,h=function(e,t,r,i,s){var o=0,u;if(r&&typeof r=="object"){i!==void 0&&"context"in s&&s.context===void 0&&(s.context=i);for(u=n.keys(r);o<u.length;o++)t=h(e,t,u[o],r[u[o]],s)}else if(r&&c.test(r))for(u=r.split(c);o<u.length;o++)t=e(t,u[o],i,s);else t=e(t,r,i,s);return t};l.on=function(e,t,n){return p(this,e,t,n)};var p=function(e,t,n,r,i){e._events=h(d,e._events||{},t,n,{context:r,ctx:e,listening:i});if(i){var s=e._listeners||(e._listeners={});s[i.id]=i}return e};l.listenTo=function(e,t,r){if(!e)return this;var i=e._listenId||(e._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[i];if(!o){var u=this._listenId||(this._listenId=n.uniqueId("l"));o=s[i]={obj:e,objId:i,id:u,listeningTo:s,count:0}}return p(e,t,r,this,o),this};var d=function(e,t,n,r){if(n){var i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,u=r.listening;u&&u.count++,i.push({callback:n,context:s,ctx:s||o,listening:u})}return e};l.off=function(e,t,n){return this._events?(this._events=h(v,this._events,e,t,{context:n,listeners:this._listeners}),this):this},l.stopListening=function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=e?[e._listenId]:n.keys(i);for(var o=0;o<s.length;o++){var u=i[s[o]];if(!u)break;u.obj.off(t,r,this)}return n.isEmpty(i)&&(this._listeningTo=void 0),this};var v=function(e,t,r,i){if(!e)return;var s=0,o,u=i.context,a=i.listeners;if(!t&&!r&&!u){var f=n.keys(a);for(;s<f.length;s++)o=a[f[s]],delete a[o.id],delete o.listeningTo[o.objId];return}var l=t?[t]:n.keys(e);for(;s<l.length;s++){t=l[s];var c=e[t];if(!c)break;var h=[];for(var p=0;p<c.length;p++){var d=c[p];r&&r!==d.callback&&r!==d.callback._callback||u&&u!==d.context?h.push(d):(o=d.listening,o&&--o.count===0&&(delete a[o.id],delete o.listeningTo[o.objId]))}h.length?e[t]=h:delete e[t]}if(n.size(e))return e};l.once=function(e,t,r){var i=h(m,{},e,t,n.bind(this.off,this));return this.on(i,void 0,r)},l.listenToOnce=function(e,t,r){var i=h(m,{},t,r,n.bind(this.stopListening,this,e));return this.listenTo(e,i)};var m=function(e,t,r,i){if(r){var s=e[t]=n.once(function(){i(t,s),r.apply(this,arguments)});s._callback=r}return e};l.trigger=function(e){if(!this._events)return this;var t=Math.max(0,arguments.length-1),n=Array(t);for(var r=0;r<t;r++)n[r]=arguments[r+1];return h(g,this._events,e,void 0,n),this};var g=function(e,t,n,r){if(e){var i=e[t],s=e.all;i&&s&&(s=s.slice()),i&&y(i,r),s&&y(s,[t].concat(r))}return e},y=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}};l.bind=l.on,l.unbind=l.off,n.extend(t,l);var b=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(b.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,r){if(e==null)return this;var i;typeof e=="object"?(i=e,r=t):(i={})[e]=t,r||(r={});if(!this._validate(i,r))return!1;var s=r.unset,o=r.silent,u=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=n.clone(this.attributes),this.changed={});var f=this.attributes,l=this.changed,c=this._previousAttributes;for(var h in i)t=i[h],n.isEqual(f[h],t)||u.push(h),n.isEqual(c[h],t)?delete l[h]:l[h]=t,s?delete f[h]:f[h]=t;this.id=this.get(this.idAttribute);if(!o){u.length&&(this._pending=r);for(var p=0;p<u.length;p++)this.trigger("change:"+u[p],this,f[u[p]],r)}if(a)return this;if(!o)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t=this._changing?this._previousAttributes:this.attributes,r={};for(var i in e){var s=e[i];if(n.isEqual(t[i],s))continue;r[i]=s}return n.size(r)?r:!1},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=n.extend({parse:!0},e);var t=this,r=e.success;return e.success=function(n){var i=e.parse?t.parse(n,e):n;if(!t.set(i,e))return!1;r&&r.call(e.context,t,n,e),t.trigger("sync",t,n,e)},R(this,e),this.sync("read",this,e)},save:function(e,t,r){var i;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0,parse:!0},r);var s=r.wait;if(i&&!s){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;var o=this,u=r.success,a=this.attributes;r.success=function(e){o.attributes=a;var t=r.parse?o.parse(e,r):e;s&&(t=n.extend({},i,t));if(t&&!o.set(t,r))return!1;u&&u.call(r.context,o,e,r),o.trigger("sync",o,e,r)},R(this,r),i&&s&&(this.attributes=n.extend({},a,i));var f=this.isNew()?"create":r.patch?"patch":"update";f==="patch"&&!r.attrs&&(r.attrs=i);var l=this.sync(f,this,r);return this.attributes=a,l},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){i&&s(),r&&r.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var o=!1;return this.isNew()?n.defer(e.success):(R(this,e),o=this.sync("delete",this,e)),i||s(),o},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||q();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.defaults({validate:!0},e))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};u(b,w,"attributes");var E=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},S={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},T=function(e,t,n){n=Math.min(Math.max(n,0),e.length);var r=Array(e.length-n),i=t.length;for(var s=0;s<r.length;s++)r[s]=e[s+n];for(s=0;s<i;s++)e[s+n]=t[s];for(s=0;s<r.length;s++)e[s+i+n]=r[s]};n.extend(E.prototype,l,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,x))},remove:function(e,t){t=n.extend({},t);var r=!n.isArray(e);e=r?[e]:n.clone(e);var i=this._removeModels(e,t);return!t.silent&&i&&this.trigger("update",this,t),r?i[0]:i},set:function(e,t){if(e==null)return;t=n.defaults({},t,S),t.parse&&!this._isModel(e)&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?[e]:e.slice();var i=t.at;i!=null&&(i=+i),i<0&&(i+=this.length+1);var s=[],o=[],u=[],a={},f=t.add,l=t.merge,c=t.remove,h=!1,p=this.comparator&&i==null&&t.sort!==!1,d=n.isString(this.comparator)?this.comparator:null,v;for(var m=0;m<e.length;m++){v=e[m];var g=this.get(v);if(g){if(l&&v!==g){var y=this._isModel(v)?v.attributes:v;t.parse&&(y=g.parse(y,t)),g.set(y,t),p&&!h&&(h=g.hasChanged(d))}a[g.cid]||(a[g.cid]=!0,s.push(g)),e[m]=g}else f&&(v=e[m]=this._prepareModel(v,t),v&&(o.push(v),this._addReference(v,t),a[v.cid]=!0,s.push(v)))}if(c){for(m=0;m<this.length;m++)v=this.models[m],a[v.cid]||u.push(v);u.length&&this._removeModels(u,t)}var b=!1,w=!p&&f&&c;s.length&&w?(b=this.length!=s.length||n.some(this.models,function(e,t){return e!==s[t]}),this.models.length=0,T(this.models,s,0),this.length=this.models.length):o.length&&(p&&(h=!0),T(this.models,o,i==null?this.length:i),this.length=this.models.length),h&&this.sort({silent:!0});if(!t.silent){for(m=0;m<o.length;m++)i!=null&&(t.index=i+m),v=o[m],v.trigger("add",v,this,t);(h||b)&&this.trigger("sort",this,t),(o.length||u.length)&&this.trigger("update",this,t)}return r?e[0]:e},reset:function(e,t){t=t?n.clone(t):{};for(var r=0;r<this.models.length;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(e==null)return void 0;var t=this.modelId(this._isModel(e)?e.attributes:e);return this._byId[e]||this._byId[t]||this._byId[e.cid]},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var r=t.length;return n.isFunction(t)&&(t=n.bind(t,this)),r===1||n.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=n.extend({parse:!0},e);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t.call(e.context,r,n,e),r.trigger("sync",r,n,e)},R(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};var r=t.wait;e=this._prepareModel(e,t);if(!e)return!1;r||this.add(e,t);var i=this,s=t.success;return t.success=function(e,t,n){r&&i.add(e,n),s&&s.call(n.context,e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_removeModels:function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=this.get(e[r]);if(!i)continue;var s=this.indexOf(i);this.models.splice(s,1),this.length--,t.silent||(t.index=s,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n.length?n:!1},_isModel:function(e){return e instanceof b},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes);n!=null&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var n=this.modelId(e.attributes);n!=null&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r);if(e==="change"){var i=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);i!==s&&(i!=null&&delete this._byId[i],s!=null&&(this._byId[s]=t))}this.trigger.apply(this,arguments)}});var N={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};u(E,N,"models");var C=t.View=function(e){this.cid=n.uniqueId("view"),n.extend(this,n.pick(e,L)),this._ensureElement(),this.initialize.apply(this,arguments)},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];n.extend(C.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){e||(e=n.result(this,"events"));if(!e)return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[r]);if(!r)continue;var i=t.match(k);this.delegate(i[1],i[2],n.bind(r,this))}return this},delegate:function(e,t,n){return this.$el.on(e+".delegateEvents"+this.cid,t,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){return this.$el.off(e+".delegateEvents"+this.cid,t,n),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}else this.setElement(n.result(this,"el"))},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,r,i){var s=A[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||q()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1);var a=i.error;i.error=function(e,t,n){i.textStatus=t,i.errorThrown=n,a&&a.call(i.context,e,t,n)};var f=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,f,i),f};var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var O=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},M=/\((.*?)\)/g,_=/(\(\?)?:\w+/g,D=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(O.prototype,l,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o,r)!==!1&&(s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o))}),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(P,"\\$&").replace(M,"(?:$1)?").replace(_,function(e,t){return t?e:"([^/?]+)"}).replace(D,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var H=t.History=function(){this.handlers=[],this.checkUrl=n.bind(this.checkUrl,this),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},B=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,F=/#.*$/;H.started=!1,n.extend(H.prototype,l,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return e.charAt(0)==="/"?e.slice(1):e},getFragment:function(e){return e==null&&(this._usePushState||!this._wantsHashChange?e=this.getPath():e=this.getHash()),e.replace(B,"")},start:function(e){if(H.started)throw new Error("Backbone.history has already been started");H.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(document.documentMode===void 0||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!this.history&&!!this.history.pushState,this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(j,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var r=document.body,i=r.insertBefore(this.iframe,r.firstChild).contentWindow;i.document.open(),i.document.close(),i.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));if(!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),H.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),n.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})):!1},navigate:function(e,t){if(!H.started)return!1;if(!t||t===!0)t={trigger:!!t};e=this.getFragment(e||"");var n=this.root;if(e===""||e.charAt(0)==="?")n=n.slice(0,-1)||"/";var r=n+e;e=this.decodeFragment(e.replace(F,""));if(this.fragment===e)return;this.fragment=e;if(this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,e,t.replace);if(this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var i=this.iframe.contentWindow;t.replace||(i.document.open(),i.document.close()),this._updateHash(i.location,e,t.replace)}}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new H;var I=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};b.extend=E.extend=O.extend=C.extend=H.extend=I;var q=function(){throw new Error('A "url" property or function must be specified')},R=function(e,t){var n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}};return t}),define("AppModel",["require","underscore","utils/Logger","backbone","utils/MiscUtils"],function(e){var t=e("underscore"),n=e("utils/Logger"),r=e("backbone"),i=e("utils/MiscUtils"),s=r.Model.extend({pages:[],user:null,preview:!1,website:null,lastSeenCampaignId:null,shapes:[],isTrackingAllowed:function(){var e=this.get("website").ip_filters?this.get("website").ip_filters.split(","):[];return!t.some(e,t.bind(function(e){return e=e.replace(" ",""),e==this.get("settings").ip},this))&&!this.get("preview")},prepareData:function(e){return e.result&&(t.each(e.result.glazes,function(e){e.campaign_settings||(e.campaign_settings="{}"),t.each(e.variants,function(e){e.settings||(e.settings="{}")})}),t.each(e.result.website.audiences,function(e){e.code=JSON.parse(e.code)})),e},extendSettings:function(e,n){return n=n||{},n.restart||(n.restart_appearance=null,n.restart_behavior=null,n.restart_position=null,n.restart_tab_color=null,n.restart_text=null,n.restart_text_color=null,n.restart_text_font=null,n.restart_text_size=null),t.each(e,function(e,t){!n[t]&&t!=="css_rules"&&(n[t]=e)}),n},getSortedGlazes:function(e){e=e||this.lastSeenCampaignId;var n=t(this.get("glazes")).chain().sortBy(function(e){return parseInt(e.position)}).sortBy(function(e){return parseInt(e.priority)}).sortBy(function(t){if(t.preview)return-1e3;if(i.localStorage().getItem("preview_campaign")&&t.campaign_id==i.localStorage().getItem("preview_campaign"))return t.previewByCampaign=!0,-990;if(e==t.campaign_id)return-900}).value();return n},getNextGlaze:function(e){var n=t.find(this.get("glazes"),function(t){return Number(t.id)===Number(e)}),r=t.filter(this.getSortedGlazes(),function(e){return e.campaign_id===n.campaign_id}),i=t.findIndex(r,function(t){return parseInt(t.id)===parseInt(e)});return r&&r.length&&r[i+1]?r[i+1]:null},getPrevGlaze:function(e){var n=t.find(this.get("glazes"),function(t){return Number(t.id)===Number(e)}),r=t.filter(this.getSortedGlazes(),function(e){return e.campaign_id===n.campaign_id}),i=t.findIndex(r,function(t){return parseInt(t.id)===parseInt(e)});return r&&r.length&&r[i-1]?r[i-1]:null}});return new s}),define("utils/Events",["require","jquery","underscore","Settings"],function(e){var t=e("jquery"),n=e("underscore"),r=e("Settings");return{dispatch:function(e,t){t=t||null;var n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,t),window.dispatchEvent(n)}}}),define("utils/TrackingManager",["require","jquery","underscore","utils/Logger","utils/MiscUtils","utils/Events","Settings","AppModel"],function(require){var $=require("jquery"),_=require("underscore"),Logger=require("utils/Logger"),MiscUtils=require("utils/MiscUtils"),Events=require("utils/Events"),Settings=require("Settings");return{appData:null,browseTimeStart:null,expired:null,data:null,initialize:function(){this.appData=require("AppModel");var e=MiscUtils.localStorage().getItem(Settings.glazeDataStorageKey)||"{}";this.data=JSON.parse(e),this.initTTL(),this.startTimeTracking(),this.setAzure()},initTTL:function(){var e=(new Date).getTime();this.data.ca?e-this.data.ca>Settings.glazeDataStorageTTL&&(Logger.log("Glaze: glaze data has expired, renew"),this.expired=!0,this.data={ca:e}):this.data.ca=e},getGlazeSid:function(){return this.expired?"":MiscUtils.localStorage().getItem("_glz_sid")||""},getGlazeSSid:function(){return this.expired?"":MiscUtils.sessionStorage().getItem("_glz_ssid")||""},checkPageConversion:function(){var e=(window.location.pathname+window.location.search).substr(1),t="/"+e;_.each(this.data.wc,_.bind(function(n,r){if(n.type==="PAGE_VISIT"){var i=!1;_.each(n.data,function(n){var r;switch(n.type){case"url_match":if(e===n.value||t===n.value)i=!0;break;case"url_match_pattern":r=new RegExp(n.value.replace("*",".*"),"i");if(e.match(r)||t.match(r))i=!0;break;case"url_contains":if(e.match(n.value)||t.match(n.value))i=!0;break;case"url_start_with":r=new RegExp("^"+n.value,"i");if(e.match(r)||t.match(r))i=!0;break;case"url_ends_width":r=new RegExp(n.value+"$","i");if(e.match(r)||t.match(r))i=!0;break;case"url_matches_regex":r=new RegExp(n.value,"i");if(e.match(r)||t.match(r))i=!0}}),i&&this.trackConversion(n,r)}},this))},checkEngagementConversion:function(e,t,n){var r=!1;return _.each(this.data.wc,_.bind(function(n,i){if(n.type==="ENGAGEMENT"&&e==i){var s=!!_.find(n.data,function(e){return e.type==="engagement_type"&&e.value===t});s&&(this.trackConversion(n,i,"no"),r=!0)}},this)),r},checkCustomConversion:function(e){_.each(this.data.wc,_.bind(function(t,n){t.type=="CUSTOM"&&e==n&&this.trackConversion(t,n,"yes")},this))},setWaitingConversion:function(e,t,n){if(!e.get("goal"))return;if(n.abHasGlaze!=0&&this.isConverted(e.get("id"),e.get("conversion_round"))){Logger.log("Glaze: already converted glaze "+e.get("title"));return}Logger.log("Glaze: waiting for conversion for glaze "+e.get("title"));var r=_.pick(e.get("goal"),"id","duration","type","conversion_value","data"),i=n._getSettings(),s=i.conversion_action_js;s&&(s=s.replace(/GLAZE_ID/g,"'"+e.get("id")+"'"),s=s.replace(/GLAZE_TITLE/g,"'"+e.get("title")+"'"),s=s.replace(/CAMPAIGN_ID/g,"'"+e.get("campaign_id")+"'"),s=s.replace(/[‘’]+/g,"'"));var o=i.universal_action_js;o&&(o=MiscUtils.prepareActionCode(o,"GLAZE_CONVERT",e.get("id"),e.get("title"),e.get("campaign_id"),e.get("campaign_title"),n.abHasGlaze)),r.data=JSON.parse(r.data)||{},r.title=e.get("title"),r.campaign_id=e.get("campaign_id"),r.campaign_title=e.get("campaign_title"),r.glz_shown=t,r.vtc=0,r.time=new Date,r.cr=e.get("conversion_round"),r.page_url_hash=this.appData.get("page_url_hash"),r.action=s,r.universal_action=o,this.data.wc||(this.data.wc={}),r.type=="ENGAGEMENT"&&_.find(r.data,function(e){return e.type=="engagement_type"&&e.value=="void"})&&(r.details={slug:e.get("slug"),xpath:e.get("variant").getXpath(0),selector:e.get("variant").getSelector(0),shapeOffset:e.get("variant").get("shapeOffset"),scaleOffset:e.get("variant").get("scaleOffset")}),this.data.wc[e.get("id")]=r,this.save()},setWaitingVTC:function(e){this.data.wc||(this.data.wc={});var t=_.find(this.data.wc,function(t,n){return n==e.get("id")});t&&(t.vtc=1,this.data.wc[e.get("id")]=t,Logger.log("Glaze: waiting for vtc for glaze "+e.get("title")),this.save())},checkVoidVTC:function(e,t){var n=(window.location.pathname+window.location.search).substr(1),r="/"+n;_.each(this.data.wc,_.bind(function(i,s){if(_.find(e,function(e){return e==s}))return!1;if(i.type!="ENGAGEMENT"||!_.find(i.data,function(e){return e.type=="engagement_type"&&e.value=="void"}))return!1;if(!i.details||n!=i.details.slug&&r!=i.details.slug)return!1;var o=i.details.selector?$(i.details.selector).get(0):document.evaluate(i.details.xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,u=$(o),a={};if(!u.length)return;u.is(":visible")&&u.outerWidth()>0&&u.outerHeight()>0&&(a.left=u.offset().left+(i.details.shapeOffset.left?i.details.shapeOffset.left:0),a.top=u.offset().top+(i.details.shapeOffset.top?i.details.shapeOffset.top:0),a.right=u.offset().left+u.outerWidth(),a.bottom=u.offset().top+u.outerHeight()),a.width=a.right-a.left,a.height=a.bottom-a.top,t.pageX>a.left&&t.pageX<a.right&&t.pageY>a.top&&t.pageY<a.bottom&&this.trackConversion(i,s,"yes")},this))},checkClickElement:function(e){var t=$(e.target);_.each(this.data.wc,_.bind(function(e,n){if(e.type!="CLICK_ELEMENT"||!e.data)return!1;var r=_.find(e.data,function(e){return e.type=="selector"}),i=!1;t.parents().each(function(){$(this).is(r.value)&&(i=!0)}),(t.is(r.value)||i)&&this.trackConversion(e,n,"yes")},this))},save:function(){if(!this.appData.isTrackingAllowed())return;MiscUtils.localStorage().setItem(Settings.glazeDataStorageKey,JSON.stringify(this.data))},trackConversion:function(conversion,glaze_id,can_be_vtc){if(!this.appData.isTrackingAllowed())return;can_be_vtc=can_be_vtc||"yes";var data={glaze_id:glaze_id,glz_shown:conversion.glz_shown,_glz_psid:this.appData.get("_glz_psid"),can_be_vtc:can_be_vtc,page_url_hash:conversion.page_url_hash,value:conversion.conversion_value};$.ajax({type:"post",url:Settings.apiHost+(conversion.vtc==0||conversion.glz_shown=="no"?Settings.api.trackingConversion:Settings.api.trackingVtc),async:!1,data:data,success:_.bind(function(data){data&&data.status=="ok"&&(conversion.vtc==0||conversion.glz_shown=="no"?Logger.log("Glaze tracking: conversion for glaze "+conversion.title):Logger.log("Glaze tracking: vtc for glaze "+conversion.title),conversion.action&&(Logger.log("Glaze: execute action on glaze conversion "+conversion.action),eval(conversion.action)),conversion.universal_action&&(Logger.log("Glaze: execute single tag action on glaze conversion "+conversion.universal_action),eval(conversion.universal_action)),Events.dispatch("glazeConverted",{glaze_id:glaze_id,campaign_id:conversion.campaign_id,campaign_title:conversion.campaign_title,glaze_title:conversion.title,is_vtc:conversion.vtc!=0&&conversion.glz_shown!=="no"}),this.setConversion(glaze_id))},this)})},setConversion:function(e){var t=this.data.wc[e];this.data.cg||(this.data.cg={}),this.data.cg[e]={ts:new Date,dt:t.duration,cr:t.cr},delete this.data.wc[e],this.save()},setAB:function(e,t){this.data.ab||(this.data.ab={}),this.data.ab[e]=t,this.save()},getAB:function(e){return this.data.ab?this.data.ab[e]||null:null},setViewedGlazesNumber:function(e,t){this.data.gn||(this.data.gn={}),this.data.gn[e]=t,this.save()},getViewedGlazesNumber:function(e){return this.data.gn?this.data.gn[e]||null:null},isConverted:function(e,t){return _.find(this.data.cg,function(n,r){return r==e&&(typeof t=="undefined"||n.cr==t)})},isImpressed:function(e){return _.find(this.data.ig,function(t,n){return n==e})},getImpressionsNumber:function(e){this.data.ig||(this.data.ig={});var t=_.find(this.data.ig,function(t,n){return n==e});return t?t.num:0},setImpression:function(e,t){this.data.ig||(this.data.ig={}),this.data.ic||(this.data.ic={}),this.data.ig[e]={ts:new Date,cid:t,num:this.data.ig[e]?this.data.ig[e].num+1:1},this.data.ic[t]=this.data.ic[t]?this.data.ic[t]+1:1,this.save()},hasSeenCampaign:function(e){return this.data.ic||(this.data.ic={}),this.data.ic[e]},getLastSeenCampaignId:function(){this.data.ig||(this.data.ig={});var e=_.max(this.data.ig,function(e){return(new Date(e.ts)).getTime()});return e?e.cid:0},notifyNoElement:function(e,t){if(!this.appData.isTrackingAllowed()||this.appData.get("website").notify!="yes")return;$.ajax({type:"post",url:this.appData.get("platform_host")+Settings.api.notification,data:{glaze_id:e,element:t},success:_.bind(function(e){},this)})},trackPage:function(){if(!this.appData.isTrackingAllowed())return;var e=window.location.pathname+window.location.search||"/";this.data.pv||(this.data.pv={}),this.data.pv[e]||(this.data.pv[e]=[]),this.currentPageTime=(new Date).getTime(),this.data.pv[e].push(this.currentPageTime),this.save()},isPageVisited:function(e,t){var n=this.data.pv||{};return _.find(n,function(n,r){var i=!1;switch(t){case"simple":e==r&&(i=!0);break;case"exact":e==r&&(i=!0);break;case"substring":i=!!r.match(e);break;case"regular":i=!!r.match(e)}return i})},pagesVisited:function(){var e=this.data.pv||{};return _.reduce(e,function(e,t){return e+=t.length,e},0)},visitedPageRecentTime:function(e,t,n){var r=this.data.pv||{};return _.find(r,_.bind(function(r,i){var s=!1,o=_.filter(r,_.bind(function(e){return e!=this.currentPageTime},this));if(!o||!o.length)return!1;switch(t){case"simple":e==i&&(s=!0);break;case"exact":e==i&&(s=!0);break;case"substring":s=!!i.match(e);break;case"regular":s=!!i.match(e)}if(n){var u=(new Date(n+" 00:00")).getTime();s=s&&_.find(r,function(e){return e>=u})}return s},this))},startTimeTracking:function(){this.browseTimeStart=(new Date).getTime(),$(window).on("unload.glaze",_.bind(function(){window._glazePT||this.saveTimeTracking()},this))},saveTimeTracking:function(){var e=!MiscUtils.localStorage().getItem(Settings.glazeDataStorageKey);e||(this.data.bt=parseInt(this.data.bt||0),this.data.bt+=(new Date).getTime()-this.browseTimeStart,this.browseTimeStart=(new Date).getTime(),this.save())},checkBrowseTime:function(e){return this.saveTimeTracking(),this.data.bt>=e*1e3},setAzure:function(){this.appData.get("use_azure")==1&&$.ajaxPrefilter(function(e,t,n){e.data=e.data||"",e.data="use_azure=1&"+e.data})},setRestartCampaign:function(e){this.data.rc||(this.data.rc=[]),this.data.rc=_.union(this.data.rc,[e]),this.save()},isCampaignClosed:function(e){return this.data.rc||(this.data.rc=[]),!!_.find(this.data.rc,function(t){return t==e})},setClosedCampaign:function(e){this.data.cc||(this.data.cc={}),this.data.cc[e]=this.data.cc[e]?this.data.cc[e]+1:1,this.save()},getClosedCampaignTimes:function(e){return this.data.cc||(this.data.cc={}),this.data.cc[e]||0}}}),function(e){function n(e){return e&&(e=e.toString().replace(t.pluses,"%20"),e=decodeURIComponent(e)),e}function r(e){var n=t.uri_parser,r=["source","protocol","authority","userInfo","user","password","host","port","isColonUri","relative","path","directory","file","query","anchor"],i=n.exec(e||""),s={};return r.forEach(function(e,t){s[e]=i[t]||""}),s}function i(e){var r,i,s,o,u,a,f,l=[];if(typeof e=="undefined"||e===null||e==="")return l;e.indexOf("?")===0&&(e=e.substring(1)),i=e.toString().split(t.query_separator);for(r=0,f=i.length;r<f;r++)s=i[r],o=s.indexOf("="),o!==0&&(u=n(s.substring(0,o)),a=n(s.substring(o+1)),l.push(o===-1?[s,null]:[u,a]));return l}function s(e){this.uriParts=r(e),this.queryPairs=i(this.uriParts.query),this.hasAuthorityPrefixUserPref=null}var t={starts_with_slashes:/^\/+/,ends_with_slashes:/\/+$/,pluses:/\+/g,query_separator:/[&;]/,uri_parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@]*))?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)(?::(\d+|(?=:)))?(:)?)((((?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(this==null)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if(typeof e!="function")throw new TypeError(e+" is not a function");arguments.length>1&&(n=t),r=0;while(r<s){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}}),["protocol","userInfo","host","port","path","anchor"].forEach(function(e){s.prototype[e]=function(t){return typeof t!="undefined"&&(this.uriParts[e]=t),this.uriParts[e]}}),s.prototype.hasAuthorityPrefix=function(e){return typeof e!="undefined"&&(this.hasAuthorityPrefixUserPref=e),this.hasAuthorityPrefixUserPref===null?this.uriParts.source.indexOf("//")!==-1:this.hasAuthorityPrefixUserPref},s.prototype.isColonUri=function(e){if(typeof e=="undefined")return!!this.uriParts.isColonUri;this.uriParts.isColonUri=!!e},s.prototype.query=function(e){var t="",n,r,s;typeof e!="undefined"&&(this.queryPairs=i(e));for(n=0,s=this.queryPairs.length;n<s;n++)r=this.queryPairs[n],t.length>0&&(t+="&"),r[1]===null?t+=r[0]:(t+=r[0],t+="=",typeof r[1]!="undefined"&&(t+=encodeURIComponent(r[1])));return t.length>0?"?"+t:t},s.prototype.getQueryParamValue=function(e){var t,n,r;for(n=0,r=this.queryPairs.length;n<r;n++){t=this.queryPairs[n];if(e===t[0])return t[1]}},s.prototype.getQueryParamValues=function(e){var t=[],n,r,i;for(n=0,i=this.queryPairs.length;n<i;n++)r=this.queryPairs[n],e===r[0]&&t.push(r[1]);return t},s.prototype.deleteQueryParam=function(e,t){var r=[],i,s,o,u,a;for(i=0,a=this.queryPairs.length;i<a;i++)s=this.queryPairs[i],o=n(s[0])===n(e),u=s[1]===t,(arguments.length===1&&!o||arguments.length===2&&(!o||!u))&&r.push(s);return this.queryPairs=r,this},s.prototype.addQueryParam=function(e,t,n){return arguments.length===3&&n!==-1?(n=Math.min(n,this.queryPairs.length),this.queryPairs.splice(n,0,[e,t])):arguments.length>0&&this.queryPairs.push([e,t]),this},s.prototype.hasQueryParam=function(e){var t,n=this.queryPairs.length;for(t=0;t<n;t++)if(this.queryPairs[t][0]==e)return!0;return!1},s.prototype.replaceQueryParam=function(e,t,r){var i=-1,s=this.queryPairs.length,o,u;if(arguments.length===3){for(o=0;o<s;o++){u=this.queryPairs[o];if(n(u[0])===n(e)&&decodeURIComponent(u[1])===n(r)){i=o;break}}i>=0&&this.deleteQueryParam(e,n(r)).addQueryParam(e,t,i)}else{for(o=0;o<s;o++){u=this.queryPairs[o];if(n(u[0])===n(e)){i=o;break}}this.deleteQueryParam(e),this.addQueryParam(e,t,i)}return this},["protocol","hasAuthorityPrefix","isColonUri","userInfo","host","port","path","query","anchor"].forEach(function(e){var t="set"+e.charAt(0).toUpperCase()+e.slice(1);s.prototype[t]=function(t){return this[e](t),this}}),s.prototype.scheme=function(){var e="";return this.protocol()?(e+=this.protocol(),this.protocol().indexOf(":")!==this.protocol().length-1&&(e+=":"),e+="//"):this.hasAuthorityPrefix()&&this.host()&&(e+="//"),e},s.prototype.origin=function(){var e=this.scheme();this.userInfo()&&this.host()&&(e+=this.userInfo(),this.userInfo().indexOf("@")!==this.userInfo().length-1&&(e+="@"));if(this.host()){e+=this.host();if(this.port()||this.path()&&this.path().substr(0,1).match(/[0-9]/))e+=":"+this.port()}return e},s.prototype.addTrailingSlash=function(){var e=this.path()||"";return e.substr(-1)!=="/"&&this.path(e+"/"),this},s.prototype.toString=function(){var e,n=this.origin();return this.isColonUri()?this.path()&&(n+=":"+this.path()):this.path()?(e=this.path(),!t.ends_with_slashes.test(n)&&!t.starts_with_slashes.test(e)?n+="/":(n&&n.replace(t.ends_with_slashes,"/"),e=e.replace(t.starts_with_slashes,"/")),n+=e):this.host()&&(this.query().toString()||this.anchor())&&(n+="/"),this.query().toString()&&(n+=this.query().toString()),this.anchor()&&(this.anchor().indexOf("#")!==0&&(n+="#"),n+=this.anchor()),n},s.prototype.clone=function(){return new s(this.toString())},typeof define=="function"&&define.amd?define("uri",[],function(){return s}):typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=s:e.Uri=s}(this),function(e,t){e("mobiledetect",[],function(){function i(e,t){return e!=null&&t!=null&&e.toLowerCase()===t.toLowerCase()}function s(e,t){var n,r,i=e.length;if(!i||!t)return!1;n=t.toLowerCase();for(r=0;r<i;++r)if(n===e[r].toLowerCase())return!0;return!1}function o(e){for(var t in e)n.call(e,t)&&(e[t]=new RegExp(e[t],"i"))}function u(e,t){this.ua=e||"",this._cache={},this.maxPhoneWidth=t||600}var e={};e.mobileDetectRules={phones:{iPhone:"\\biPhone\\b|\\biPod\\b",BlackBerry:"BlackBerry|\\bBB10\\b|rim[0-9]+",HTC:"HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\bEVO\\b|T-Mobile G1|Z520m",Nexus:"Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6",Dell:"Dell.*Streak|Dell.*Aero|Dell.*Venue|DELL.*Venue Pro|Dell Flash|Dell Smoke|Dell Mini 3iX|XCD28|XCD35|\\b001DL\\b|\\b101DL\\b|\\bGS01\\b",Motorola:"Motorola|DROIDX|DROID BIONIC|\\bDroid\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\bMoto E\\b",Samsung:"Samsung|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205",LG:"\\bLG\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802)",Sony:"SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533",Asus:"Asus.*Galaxy|PadFone.*Mobile",Micromax:"Micromax.*\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\b",Palm:"PalmSource|Palm",Vertu:"Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature",Pantech:"PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790",Fly:"IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250",Wiko:"KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM",iMobile:"i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)",SimValley:"\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\b",Wolfgang:"AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q",Alcatel:"Alcatel",Nintendo:"Nintendo 3DS",Amoi:"Amoi",INQ:"INQ",GenericPhone:"Tapatalk|PDA;|SAGEM|\\bmmp\\b|pocket|\\bpsp\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\bwap\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser"},tablets:{iPad:"iPad|iPad.*Mobile",NexusTablet:"Android.*Nexus[\\s]+(7|9|10)",SamsungTablet:"SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T360",Kindle:"Kindle|Silk.*Accelerated|Android.*\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI)\\b",SurfaceTablet:"Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)",HPTablet:"HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10",AsusTablet:"^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\bK00F\\b|\\bK00C\\b|\\bK00E\\b|\\bK00L\\b|TX201LA|ME176C|ME102A|\\bM80TA\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K017 |ME572C|ME103K|ME170C|ME171C|\\bME70C\\b|ME581C|ME581CL|ME8510C|ME181C",BlackBerryTablet:"PlayBook|RIM Tablet",HTCtablet:"HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410",MotorolaTablet:"xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617",NookTablet:"Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2",AcerTablet:"Android.*; \\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\b|W3-810|\\bA3-A10\\b|\\bA3-A11\\b",ToshibaTablet:"Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO",LGTablet:"\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\b",FujitsuTablet:"Android.*\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\b",PrestigioTablet:"PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002",LenovoTablet:"Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)",DellTablet:"Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7",YarvikTablet:"Android.*\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\b",MedionTablet:"Android.*\\bOYO\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB",ArnovaTablet:"AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2",IntensoTablet:"INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004",IRUTablet:"M702pro",MegafonTablet:"MegaFon V9|\\bZTE V9\\b|Android.*\\bMT7A\\b",EbodaTablet:"E-Boda (Supreme|Impresspeed|Izzycomm|Essential)",AllViewTablet:"Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)",ArchosTablet:"\\b(101G9|80G9|A101IT)\\b|Qilive 97R|Archos5|\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\b",AinolTablet:"NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark",SonyTablet:"Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP612|SOT31",PhilipsTablet:"\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\b",CubeTablet:"Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT",CobyTablet:"MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010",MIDTablet:"M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733",MSITablet:"MSI \\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\b",SMiTTablet:"Android.*(\\bMID\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)",RockChipTablet:"Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A",FlyTablet:"IQ310|Fly Vision",bqTablet:"Android.*(bq)?.*(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris E10)|Maxwell.*Lite|Maxwell.*Plus",HuaweiTablet:"MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim",NecTablet:"\\bN-06D|\\bN-08D",PantechTablet:"Pantech.*P4100",BronchoTablet:"Broncho.*(N701|N708|N802|a710)",VersusTablet:"TOUCHPAD.*[78910]|\\bTOUCHTAB\\b",ZyncTablet:"z1000|Z99 2G|z99|z930|z999|z990|z909|Z919|z900",PositivoTablet:"TB07STA|TB10STA|TB07FTA|TB10FTA",NabiTablet:"Android.*\\bNabi",KoboTablet:"Kobo Touch|\\bK080\\b|\\bVox\\b Build|\\bArc\\b Build",DanewTablet:"DSlide.*\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\b",TexetTablet:"NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE",PlaystationTablet:"Playstation.*(Portable|Vita)",TrekstorTablet:"ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab",PyleAudioTablet:"\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\b",AdvanTablet:"Android.* \\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\b ",DanyTechTablet:"Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1",GalapadTablet:"Android.*\\bG1\\b",MicromaxTablet:"Funbook|Micromax.*\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\b",KarbonnTablet:"Android.*\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\b",AllFineTablet:"Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide",PROSCANTablet:"\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\b",YONESTablet:"BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026",ChangJiaTablet:"TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503",GUTablet:"TX-A1301|TX-M9002|Q702|kf026",PointOfViewTablet:"TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10",OvermaxTablet:"OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)",HCLTablet:"HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync",DPSTablet:"DPS Dream 9|DPS Dual 7",VistureTablet:"V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10",CrestaTablet:"CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989",MediatekTablet:"\\bMT8125|MT8389|MT8135|MT8377\\b",ConcordeTablet:"Concorde([ ]+)?Tab|ConCorde ReadMan",GoCleverTablet:"GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042",ModecomTablet:"FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003",VoninoTablet:"\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\bQ8\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\b",ECSTablet:"V07OT2|TM105A|S10OT1|TR10CS1",StorexTablet:"eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab",VodafoneTablet:"SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7",EssentielBTablet:"Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2",RossMoorTablet:"RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711",iMobileTablet:"i-mobile i-note",TolinoTablet:"tolino tab [0-9.]+|tolino shine",AudioSonicTablet:"\\bC-22Q|T7-QC|T-17B|T-17P\\b",AMPETablet:"Android.* A78 ",SkkTablet:"Android.* (SKYPAD|PHOENIX|CYCLOPS)",TecnoTablet:"TECNO P9",JXDTablet:"Android.*\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\b",iJoyTablet:"Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)",FX2Tablet:"FX2 PAD7|FX2 PAD10",XoroTablet:"KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151",ViewsonicTablet:"ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a",OdysTablet:"LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\bXELIO\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10",CaptivaTablet:"CAPTIVA PAD",IconbitTablet:"NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S",TeclastTablet:"T98 4G|\\bP80\\b|\\bX90HD\\b|X98 Air|X98 Air 3G|\\bX89\\b|P80 3G|\\bX80h\\b|P98 Air|\\bX89HD\\b|P98 3G|\\bP90HD\\b|P89 3G|X98 3G|\\bP70h\\b|P79HD 3G|G18d 3G|\\bP79HD\\b|\\bP89s\\b|\\bA88\\b|\\bP10HD\\b|\\bP19HD\\b|G18 3G|\\bP78HD\\b|\\bA78\\b|\\bP75\\b|G17s 3G|G17h 3G|\\bP85t\\b|\\bP90\\b|\\bP11\\b|\\bP98t\\b|\\bP98HD\\b|\\bG18d\\b|\\bP85s\\b|\\bP11HD\\b|\\bP88s\\b|\\bA80HD\\b|\\bA80se\\b|\\bA10h\\b|\\bP89\\b|\\bP78s\\b|\\bG18\\b|\\bP85\\b|\\bA70h\\b|\\bA70\\b|\\bG17\\b|\\bP18\\b|\\bA80s\\b|\\bA11s\\b|\\bP88HD\\b|\\bA80h\\b|\\bP76s\\b|\\bP76h\\b|\\bP98\\b|\\bA10HD\\b|\\bP78\\b|\\bP88\\b|\\bA11\\b|\\bA10t\\b|\\bP76a\\b|\\bP76t\\b|\\bP76e\\b|\\bP85HD\\b|\\bP85a\\b|\\bP86\\b|\\bP75HD\\b|\\bP76v\\b|\\bA12\\b|\\bP75a\\b|\\bA15\\b|\\bP76Ti\\b|\\bP81HD\\b|\\bA10\\b|\\bT760VE\\b|\\bT720HD\\b|\\bP76\\b|\\bP73\\b|\\bP71\\b|\\bP72\\b|\\bT720SE\\b|\\bC520Ti\\b|\\bT760\\b|\\bT720VE\\b|T720-3GE|T720-WiFi",OndaTablet:"\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\b[\\s]+",JaytechTablet:"TPC-PA762",BlaupunktTablet:"Endeavour 800NG|Endeavour 1010",DigmaTablet:"\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\b",EvolioTablet:"ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\bEvotab\\b|\\bNeura\\b",LavaTablet:"QPAD E704|\\bIvoryS\\b|E-TAB IVORY|\\bE-TAB\\b",CelkonTablet:"CT695|CT888|CT[\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\bCT-1\\b",WolderTablet:"miTab \\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\b",MiTablet:"\\bMI PAD\\b|\\bHM NOTE 1W\\b",NibiruTablet:"Nibiru M1|Nibiru Jupiter One",NexoTablet:"NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI",LeaderTablet:"TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100",UbislateTablet:"UbiSlate[\\s]?7C",PocketBookTablet:"Pocketbook",Hudl:"Hudl HT7S3",TelstraTablet:"T-Hub2",GenericTablet:"Android.*\\b97D\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\bA7EB\\b|CatNova8|A1_07|CT704|CT1002|\\bM721\\b|rk30sdk|\\bEVOTAB\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\bM6pro\\b|CT1020W|arc 10HD|\\bJolla\\b|\\bTP750\\b"},oss:{AndroidOS:"Android",BlackBerryOS:"blackberry|\\bBB10\\b|rim tablet os",PalmOS:"PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino",SymbianOS:"Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\bS60\\b",WindowsMobileOS:"Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;",WindowsPhoneOS:"Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;",iOS:"\\biPhone.*Mobile|\\biPod|\\biPad",MeeGoOS:"MeeGo",MaemoOS:"Maemo",JavaOS:"J2ME/|\\bMIDP\\b|\\bCLDC\\b",webOS:"webOS|hpwOS",badaOS:"\\bBada\\b",BREWOS:"BREW"},uas:{Chrome:"\\bCrMo\\b|CriOS|Android.*Chrome/[.0-9]* (Mobile)?",Dolfin:"\\bDolfin\\b",Opera:"Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR/[0-9.]+|Coast/[0-9.]+",Skyfire:"Skyfire",IE:"IEMobile|MSIEMobile",Firefox:"fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile",Bolt:"bolt",TeaShark:"teashark",Blazer:"Blazer",Safari:"Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari",Tizen:"Tizen",UCBrowser:"UC.*Browser|UCWEB",baiduboxapp:"baiduboxapp",baidubrowser:"baidubrowser",DiigoBrowser:"DiigoBrowser",Puffin:"Puffin",Mercury:"\\bMercury\\b",ObigoBrowser:"Obigo",NetFront:"NF-Browser",GenericBrowser:"NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger"},props:{Mobile:"Mobile/[VER]",Build:"Build/[VER]",Version:"Version/[VER]",VendorID:"VendorID/[VER]",iPad:"iPad.*CPU[a-z ]+[VER]",iPhone:"iPhone.*CPU[a-z ]+[VER]",iPod:"iPod.*CPU[a-z ]+[VER]",Kindle:"Kindle/[VER]",Chrome:["Chrome/[VER]","CriOS/[VER]","CrMo/[VER]"],Coast:["Coast/[VER]"],Dolfin:"Dolfin/[VER]",Firefox:"Firefox/[VER]",Fennec:"Fennec/[VER]",IE:["IEMobile/[VER];","IEMobile [VER]","MSIE [VER];","Trident/[0-9.]+;.*rv:[VER]"],NetFront:"NetFront/[VER]",NokiaBrowser:"NokiaBrowser/[VER]",Opera:[" OPR/[VER]","Opera Mini/[VER]","Version/[VER]"],"Opera Mini":"Opera Mini/[VER]","Opera Mobi":"Version/[VER]","UC Browser":"UC Browser[VER]",MQQBrowser:"MQQBrowser/[VER]",MicroMessenger:"MicroMessenger/[VER]",baiduboxapp:"baiduboxapp/[VER]",baidubrowser:"baidubrowser/[VER]",Iron:"Iron/[VER]",Safari:["Version/[VER]","Safari/[VER]"],Skyfire:"Skyfire/[VER]",Tizen:"Tizen/[VER]",Webkit:"webkit[ /][VER]",Gecko:"Gecko/[VER]",Trident:"Trident/[VER]",Presto:"Presto/[VER]",iOS:" \\bi?OS\\b [VER][ ;]{1}",Android:"Android [VER]",BlackBerry:["BlackBerry[\\w]+/[VER]","BlackBerry.*Version/[VER]","Version/[VER]"],BREW:"BREW [VER]",Java:"Java/[VER]","Windows Phone OS":["Windows Phone OS [VER]","Windows Phone [VER]"],"Windows Phone":"Windows Phone [VER]","Windows CE":"Windows CE/[VER]","Windows NT":"Windows NT [VER]",Symbian:["SymbianOS/[VER]","Symbian/[VER]"],webOS:["webOS/[VER]","hpwOS/[VER];"]},utils:{Bot:"Googlebot|facebookexternalhit|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom",MobileBot:"Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker/M1A1-R2D2",DesktopMode:"WPDesktop",TV:"SonyDTV|HbbTV",WebKit:"(webkit)[ /]([\\w.]+)",Console:"\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|PLAYSTATION|Xbox)\\b",Watch:"SM-V700"}},e.detectMobileBrowsers={fullPattern:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,shortPattern:/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,tabletPattern:/android|ipad|playbook|silk/i};var n=Object.prototype.hasOwnProperty,r;return e.FALLBACK_PHONE="UnknownPhone",e.FALLBACK_TABLET="UnknownTablet",e.FALLBACK_MOBILE="UnknownMobile",r="isArray"in Array?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},function(){var i,s,u,a,f,l,c=e.mobileDetectRules;for(i in c.props)if(n.call(c.props,i)){s=c.props[i],r(s)||(s=[s]),f=s.length;for(a=0;a<f;++a)u=s[a],l=u.indexOf("[VER]"),l>=0&&(u=u.substring(0,l)+"([\\w._\\+]+)"+u.substring(l+5)),s[a]=new RegExp(u,"i");c.props[i]=s}o(c.oss),o(c.phones),o(c.tablets),o(c.uas),o(c.utils),c.oss0={WindowsPhoneOS:c.oss.WindowsPhoneOS,WindowsMobileOS:c.oss.WindowsMobileOS}}(),e.findMatch=function(e,t){for(var r in e)if(n.call(e,r)&&e[r].test(t))return r;return null},e.findMatches=function(e,t){var r=[];for(var i in e)n.call(e,i)&&e[i].test(t)&&r.push(i);return r},e.getVersionStr=function(t,r){var i=e.mobileDetectRules.props,s,o,u,a;if(n.call(i,t)){s=i[t],u=s.length;for(o=0;o<u;++o){a=s[o].exec(r);if(a!==null)return a[1]}}return null},e.getVersion=function(t,n){var r=e.getVersionStr(t,n);return r?e.prepareVersionNo(r):NaN},e.prepareVersionNo=function(e){var t;return t=e.split(/[a-z._ \/\-]/i),t.length===1&&(e=t[0]),t.length>1&&(e=t[0]+".",t.shift(),e+=t.join("")),Number(e)},e.isMobileFallback=function(t){return e.detectMobileBrowsers.fullPattern.test(t)||e.detectMobileBrowsers.shortPattern.test(t.substr(0,4))},e.isTabletFallback=function(t){return e.detectMobileBrowsers.tabletPattern.test(t)},e.prepareDetectionCache=function(n,r,i){if(n.mobile!==t)return;var s,o,a;o=e.findMatch(e.mobileDetectRules.tablets,r);if(o){n.mobile=n.tablet=o,n.phone=null;return}s=e.findMatch(e.mobileDetectRules.phones,r);if(s){n.mobile=n.phone=s,n.tablet=null;return}e.isMobileFallback(r)?(a=u.isPhoneSized(i),a===t?(n.mobile=e.FALLBACK_MOBILE,n.tablet=n.phone=null):a?(n.mobile=n.phone=e.FALLBACK_PHONE,n.tablet=null):(n.mobile=n.tablet=e.FALLBACK_TABLET,n.phone=null)):e.isTabletFallback(r)?(n.mobile=n.tablet=e.FALLBACK_TABLET,n.phone=null):n.mobile=n.tablet=n.phone=null},e.mobileGrade=function(e){var t=e.mobile()!==null;return e.os("iOS")&&e.version("iPad")>=4.3||e.os("iOS")&&e.version("iPhone")>=3.1||e.os("iOS")&&e.version("iPod")>=3.1||e.version("Android")>2.1&&e.is("Webkit")||e.version("Windows Phone OS")>=7||e.is("BlackBerry")&&e.version("BlackBerry")>=6||e.match("Playbook.*Tablet")||e.version("webOS")>=1.4&&e.match("Palm|Pre|Pixi")||e.match("hp.*TouchPad")||e.is("Firefox")&&e.version("Firefox")>=12||e.is("Chrome")&&e.is("AndroidOS")&&e.version("Android")>=4||e.is("Skyfire")&&e.version("Skyfire")>=4.1&&e.is("AndroidOS")&&e.version("Android")>=2.3||e.is("Opera")&&e.version("Opera Mobi")>11&&e.is("AndroidOS")||e.is("MeeGoOS")||e.is("Tizen")||e.is("Dolfin")&&e.version("Bada")>=2||(e.is("UC Browser")||e.is("Dolfin"))&&e.version("Android")>=2.3||e.match("Kindle Fire")||e.is("Kindle")&&e.version("Kindle")>=3||e.is("AndroidOS")&&e.is("NookTablet")||e.version("Chrome")>=11&&!t||e.version("Safari")>=5&&!t||e.version("Firefox")>=4&&!t||e.version("MSIE")>=7&&!t||e.version("Opera")>=10&&!t?"A":e.os("iOS")&&e.version("iPad")<4.3||e.os("iOS")&&e.version("iPhone")<3.1||e.os("iOS")&&e.version("iPod")<3.1||e.is("Blackberry")&&e.version("BlackBerry")>=5&&e.version("BlackBerry")<6||e.version("Opera Mini")>=5&&e.version("Opera Mini")<=6.5&&(e.version("Android")>=2.3||e.is("iOS"))||e.match("NokiaN8|NokiaC7|N97.*Series60|Symbian/3")||e.version("Opera Mobi")>=11&&e.is("SymbianOS")?"B":e.version("BlackBerry")<5||e.match("MSIEMobile|Windows CE.*Mobile")||e.version("Windows Mobile")<=5.2?"C":"C"},e.detectOS=function(t){return e.findMatch(e.mobileDetectRules.oss0,t)||e.findMatch(e.mobileDetectRules.oss,t)},e.getDeviceSmallerSide=function(){return window.screen.width<window.screen.height?window.screen.width:window.screen.height},u.prototype={constructor:u,mobile:function(){return e.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth),this._cache.mobile},phone:function(){return e.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth),this._cache.phone},tablet:function(){return e.prepareDetectionCache(this._cache,this.ua,this.maxPhoneWidth),this._cache.tablet},userAgent:function(){return this._cache.userAgent===t&&(this._cache.userAgent=e.findMatch(e.mobileDetectRules.uas,this.ua)),this._cache.userAgent},userAgents:function(){return this._cache.userAgents===t&&(this._cache.userAgents=e.findMatches(e.mobileDetectRules.uas,this.ua)),this._cache.userAgents},os:function(){return this._cache.os===t&&(this._cache.os=e.detectOS(this.ua)),this._cache.os},version:function(t){return e.getVersion(t,this.ua)},versionStr:function(t){return e.getVersionStr(t,this.ua)},is:function(t){return s(this.userAgents(),t)||i(t,this.os())||i(t,this.phone())||i(t,this.tablet())||s(e.findMatches(e.mobileDetectRules.utils,this.ua),t)},match:function(e){return e instanceof RegExp||(e=new RegExp(e,"i")),e.test(this.ua)},isPhoneSized:function(e){return u.isPhoneSized(e||this.maxPhoneWidth)},mobileGrade:function(){return this._cache.grade===t&&(this._cache.grade=e.mobileGrade(this)),this._cache.grade}},typeof window!="undefined"&&window.screen?u.isPhoneSized=function(n){return n<0?t:e.getDeviceSmallerSide()<=n}:u.isPhoneSized=function(){},u._impl=e,u})}(function(e){if(typeof module!="undefined"&&module.exports)return function(e){module.exports=e()};if(typeof define=="function"&&define.amd)return define;if(typeof window!="undefined")return function(e){window.MobileDetect=e()};throw new Error("unknown environment")}()),define("Setup",["require","jquery","underscore","Settings","utils/MiscUtils","cookie","AppModel","utils/Logger","utils/TrackingManager","uri","mobiledetect"],function(e){var t=e("jquery"),n=e("underscore"),r=e("Settings"),i=e("utils/MiscUtils"),s=e("cookie"),o=e("AppModel"),u=e("utils/Logger"),a=e("utils/TrackingManager"),f=e("uri"),l=e("mobiledetect"),c=new l(window.navigator.userAgent),h={setHost:function(e){r.apiHost=e},setCdn:function(e){r.cdnHost=e},setEnv:function(e){r.environment=e},setAccId:function(e){r.accountId=e},addConversion:function(e,t){a.checkCustomConversion(t)},setVariable:function(e,t,n){window.glaze._vars["_glz_"+t]=n},getVariable:function(e,t){return window.glaze._vars["_glz_"+t]},setActiveGlazes:function(e,t){window.glaze._activeGlazes=t},getActiveGlazes:function(e){return window.glaze._activeGlazes}};return function(e){if(!!window._glazeSnippetInit){console.warn("Glaze: snippet has been already started");return}window._glazeSnippetInit=!0;if(window.top!=window){var s={data:{height:t(document).height()},message:"initFrame"};return window.parent.postMessage(s,"*"),!1}if(window.innerWidth<r.minWindowWidth){console.warn("Glaze: screen size is lower than minimum");return}if(c.phone()&&window.innerWidth>window.innerHeight)return console.warn("Glaze: mobile landscape mode detected. Glaze has stopped."),this;window._glaze&&window._glaze.q&&n.each(window._glaze.q,function(e){if(!n.isFunction(h[e[0]]))throw new Error("Glaze method not found: "+e[0]);h[e[0]](e[1])}),window.glazeAPI=function(e){if(h[e])return h[e].apply(null,arguments)},window.glaze={_vars:{},_activeGlazes:[],API:window.glazeAPI},r.apiHost=r.apiHost||window.glazeApiHost,r.apiPort=window.glazeApiPort||"",r.accountId=r.accountId||window.glazeAccountId,r.apiHost.match("http")||(r.apiHost="//"+r.apiHost),r.apiHost=r.apiHost.replace("glazemaker.co","glaze.ai"),r.apiHost.substr(-1)==="/"&&(r.apiHost=r.apiHost.substring(0,r.apiHost.length-1)),r.cdnHost||(r.cdnHost="https://cdn.glaze.ai"),r.cssPath=r.environment==="dev"?r.cssDevPath:r.cssPath,t("head").append('<link id="glzImportedCSS" rel="stylesheet" type="text/css" href="'+r.cdnHost+r.cssPath+'">');var l=new f(window.location.href);l.deleteQueryParam("preview_glaze"),l.deleteQueryParam("last_account"),l.deleteQueryParam("last_url");var p=window.location.hash,d={origin:l.protocol()+"://"+l.host(),slug:l.path()+l.query(),query:l.query(),accountId:r.accountId,hash:p};if(window.glazeGetWindowLocation){var v=window.glazeGetWindowLocation();v=new f(v),v.deleteQueryParam("preview_glaze"),v.deleteQueryParam("last_account"),v.deleteQueryParam("last_url");var m=String(v.toString()).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);d.origin=m[1]+"//"+m[3],d.slug=m[6]+(m[7]?m[7]:"")}var g=i.getParameterByName("preview_glaze")||i.localStorage().getItem("preview_glaze");g&&(i.localStorage().setItem("preview_glaze",g),d.preview=1,o.set({preview:!0,previewGlaze:g})),a.initialize(),d._glz_sid=a.getGlazeSid(),d._glz_ssid=a.getGlazeSSid();var y=Date.now();t.ajax({type:"get",url:r.apiHost+r.api.clientData,data:d,xhrFields:{withCredentials:!0},crossDomain:!0,timeout:r.ajaxTimeout,success:function(s){typeof s=="string"&&(s=JSON.parse(s)),s=o.prepareData(s),o.set(s.result),i.localStorage().setItem("_glz_sid",s.result._glz_sid),i.sessionStorage().setItem("_glz_ssid",s.result._glz_ssid),a.checkPageConversion();if(!!s.result.livebuilder&&s.result.GZAuthToken){var f=s.result.platform_host;t.ajax({type:"get",url:f+r.api.user,xhrFields:{withCredentials:!0},headers:{Authorization:"Bearer "+s.result.GZAuthToken},crossDomain:!0,success:function(e){typeof e=="string"&&(e=JSON.parse(e));if(e.data&&e.data.account&&(Number(e.data.account_id)===Number(r.accountId)||e.data.role_id===1)){u.launch(),e.data.role_id===1&&u.log("Glaze: Glaze Team Member detected. Logger is turned on.");if(typeof [].reduce(function(){},0)!="number"){var n=document.createElement("iframe");document.documentElement.appendChild(n);var i=n.contentWindow;Array.prototype.reduce=i.Array.prototype.reduce,Array=i.Array,Object=i.Object,document.documentElement.removeChild(n)}window._glazeBootstrapLoaded=!!(window.$&&window.$.fn&&window.$.fn.popover&&window.$.fn.modal),t("head").append('<script>(function(g,l,a,z,e,r){g[r] = function(){(g[r].q=g[r].q||[]).push(arguments)};g[r]("setHost", z);var s=l.createElement(a),el=l.getElementsByTagName(a)[0];s.src=z+e;el.parentNode.insertBefore(s,el);})(window,document,"script","'+f+'", "/js/builder.js","_glaze");</script>')}}})}e&&n.isFunction(e)&&e(o)},error:function(){i.reportInitTime("load_error")}})}}),define("jqueryUI",["require"],function(e){return{}}),define("utils/PostMessageManager",["require","jquery","underscore","utils/Logger","backbone"],function(e){var t=e("jquery"),n=e("underscore"),r=e("utils/Logger"),i=e("backbone"),s=i.Model.extend({initialize:function(){window.addEventListener("message",n.bind(this.receiveMessage,this))},receiveMessage:function(e){},youTubeCommand:function(e,t,n){e.contentWindow.postMessage(JSON.stringify({event:"command",func:t,args:n||[]}),"*")},vimeoCommand:function(e,t,n){e.contentWindow.postMessage(JSON.stringify({method:t,value:n||[]}),"*")},dailyMotionCommand:function(e,t,n){e.contentWindow.postMessage(JSON.stringify({command:t,parameters:n||[]}),"*")}});return new s}),define("utils/VideoPlayer",["require","jquery","underscore","backbone","utils/Logger","utils/PostMessageManager"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("utils/Logger"),s=e("utils/PostMessageManager");return r.Model.extend({parentView:null,queue:[],youtubePlayer:null,defaults:{type:"youtube",playing:null,paused:null,ready:!1},initialize:function(){r.Model.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:ready",n.bind(this.onReady,this))},start:function(e){this.parentView=e;switch(this.get("type")){case"youtube":this.initYouTubePlayer();break;case"vimeo":window.addEventListener("message",n.bind(this.initVimeoPlayer,this),!1);break;case"dm":window.addEventListener("message",n.bind(this.initDailyMotionPlayer,this),!1)}},command:function(e){if(!n.isFunction(this[e])){i.log("Glaze: video player command not found ("+e+")");return}this.get("ready")?this[e]():this.queue.push(e)},pause:function(){i.log("Glaze: video player pause");switch(this.get("type")){case"youtube":this.youtubePlayer.pauseVideo();break;case"vimeo":s.vimeoCommand(this.parentView.$("iframe")[0],"pause");break;case"dm":s.dailyMotionCommand(this.parentView.$("iframe")[0],"pause")}},play:function(){i.log("Glaze: video player play");switch(this.get("type")){case"youtube":this.youtubePlayer.playVideo();break;case"vimeo":s.vimeoCommand(this.parentView.$("iframe")[0],"play");break;case"dm":s.dailyMotionCommand(this.parentView.$("iframe")[0],"play")}},mute:function(){i.log("Glaze: video player mute");switch(this.get("type")){case"youtube":this.youtubePlayer.mute();break;case"vimeo":s.vimeoCommand(this.parentView.$("iframe")[0],"setVolume",[0]);break;case"dm":s.dailyMotionCommand(this.parentView.$("iframe")[0],"mute")}},unmute:function(){i.log("Glaze: video player unmute");switch(this.get("type")){case"youtube":this.youtubePlayer.unMute(),this.youtubePlayer.setVolume(100);break;case"vimeo":s.vimeoCommand(this.parentView.$("iframe")[0],"setVolume",[1]);break;case"dm":s.dailyMotionCommand(this.parentView.$("iframe")[0],"unmute")}},initYouTubePlayer:function(){if(!!window.onYouTubePlayerAPIReady){setTimeout(n.bind(this.youtubeApiReady,this),300);return}window.onYouTubePlayerAPIReady=n.bind(this.youtubeApiReady,this),function(){var e=document.createElement("script");e.src=(location.protocol=="https:"?"https":"http")+"://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},youtubeApiReady:function(){var e=this.parentView.$("iframe");e.attr("id",this.parentView.cid),this.youtubePlayer=new YT.Player(this.parentView.cid,{events:{onReady:n.bind(function(){this.set("ready",!0)},this),onStateChange:n.bind(this.onYouTubeStateChange,this)}})},initVimeoPlayer:function(e){if(!/^https?:\/\/player.vimeo.com/.test(e.origin))return!1;var t=JSON.parse(e.data);t.event=="ready"&&(this.set("ready",!0),s.vimeoCommand(this.parentView.$("iframe")[0],"addEventListener","pause"),s.vimeoCommand(this.parentView.$("iframe")[0],"addEventListener","finish"),s.vimeoCommand(this.parentView.$("iframe")[0],"addEventListener","playProgress")),t.event=="playProgress"&&(this.get("paused")&&this.unmute(),this.set({playing:!0,paused:!1})),t.event=="pause"&&this.set({playing:!1,paused:!0})},initDailyMotionPlayer:function(e){if(!/^https?:\/\/www.dailymotion.com/.test(e.origin))return!1;e.data&&e.data=="event=apiready"&&this.set("ready",!0),e.data&&e.data=="event=playing"&&(this.get("paused")&&this.unmute(),this.set({playing:!0,paused:!1})),e.data&&e.data=="event=pause"&&(this.get("paused")&&this.unmute(),this.set({playing:!1,paused:!0}))},onYouTubeStateChange:function(e){e.data==YT.PlayerState.PLAYING?(this.get("paused")&&this.unmute(),this.set({playing:!0,paused:!1})):e.data==YT.PlayerState.PAUSED&&this.set({playing:!1,paused:!0})},onReady:function(){i.log("Glaze: Video ready ("+this.get("type")+")"),n.each(this.queue,n.bind(function(e){this[e]()},this))}})}),function(){function e(e,t,n){return e.call.apply(e.bind,arguments)}function t(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function n(r,i,s){return n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?e:t,n.apply(null,arguments)}function i(e,t){this.F=e,this.k=t||e,this.H=this.k.document}function o(e,t,n){e=e.H.getElementsByTagName(t)[0],e||(e=document.documentElement),e.insertBefore(n,e.lastChild)}function u(e,t,n){t=t||[],n=n||[];for(var r=e.className.split(/\s+/),i=0;i<t.length;i+=1){for(var s=!1,o=0;o<r.length;o+=1)if(t[i]===r[o]){s=!0;break}s||r.push(t[i])}t=[];for(i=0;i<r.length;i+=1){s=!1;for(o=0;o<n.length;o+=1)if(r[i]===n[o]){s=!0;break}s||t.push(r[i])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function a(e,t){for(var n=e.className.split(/\s+/),r=0,i=n.length;r<i;r++)if(n[r]==t)return!0;return!1}function f(e){if("string"==typeof e.fa)return e.fa;var t=e.k.location.protocol;return"about:"==t&&(t=e.F.location.protocol),"https:"==t?"https:":"http:"}function l(e,t,n){function r(){f&&i&&u&&(f(a),f=null)}t=e.createElement("link",{rel:"stylesheet",href:t,media:"all"});var i=!1,u=!0,a=null,f=n||null;s?(t.onload=function(){i=!0,r()},t.onerror=function(){i=!0,a=Error("Stylesheet failed to load"),r()}):setTimeout(function(){i=!0,r()},0),o(e,"head",t)}function c(e,t,n,r){var i=e.H.getElementsByTagName("head")[0];if(i){var s=e.createElement("script",{src:t}),o=!1;return s.onload=s.onreadystatechange=function(){o||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(o=!0,n&&n(null),s.onload=s.onreadystatechange=null,"HEAD"==s.parentNode.tagName&&i.removeChild(s))},i.appendChild(s),setTimeout(function(){o||(o=!0,n&&n(Error("Script load timeout")))},r||5e3),s}return null}function h(){this.S=0,this.K=null}function p(e){return e.S++,function(){e.S--,v(e)}}function d(e,t){e.K=t,v(e)}function v(e){0==e.S&&e.K&&(e.K(),e.K=null)}function m(e){this.ea=e||"-"}function g(e,t){this.Q=e,this.M=4,this.L="n";var n=(t||"n4").match(/^([nio])([1-9])$/i);n&&(this.L=n[1],this.M=parseInt(n[2],10))}function y(e){return E(e)+" "+(e.M+"00")+" 300px "+b(e.Q)}function b(e){var t=[];e=e.split(/,\s*/);for(var n=0;n<e.length;n++){var r=e[n].replace(/['"]/g,"");-1!=r.indexOf(" ")||/^\d/.test(r)?t.push("'"+r+"'"):t.push(r)}return t.join(",")}function w(e){return e.L+e.M}function E(e){var t="normal";return"o"===e.L?t="oblique":"i"===e.L&&(t="italic"),t}function S(e){var t=4,n="n",r=null;return e&&((r=e.match(/(normal|oblique|italic)/i))&&r[1]&&(n=r[1].substr(0,1).toLowerCase()),(r=e.match(/([1-9]00|normal|bold)/i))&&r[1]&&(/bold/i.test(r[1])?t=7:/[1-9]00/.test(r[1])&&(t=parseInt(r[1].substr(0,1),10)))),n+t}function x(e,t){this.a=e,this.j=e.k.document.documentElement,this.O=t,this.f="wf",this.e=new m("-"),this.da=!1!==t.events,this.u=!1!==t.classes}function T(e){e.u&&u(e.j,[e.e.d(e.f,"loading")]),C(e,"loading")}function N(e){if(e.u){var t=a(e.j,e.e.d(e.f,"active")),n=[],r=[e.e.d(e.f,"loading")];t||n.push(e.e.d(e.f,"inactive")),u(e.j,n,r)}C(e,"inactive")}function C(e,t,n){e.da&&e.O[t]&&(n?e.O[t](n.getName(),w(n)):e.O[t]())}function k(){this.t={}}function L(e,t,n){var r=[],i;for(i in t)if(t.hasOwnProperty(i)){var s=e.t[i];s&&r.push(s(t[i],n))}return r}function A(e,t){this.a=e,this.h=t,this.m=this.a.createElement("span",{"aria-hidden":"true"},this.h)}function O(e,t){var n=e.m,r;r="display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(t.Q)+";"+("font-style:"+E(t)+";font-weight:"+(t.M+"00")+";"),n.style.cssText=r}function M(e){o(e.a,"body",e.m)}function _(e,t,n,r,i,s){this.G=e,this.J=t,this.g=r,this.a=n,this.v=i||3e3,this.h=s||void 0}function D(e,t,n,r,i,s,o){this.G=e,this.J=t,this.a=n,this.g=r,this.h=o||"BESbswy",this.s={},this.v=i||3e3,this.Z=s||null,this.D=this.C=this.A=this.w=null,this.w=new A(this.a,this.h),this.A=new A(this.a,this.h),this.C=new A(this.a,this.h),this.D=new A(this.a,this.h),O(this.w,new g(this.g.getName()+",serif",w(this.g))),O(this.A,new g(this.g.getName()+",sans-serif",w(this.g))),O(this.C,new g("serif",w(this.g))),O(this.D,new g("sans-serif",w(this.g))),M(this.w),M(this.A),M(this.C),M(this.D)}function B(){if(null===H){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);H=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return H}function j(e,t,n){for(var r in P)if(P.hasOwnProperty(r)&&t===e.s[P[r]]&&n===e.s[P[r]])return!0;return!1}function F(e){var t=e.w.m.offsetWidth,n=e.A.m.offsetWidth,i;(i=t===e.s.serif&&n===e.s["sans-serif"])||(i=B()&&j(e,t,n)),i?r()-e.ga>=e.v?B()&&j(e,t,n)&&(null===e.Z||e.Z.hasOwnProperty(e.g.getName()))?q(e,e.G):q(e,e.J):I(e):q(e,e.G)}function I(e){setTimeout(n(function(){F(this)},e),50)}function q(e,t){setTimeout(n(function(){this.w.remove(),this.A.remove(),this.C.remove(),this.D.remove(),t(this.g)},e),0)}function R(e,t,n){this.a=e,this.p=t,this.P=0,this.ba=this.Y=!1,this.v=n}function z(e){0==--e.P&&e.Y&&(e.ba?(e=e.p,e.u&&u(e.j,[e.e.d(e.f,"active")],[e.e.d(e.f,"loading"),e.e.d(e.f,"inactive")]),C(e,"active")):N(e.p))}function W(e){this.F=e,this.q=new k,this.$=0,this.T=this.U=!0}function X(e,t,r,i,s){var o=0==--e.$;(e.T||e.U)&&setTimeout(function(){var e=s||null,a=i||null||{};if(0===r.length&&o)N(t.p);else{t.P+=r.length,o&&(t.Y=o);var f,l=[];for(f=0;f<r.length;f++){var c=r[f],h=a[c.getName()],p=t.p,d=c;p.u&&u(p.j,[p.e.d(p.f,d.getName(),w(d).toString(),"loading")]),C(p,"fontloading",d),p=null,null===U&&(U=window.FontFace?(p=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(p[1],10):!0:!1),p=U?new _(n(t.V,t),n(t.W,t),t.a,c,t.v,h):new D(n(t.V,t),n(t.W,t),t.a,c,t.v,e,h),l.push(p)}for(f=0;f<l.length;f++)l[f].start()}},0)}function V(e,t,n){var r=[],i=n.timeout;T(t);var r=L(e.q,n,e.a),s=new R(e.a,t,i);e.$=r.length,t=0;for(n=r.length;t<n;t++)r[t].load(function(t,n,r){X(e,s,t,n,r)})}function $(e,t,n){this.N=e?e:t+J,this.o=[],this.R=[],this.ca=n||""}function K(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r].split(":");3==i.length&&e.R.push(i.pop());var s="";2==i.length&&""!=i[1]&&(s=":"),e.o.push(i.join(s))}}function Q(e){this.o=e,this.aa=[],this.I={}}function tt(e,t){this.a=e,this.c=t}function rt(e,t){this.a=e,this.c=t,this.X=[]}function it(e,t){this.a=e,this.c=t}function st(e,t){this.a=e,this.c=t}function ot(e,t){this.a=e,this.c=t}var r=Date.now||function(){return+(new Date)},s=!!window.FontFace;i.prototype.createElement=function(e,t,n){e=this.H.createElement(e);if(t)for(var r in t)t.hasOwnProperty(r)&&("style"==r?e.style.cssText=t[r]:e.setAttribute(r,t[r]));return n&&e.appendChild(this.H.createTextNode(n)),e},m.prototype.d=function(e){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.ea)},g.prototype.getName=function(){return this.Q},A.prototype.remove=function(){var e=this.m;e.parentNode&&e.parentNode.removeChild(e)},_.prototype.start=function(){function e(){r()-i>=n.v?n.J(n.g):t.fonts.load(y(n.g),n.h).then(function(t){1<=t.length?n.G(n.g):setTimeout(e,25)},function(){n.J(n.g)})}var t=this.a.k.document,n=this,i=r();e()};var P={ia:"serif",ha:"sans-serif"},H=null;D.prototype.start=function(){this.s.serif=this.C.m.offsetWidth,this.s["sans-serif"]=this.D.m.offsetWidth,this.ga=r(),F(this)};var U=null;R.prototype.V=function(e){var t=this.p;t.u&&u(t.j,[t.e.d(t.f,e.getName(),w(e).toString(),"active")],[t.e.d(t.f,e.getName(),w(e).toString(),"loading"),t.e.d(t.f,e.getName(),w(e).toString(),"inactive")]),C(t,"fontactive",e),this.ba=!0,z(this)},R.prototype.W=function(e){var t=this.p;if(t.u){var n=a(t.j,t.e.d(t.f,e.getName(),w(e).toString(),"active")),r=[],i=[t.e.d(t.f,e.getName(),w(e).toString(),"loading")];n||r.push(t.e.d(t.f,e.getName(),w(e).toString(),"inactive")),u(t.j,r,i)}C(t,"fontinactive",e),z(this)},W.prototype.load=function(e){this.a=new i(this.F,e.context||this.F),this.U=!1!==e.events,this.T=!1!==e.classes,V(this,new x(this.a,e),e)};var J="//fonts.googleapis.com/css";$.prototype.d=function(){if(0==this.o.length)throw Error("No fonts to load!");if(-1!=this.N.indexOf("kit="))return this.N;for(var e=this.o.length,t=[],n=0;n<e;n++)t.push(this.o[n].replace(/ /g,"+"));return e=this.N+"?family="+t.join("%7C"),0<this.R.length&&(e+="&subset="+this.R.join(",")),0<this.ca.length&&(e+="&text="+encodeURIComponent(this.ca)),e};var G={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},Y={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Z={i:"i",italic:"i",n:"n",normal:"n"},et=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;Q.prototype.parse=function(){for(var e=this.o.length,t=0;t<e;t++){var n=this.o[t].split(":"),r=n[0].replace(/\+/g," "),i=["n4"];if(2<=n.length){var s,o=n[1];s=[];if(o)for(var o=o.split(","),u=o.length,a=0;a<u;a++){var f;f=o[a];if(f.match(/^[\w-]+$/))if(f=et.exec(f.toLowerCase()),null==f)f="";else{var l;l=f[1];if(null==l||""==l)l="4";else{var c=Y[l];l=c?c:isNaN(l)?"4":l.substr(0,1)}f=f[2],f=[null==f||""==f?"n":Z[f],l].join("")}else f="";f&&s.push(f)}0<s.length&&(i=s),3==n.length&&(n=n[2],s=[],n=n?n.split(","):s,0<n.length&&(n=G[n[0]])&&(this.I[r]=n))}this.I[r]||(n=G[r])&&(this.I[r]=n);for(n=0;n<i.length;n+=1)this.aa.push(new g(r,i[n]))}};var nt={Arimo:!0,Cousine:!0,Tinos:!0};tt.prototype.load=function(e){var t=new h,n=this.a,r=new $(this.c.api,f(n),this.c.text),i=this.c.families;K(r,i);var s=new Q(i);s.parse(),l(n,r.d(),p(t)),d(t,function(){e(s.aa,s.I,nt)})},rt.prototype.B=function(e){var t=this.a;return f(this.a)+(this.c.api||"//f.fontdeck.com/s/css/js/")+(t.k.location.hostname||t.F.location.hostname)+"/"+e+".js"},rt.prototype.load=function(e){var t=this.c.id,n=this.a.k,r=this;t?(n.__webfontfontdeckmodule__||(n.__webfontfontdeckmodule__={}),n.__webfontfontdeckmodule__[t]=function(t,n){for(var i=0,s=n.fonts.length;i<s;++i){var o=n.fonts[i];r.X.push(new g(o.name,S("font-weight:"+o.weight+";font-style:"+o.style)))}e(r.X)},c(this.a,this.B(t),function(t){t&&e([])})):e([])},it.prototype.B=function(e){return(this.c.api||"https://use.typekit.net")+"/"+e+".js"},it.prototype.load=function(e){var t=this.c.id,n=this.a.k;t?c(this.a,this.B(t),function(t){if(t)e([]);else if(n.Typekit&&n.Typekit.config&&n.Typekit.config.fn){t=n.Typekit.config.fn;for(var r=[],i=0;i<t.length;i+=2)for(var s=t[i],o=t[i+1],u=0;u<o.length;u++)r.push(new g(s,o[u]));try{n.Typekit.load({events:!1,classes:!1,async:!0})}catch(a){}e(r)}},2e3):e([])},st.prototype.B=function(e,t){var n=f(this.a),r=(this.c.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return n+"//"+r+"/"+e+".js"+(t?"?v="+t:"")},st.prototype.load=function(e){function t(){if(i["__mti_fntLst"+n]){var r=i["__mti_fntLst"+n](),s=[],o;if(r)for(var u=0;u<r.length;u++){var a=r[u].fontfamily;void 0!=r[u].fontStyle&&void 0!=r[u].fontWeight?(o=r[u].fontStyle+r[u].fontWeight,s.push(new g(a,o))):s.push(new g(a))}e(s)}else setTimeout(function(){t()},50)}var n=this.c.projectId,r=this.c.version;if(n){var i=this.a.k;c(this.a,this.B(n,r),function(n){n?e([]):t()}).id="__MonotypeAPIScript__"+n}else e([])},ot.prototype.load=function(e){var t,n,r=this.c.urls||[],i=this.c.families||[],s=this.c.testStrings||{},o=new h;t=0;for(n=r.length;t<n;t++)l(this.a,r[t],p(o));var u=[];t=0;for(n=i.length;t<n;t++)if(r=i[t].split(":"),r[1])for(var a=r[1].split(","),f=0;f<a.length;f+=1)u.push(new g(r[0],a[f]));else u.push(new g(r[0]));d(o,function(){e(u,s)})};var ut=new W(window);ut.q.t.custom=function(e,t){return new ot(t,e)},ut.q.t.fontdeck=function(e,t){return new rt(t,e)},ut.q.t.monotype=function(e,t){return new st(t,e)},ut.q.t.typekit=function(e,t){return new it(t,e)},ut.q.t.google=function(e,t){return new tt(t,e)};var at={load:n(ut.load,ut)};"function"==typeof define&&define.amd?define("webfontloader",[],function(){return at}):"undefined"!=typeof module&&module.exports?module.exports=at:(window.WebFont=at,window.WebFontConfig&&ut.load(window.WebFontConfig))}(),define("utils/FontLoader",["require","underscore","Settings","webfontloader"],function(e){var t=e("underscore"),n=e("Settings"),r=e("webfontloader"),i={loadedFonts:{common:[],custom:[]},loadFonts:function(e,i){e=e||[],t.isArray(e)||(e=[e]),e=t.difference(e,n.excludedFonts),e=t.difference(e,this.loadedFonts.common),e.length&&(r.load({google:{families:e}}),t.each(e,t.bind(function(e){this.loadedFonts.common.push(e)},this)))},loadCustomFont:function(e){if(this.loadedFonts.custom.indexOf(e)===-1)if(!n.cdnHost)$("head").append('<link rel="stylesheet" type="text/css" href="'+n.apiHost+"/api/fonts/"+e+'">');else{var t="fonts";n.environment!=="prod"&&n.environment!=="production"&&(t=n.environment+"-"+t),$("head").append('<link rel="stylesheet" type="text/css" href="'+n.cdnHost+"/"+t+"/font-"+e+'.css">'),this.loadedFonts.custom.push(e)}}};return i}),define("view/ElementView",["require","jquery","underscore","backbone","Settings","jqueryUI","utils/PostMessageManager","utils/TrackingManager","utils/VideoPlayer","utils/Logger","utils/FontLoader","AppModel"],function(require){var $=require("jquery"),_=require("underscore"),Backbone=require("backbone"),Settings=require("Settings"),jqueryUI=require("jqueryUI"),PostMessageManager=require("utils/PostMessageManager"),TrackingManager=require("utils/TrackingManager"),VideoPlayer=require("utils/VideoPlayer"),Logger=require("utils/Logger"),FontLoader=require("utils/FontLoader");return Backbone.View.extend({attributes:function(){var e=JSON.parse(this.model.get("settings")||"{}");return{"class":"glaze-element reset-this glaze-exclude"+(this.model.get("is_centered")?" centered":"")+(e.flipped?" flipped":"")}},videoPlayer:null,appData:null,events:{click:"clickHandle",mouseover:"rollover",mouseout:"rollout"},initialize:function(e){e=e||{},_.extend(this,e),this.appData=require("AppModel"),this.model.get("settings")&&this.model.set("settings",JSON.parse(this.model.get("settings"))),Backbone.View.prototype.initialize.apply(this,arguments)},render:function(){var e=this.model.get("content").replace('id="title-trick"','id="'+this.parent.attributes["aria-labelledby"]+'"');return this.model.get("type")==="video"?this.$el.html(e+'<span class="element-close js-close"><span class="glyphicon glyphicon-remove glaze-exclude"></span></span>'):this.$el.html(e),this.$el.addClass("glz-el-"+this.model.get("type")),this.setStyles(),this},setStyles:function(){if(this.model.get("style")){var e=JSON.parse(this.model.get("style"));this.$el.css(_.omit(e,"fontFamily")),e.fontFamily&&(this.$el.css({fontFamily:e.fontFamily.family}),e.fontFamily.customId?FontLoader.loadCustomFont(e.fontFamily.customId):FontLoader.loadFonts([e.fontFamily.family]))}this.model.get("z_index")&&this.$el.css({zIndex:this.model.get("z_index")}),this.model.get("settings")&&this.model.get("settings").inEffect&&this.model.get("settings").inEffect==="fade"&&(this.$el.hide(),setTimeout(_.bind(function(){this.$el.fadeIn(Number(this.model.get("settings").inDuration))},this),Number(this.model.get("settings").inDelay))),this.model.get("type")==="x"&&this.$el.css({cursor:"pointer"}),this.model.get("type")==="clipart"&&this.$el.find("i").attr("aria-hidden","true")},initControls:function(){var e=JSON.parse(this.model.get("style"));e.width&&(this.model.get("type")=="image"?this.$("img").css({width:"100%"}):this.model.get("type")=="embed"?(this.$("iframe").attr("width",e.width),this.$("iframe").attr("height",e.height)):this.model.get("type")=="video"&&(this.$("iframe").attr("width",e.width),this.$("iframe").attr("height",e.height))),this.model.get("settings")&&this.model.get("settings").outEffect&&this.model.get("settings").outEffect=="fade"&&this.model.get("settings").outDelay&&setTimeout(_.bind(function(){this.$el.fadeOut(Number(this.model.get("settings").outDuration))},this),Number(this.model.get("settings").outDelay)),this.model.get("type")=="video"&&(this.videoPlayer=new VideoPlayer(this.model.get("settings")),this.videoPlayer.start(this))},start:function(){this.$el.html(this.prepareContent(this.$el.html()));var e=this.model.get("settings")||{};this.model.get("type")=="video"&&(e.sound?this.videoPlayer.command("unmute"):this.videoPlayer.command("mute"),e.autoplay&&this.videoPlayer.command("play"))},updatePosition:function(){var e=this.parent.model.get("variant").get("bindingType"),t=this.parent.model.get("variant").getXpath(0),n=this.parent.model.get("variant").getSelector(0),r=this.model.get("settings")||{},i=JSON.parse(this.model.get("style")),s=JSON.parse(this.model.get("position"));if(this.$el.hasClass("glaze-nestle-video"))return;if(this.model.get("is_centered")&&this.model.get("is_centered")!=0)i.position==="fixed"?(i.left=0,i.top="auto",i.marginLeft=0,i.marginTop=$(window).height()/2-this.$el.height()/2):(i.left=0,i.marginLeft=0,i.marginTop=0),i=_.pick(i,"left","top","marginLeft","marginTop"),this.$el.css(i);else if(t||n||this.parent.rolledElement){var o=this.rolledElement||(n?$(n).get(0):document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),u=$(o),a=u.offset();if(!u.length)return;r.shapeOrigin==="tr"&&(a.left+=u.outerWidth()),r.shapeOrigin==="bl"&&(a.top+=u.outerHeight()),r.shapeOrigin==="br"&&(a.top+=u.outerHeight(),a.left+=u.outerWidth()),r.positionOrigin==="tr"&&(a.left-=this.$el.outerWidth()),r.positionOrigin==="bl"&&(a.top-=this.$el.outerHeight()),r.positionOrigin==="br"&&(a.top-=this.$el.outerHeight(),a.left-=this.$el.outerWidth()),i.position==="fixed"?(i.marginLeft=a.left+(s&&s.left?s.left:0),i.marginTop=a.top+(s&&s.top?s.top:0),i.left="auto",i.top="auto",i=_.pick(i,"left","top","marginLeft","marginTop")):(i.left=a.left+(s&&s.left?s.left:0),i.top=a.top+(s&&s.top?s.top:0),i=_.pick(i,"left","top")),parseInt(i.left)<0&&(i.left=0),parseInt(i.left)>0&&this.$el.outerWidth()+parseInt(i.left)>$(window).width()&&(i.left=$(window).width()-this.$el.outerWidth()),this.$el.css(i)}},clickHandle:function(event){var settings=this.model.get("settings")||{},converted=!1;event&&event.stopPropagation();if(this.model.get("type")==="x"){converted=TrackingManager.checkEngagementConversion(this.parent.model.get("id"),"inserted_element",this.model),this.parent.hideGlaze(null,converted);return}if($(event.target).hasClass("js-close")||$(event.target).parents(".js-close").length){this.$el.removeClass("glaze-nestle-video"),this.$("iframe").attr("width",this.videoWidth),this.$("iframe").attr("height",this.videoHeight);var style=JSON.parse(this.model.get("style"));this.$el.css(style),this.videoPlayer.command("pause");return}this.model.get("is_tracked")!=0?converted=TrackingManager.checkEngagementConversion(this.parent.model.get("id"),"inserted_element",this.model):Logger.log("Glaze: element clicked, but tracking is disabled");var cb=this.parent.parent.openGlazeById,context=this.parent.parent;if(settings.actionType)if(settings.actionType==="url")if(settings.actionUrlBlank){var win=window.open(settings.actionUrl,"_blank");win.focus()}else window.location.href=settings.actionUrl;else if(settings.actionType==="glaze")settings.actionGlazeTransition&&settings.actionGlazeTransition==="smooth"?this.parent.smoothTransitionGlaze(settings.actionGlaze):this.parent.hideGlaze(function(){cb.call(context,settings.actionGlaze,!0)},converted);else if(settings.actionType==="close")this.parent.hideGlaze(null,converted);else if(settings.actionType==="close_campaign")this.parent.hideGlaze(null,converted,{forceClose:!0});else if(settings.actionType==="js")try{event&&event.preventDefault(),eval(settings.actionJs),setTimeout(_.bind(function(){this.parent.hideGlaze(null,converted)},this),1e3)}catch(err){console.warn("Error in Custom Javasctipt Action on click element"),console.warn(err)}($(event.target).attr("data-close-glaze")||$(event.target).parents("[data-close-glaze]").length)&&this.parent.hideGlaze(null,!1);var glazeToTransition,transitionType=$(event.target).attr("data-transition-type")||"smooth";if($(event.target).attr("data-transition")==="next"||$(event.target).parents('[data-transition="next"]').length)glazeToTransition=this.parent.appData.getNextGlaze(this.parent.model.get("id")),glazeToTransition&&(transitionType==="smooth"?this.parent.smoothTransitionGlaze(glazeToTransition.id):this.parent.hideGlaze(function(){cb.call(context,glazeToTransition.id,!0)},converted));if($(event.target).attr("data-transition")==="prev"||$(event.target).parents('[data-transition="prev"]').length)glazeToTransition=this.parent.appData.getPrevGlaze(this.parent.model.get("id")),transitionType==="smooth"?this.parent.smoothTransitionGlaze(glazeToTransition.id):this.parent.hideGlaze(function(){cb.call(context,glazeToTransition.id,!0)},converted)},rollover:function(e){var t=this.model.get("settings")||{};if(!t.rolloverEnabled)return;t.rolloverStyle&&this.$el.css(t.rolloverStyle)},rollout:function(e){var t=JSON.parse(this.model.get("style"));t.left=this.$el.css("left"),t.top=this.$el.css("top"),this.model.get("is_centered")&&this.model.get("is_centered")!=0&&(t=_.omit(t,"top","left","marginTop","marginLeft")),t=_.omit(t,"fontFamily"),this.$el.css(t)},onGlazeHide:function(){if(this.model.get("type")=="video"){var e=this.$("iframe");if(!e.length)return;if(this.model.get("settings").nestle&&this.videoPlayer.get("playing")){this.videoWidth=this.$("iframe").width(),this.videoHeight=this.$("iframe").height(),this.$el.css({top:0,left:0}),this.$el.addClass("glaze-nestle-video"),this.$("iframe").attr("width","100%"),this.$("iframe").attr("height","100%");return}switch(this.model.get("settings").type){case"youtube":PostMessageManager.youTubeCommand(e[0],"pauseVideo");break;case"vimeo":PostMessageManager.vimeoCommand(e[0],"pause");break;case"dm":PostMessageManager.dailyMotionCommand(e[0],"pause")}}this.$el.hide()},onGlazeShow:function(){this.$el.show();if(this.model.get("type")=="video"){var e=this.$("iframe");if(!e.length)return;if(this.model.get("settings").nestle){this.$el.removeClass("glaze-nestle-video"),this.$("iframe").attr("width",this.videoWidth),this.$("iframe").attr("height",this.videoHeight);var t=JSON.parse(this.model.get("style"));this.$el.css(t);return}switch(this.model.get("settings").type){case"youtube":PostMessageManager.youTubeCommand(e[0],"playVideo");break;case"vimeo":PostMessageManager.vimeoCommand(e[0],"play");break;case"dm":PostMessageManager.dailyMotionCommand(e[0],"play")}}},isVisible:function(){var e=JSON.parse(this.model.get("style")),t=e.position==="fixed";if(t){var n=this.$el[0].getBoundingClientRect(),r=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(n.bottom<0||n.top-r>=0)&&!(n.left<0)}var i=this.$el.offset().top,s=this.$el.offset().top+this.$el.outerHeight(),o=$(window).scrollTop()+$(window).innerHeight(),u=$(window).scrollTop();return o>i&&u<s},prepareContent:function(content){var placeholders=content.match(/\{[^\}]+\}/gi);if(!placeholders||!placeholders.length||!this.appData.get("website").page_templates||!this.appData.get("website").page_templates.length)return content;var selectors=_.reduce(this.appData.get("website").page_templates,function(e,t){return!t.selectors||!t.selectors.length?e:(_.each(t.selectors,function(t){e.push(t)}),e)},[]);return _.each(placeholders,_.bind(function(placeholder){var selector=_.find(selectors,function(e){return"{"+e.name+"}"===placeholder});if(selector){var text="";if(selector.type==="JavaScript"){selector.code=selector.code.replace("~HIGHLIGHTED_ELEMENT~",this.parent.model.get("variant").getSelector(0));try{text=eval(selector.code)}catch(e){console.warn("Error in Selector"),console.warn(selector.code),console.warn(err)}content=content.replace(placeholder,text)}if(selector.type==="CSS"){var $el=$(selector.code);$el.length?text=$el.html():Logger.log("Glaze: placeholder selector element not found: "+selector.code),content=content.replace(placeholder,text)}}},this)),content},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}})}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.14",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="﻿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!view/GlazeView.html",[],function(){return'<div role="document">\r\n    <div class="glaze-elements glaze-exclude"></div>\r\n\r\n    <% if(data.model.get(\'variant\').get(\'shape_id\') !== -1) { %>\r\n        <% if(settings.a11y_shape_btn_no_interaction) { %>\r\n            <div class="glaze-shape-button no-interaction">\r\n                <span class="sr-only"><%= settings.a11y_shape_btn_text ||  "Enregistrer l\'offre d\'emploi dans MEMO (Ouvre une fenêtre popup)" %></span>\r\n            </div>\r\n        <% } else { %>\r\n            <button class="glaze-shape-button">\r\n                <span class="sr-only"><%= settings.a11y_shape_btn_text ||  "Enregistrer l\'offre d\'emploi dans MEMO (Ouvre une fenêtre popup)" %></span>\r\n            </button>\r\n        <% } %>\r\n    <% } %>\r\n    <div class="glaze-wrapper glaze-exclude">\r\n        <canvas id="canvas-shape-<%= data.cid %>" class="glaze-exclude"></canvas>\r\n    </div>\r\n\r\n    <% if(settings.close_click_x) { %>\r\n        <button type="button" class="close glaze-exclude" style="<% if(settings.close_click_x_opacity) { %>opacity:<%= settings.close_click_x_opacity %>; <% } %><%= settings.x_image_css %>">\r\n            <% if(settings.x_image) { %>\r\n                <img src="<%= settings.x_image %>" alt="" class="x-close-icon glaze-exclude" aria-hidden="true" />\r\n            <% } else { %>\r\n                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n                     viewBox="0 0 174.239 174.239" xml:space="preserve"\r\n                     width="16" height="16" aria-hidden="true" class="glaze-exclude">\r\n                    <path style="<% if(settings.close_click_x_color) { %>fill:<%= settings.close_click_x_color %>;<% } %>" d="M146.537,1.047c-1.396-1.396-3.681-1.396-5.077,0L89.658,52.849c-1.396,1.396-3.681,1.396-5.077,0L32.78,1.047\r\n                        c-1.396-1.396-3.681-1.396-5.077,0L1.047,27.702c-1.396,1.396-1.396,3.681,0,5.077l51.802,51.802c1.396,1.396,1.396,3.681,0,5.077\r\n                        L1.047,141.46c-1.396,1.396-1.396,3.681,0,5.077l26.655,26.655c1.396,1.396,3.681,1.396,5.077,0l51.802-51.802\r\n                        c1.396-1.396,3.681-1.396,5.077,0l51.801,51.801c1.396,1.396,3.681,1.396,5.077,0l26.655-26.655c1.396-1.396,1.396-3.681,0-5.077\r\n                        l-51.801-51.801c-1.396-1.396-1.396-3.681,0-5.077l51.801-51.801c1.396-1.396,1.396-3.681,0-5.077L146.537,1.047z"/>\r\n                </svg>\r\n                <span class="sr-only">Fermer l\'astuce</span>\r\n            <% } %>\r\n        </button>\r\n    <% } %>\r\n</div>\r\n'}),define("utils/ConditionChecker",["require","jquery","underscore","cookie","utils/TrackingManager","mobiledetect","utils/Logger","utils/MiscUtils","uri","AppModel","AppModel"],function(require){var $=require("jquery"),_=require("underscore"),Cookie=require("cookie"),TrackingManager=require("utils/TrackingManager"),mobiledetect=require("mobiledetect"),Logger=require("utils/Logger"),md=new mobiledetect(window.navigator.userAgent),MiscUtils=require("utils/MiscUtils"),URI=require("uri"),ConditionChecker={checkCondition:function(e){if(e.deferred)return!0;if(!_.isFunction(this[e.type]))return Logger.log('Glaze: no handler for condition type "'+e.type+'" found!'),!0;var t=this[e.type].call(this,e);return t},checkDeferredCondition:function(e,t){_.isFunction(this[e.type])?this[e.type].call(this,e,t):(Logger.log('Glaze: no handler for deferred condition type "'+e.type+'" found!'),t.trigger("releaseDeferredCondition",e))},campaign:function(e){var t=TrackingManager.hasSeenCampaign(e.value);return e.action==="isNot"&&(t=!t),t},ad:function(e){if(e.action==="seen")return TrackingManager.isImpressed(e.value)||0;if(e.action==="converted")return TrackingManager.isConverted(e.value);if(e.action==="not_converted")return!TrackingManager.isConverted(e.value)},browser:function(e){var t=!0;switch(e.value){case"ff":t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;break;case"ie":t=!!detectIE();break;case"ie8":t=detectIE()==8;break;case"ie9":t=detectIE()==9;break;case"ie10":t=detectIE()==10;break;case"ie11":t=detectIE()==11;break;case"ie13":t=detectIE()==13;break;case"ie14":t=detectIE()==14;break;case"sf":t=!!safariVersion();break;case"sf6":t=safariVersion()==6;break;case"sf7":t=safariVersion()==7;break;case"sf8":t=safariVersion()==8;break;case"gc":t=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;break;case"op":t=!!window.opera;break;case"uc":(function(e){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))t=!0})(navigator.userAgent||navigator.vendor||window.opera)}return e.action==="isNot"&&(t=!t),t},device:function(e){var t=!0;switch(e.value){case"ipad":t=md.is("iPad");break;case"iphone":t=md.is("iPhone");break;case"mobile":t=!!md.phone();break;case"tablet":t=!!md.tablet();break;case"desktop":t=!md.tablet()&&!md.phone()}return e.action==="isNot"&&(t=!t),t},cookie:function(e){var t=!1,n=Cookie.getJSON();return n&&_.each(n,function(n,r){var i,s;switch(e.name_match){case"equals":i=r==e.name;break;case"contains":i=r.match(e.name);break;case"matches":i=r.match(e.name)}switch(e.value_match){case"equals":s=n==e.value;break;case"contains":s=n.match(e.value);break;case"matches":s=n.match(e.value);break;case"anyvalue":s=!!n}i&&s&&(t=!0)}),e.action==="isNot"&&(t=!t),t},"custom-event":function(e){return!0},"custom-js":function(condition){var pass=!0;if(!condition.products||!condition.products.length)try{pass=eval(condition.name)}catch(e){}else try{pass=_.some(condition.products,function(item){var replacements=[{placeholder:"{PRODUCT.PID}",value:item.pid},{placeholder:"{PRODUCT.SKU}",value:item.sku},{placeholder:"{PRODUCT.CATEGORY_ID}",value:item.category_guid},{placeholder:"{PRODUCT.NAME}",value:item.name},{placeholder:"{PRODUCT.VENDOR}",value:item.vendor}],contitionCode=condition.name;return _.each(replacements,function(e){contitionCode=contitionCode.replace(e.placeholder,e.value)}),eval(contitionCode)})}catch(e){}return pass},"custom-tags":function(e){return!0},ip:function(e){var t=require("AppModel"),n=t.get("settings").ip,r,i;return e.value=e.value.replace("\r","").split("\n"),r=_.some(e.value,function(t){var r;switch(e.match){case"equals":r=t==n;break;case"prefix":i=new RegExp("^"+t,"i"),r=n.match(i);break;case"regexp":r=n.match(t);break;case"cidr":var s=cidrToRange(t);r=ip2num(n)>=ip2num(s[0])&&ip2num(n)<=ip2num(s[1])}return r}),r},language:function(e){var t=window.navigator.languages&&window.navigator.languages[0].toLowerCase(),n=!0;return t&&(n=t.match(e.value)),n},session_storage:function(e){if(!window.sessionStorage)return!1;var t=!0;switch(e.match){case"equals":t=window.sessionStorage[e.name]===e.value;break;case"contains":t=window.sessionStorage[e.name].match(e.value);break;case"matches":t=window.sessionStorage[e.name].match(e.value);break;case"anyvalue":t=!!window.sessionStorage[e.name]}return t},session:function(e){var t=TrackingManager.pagesVisited()>1;return e.value==="new"&&(t=!t),t},os:function(e){var t=!1,n=md.version("Android")&&parseFloat(md.version("Android")).toFixed(1);switch(e.value){case"any-mobile":t=md.tablet()||md.phone();break;case"any-desktop":t=!md.tablet()&&!md.phone();break;case"ios":t=!!md.version("iOS");break;case"ios6":t=md.version("iOS")&&parseInt(md.version("iOS"),10)==6;break;case"ios7":t=md.version("iOS")&&parseInt(md.version("iOS"),10)==7;break;case"ios8":t=md.version("iOS")&&parseInt(md.version("iOS"),10)==8;break;case"android":t=!!n;break;case"andr23":t=n=="2.3";break;case"andr40":t=n=="4.0";break;case"andr4143":t=n=="4.1"||n=="4.2"||n=="4.3";break;case"andr44":t=n=="4.4";break;case"andr50":t=n>="5.0";break;case"win-phone":t=!!md.version("Windows Phone");break;case"blackberry":t=!!md.version("BlackBerry");break;case"win":t=navigator.platform.toUpperCase().indexOf("WIN")>=0;break;case"win7":t=md.version("Windows NT")=="6.1";break;case"win8":t=md.version("Windows NT")=="6.2";break;case"win10":t=md.version("Windows NT")=="10.0";break;case"osx":t=navigator.platform.toUpperCase().indexOf("MAC")>=0;break;case"osx6":t=/Mac OS X 10_6/.test(window.navigator.userAgent)||/Mac OS X 10\.6/.test(window.navigator.userAgent);break;case"osx7":t=/Mac OS X 10_7/.test(window.navigator.userAgent);break;case"osx8":t=/Mac OS X 10_8/.test(window.navigator.userAgent);break;case"osx9":t=/Mac OS X 10_9/.test(window.navigator.userAgent);break;case"osx10":t=/Mac OS X 10_10/.test(window.navigator.userAgent)}return e.action=="isNot"&&(t=!t),t},"query-params":function(e){var t=getParameterByName(e.name)==e.value;return e.action=="isNot"&&(t=!t),t},referrer:function(e){var t=document.referrer,n=!1;switch(e.match){case"simple":n=t==e.name;break;case"contains":n=!!t.match(e.name);break;case"matches":n=!!t.match(e.name);break;case"anyvalue":n=!!t.match(e.name)}return n},"traffic-source":function(e){var t=!1,n=document.referrer;switch(e.value){case"campaign":t=!0;break;case"search":t=n.match("google")||n.match("yahoo")||n.match("msn")||n.match("bing");break;case"ref":t=!0;break;case"direct":t=n==""}return t},time:function(e){var t=!0,n=new Date,r=n.getMonth()+"/"+n.getDate()+"/"+n.getFullYear()+" ",i=n.getHours()+":"+n.getMinutes(),s=n.getDay();return e["time-from"]&&(t=Date.parse(r+i)>=Date.parse(r+e["time-from"])),e["time-to"]&&(t=Date.parse(r+i)<=Date.parse(r+e["time-to"])),e["day"]!=""&&(t=t&&_.find(e.day,function(e){return e==s})),t},scrolling:function(e,t){var n=function(n){$(window).scrollTop()>=$(document).height()*parseInt(e.value)/100&&(t.trigger("releaseDeferredCondition",e),$(window).off("scroll.glazecondition"))};$(window).on("scroll.glazecondition",n)},"copy-text":function(e,t){var n=function(n){var r=$(e.name).eq(0),i="";window.getSelection?i=window.getSelection().toString():document.selection&&document.selection.type!="Control"&&(i=document.selection.createRange().text),i=i.toLowerCase();if(r.length){var s=Number(MiscUtils.similarity(r.text().toLowerCase(),i))*100;s>Number(e.value)&&(t.trigger("releaseDeferredCondition",e),$(window).off("copy.glazecondition"))}};$(window).on("copy.glazecondition",n)},"opened-pages":function(e){return TrackingManager.pagesVisited()>=parseInt(e.value)},"visited-page":function(e){return TrackingManager.isPageVisited(e.name,e.match)},"not-visit-page":function(e){return!TrackingManager.visitedPageRecentTime(e.name,e.match,e.date)},"browse-time":function(e){return TrackingManager.checkBrowseTime(e.value)},"ad-campaign":function(e){var t,n=new URI(window.location.href),r=n.getQueryParamValue(e.name);switch(e.match){case"equals":t=r===e.value;break;case"contains":t=r.match(e.value);break;case"matches":t=r.match(e.value);break;case"anyvalue":t=!!r}return e.action==="isNot"&&(t=!t),t},location:function(e,t){var n=require("AppModel"),r=n.get("geo");return r&&_.some(e.locations,_.bind(function(e){if(e.country_short!==r.country_short&&e.country_full!==r.country_full)return!1;if(e.city_short)if(e.city_short===r.city_full||e.city_full===r.city_full)return!0;if(e.lat&&e.lng&&r.lat&&r.lng){var t=this.checkLocationDistance(e.lat,e.lng,r.lat,r.lng);if(t<25)return!0}return!1},this))},checkLocationDistance:function(e,t,n,r){var i=.017453292519943295,s=Math.cos,o=.5-s((n-e)*i)/2+s(e*i)*s(n*i)*(1-s((r-t)*i))/2;return 12742*Math.asin(Math.sqrt(o))}},getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))},ip2num=function(e){var t=e.split(".");return((+t[0]*256+ +t[1])*256+ +t[2])*256+ +t[3]},cidrToRange=function(e){var t=[2];e=e.split("/");var n=ip2long(e[0]);return t[0]=long2ip(n),t[1]=long2ip(Math.pow(2,32-e[1])+n-1),t},detectIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var n=e.indexOf("Trident/");if(n>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var i=e.indexOf("Edge/");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):!1},iOSversion=function(){return/iPad|iPhone|iPod/.test(navigator.platform)?window.indexedDB?"iOS 8":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":!!window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":!1},safariVersion=function(){var e=/^((?!chrome).)*safari/i.test(navigator.userAgent),t;return e?(t=navigator.userAgent.substr(navigator.userAgent.lastIndexOf("Safari/")+7,7),t):!1};return ConditionChecker});var fabric=fabric||{version:"2.4.3"};typeof exports!="undefined"?exports.fabric=fabric:typeof define=="function"&&define.amd&&define("fabric",[],function(){return fabric}),typeof document!="undefined"&&typeof window!="undefined"&&(fabric.document=document,fabric.window=window),fabric.isTouchSupported="ontouchstart"in fabric.window,fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.arcToSegmentsCache={},fabric.boundsOfCurveCache={},fabric.cachesBoundsOfCurve=!0,fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize))return console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize});if(fabric.Canvas2dFilterBackend)return new fabric.Canvas2dFilterBackend},typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=fabric),function(){function e(e,t){if(!this.__eventListeners[e])return;var n=this.__eventListeners[e];t?n[n.indexOf(t)]=!1:fabric.util.array.fill(n,!1)}function t(e,t){this.__eventListeners||(this.__eventListeners={});if(arguments.length===1)for(var n in e)this.on(n,e[n]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this}function n(t,n){if(!this.__eventListeners)return;if(arguments.length===0)for(t in this.__eventListeners)e.call(this,t);else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)e.call(this,r,t[r]);else e.call(this,t,n);return this}function r(e,t){if(!this.__eventListeners)return;var n=this.__eventListeners[e];if(!n)return;for(var r=0,i=n.length;r<i;r++)n[r]&&n[r].call(this,t||{});return this.__eventListeners[e]=n.filter(function(e){return e!==!1}),this}fabric.Observable={observe:t,stopObserving:n,fire:r,on:t,off:n,trigger:r}}(),fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,n){var r=this._objects;return n?r[t]=e:r.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){var e=this._objects,t,n=!1;for(var r=0,i=arguments.length;r<i;r++)t=e.indexOf(arguments[r]),t!==-1&&(n=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[r]));return this.renderOnAddRemove&&n&&this.requestRenderAll(),this},forEachObject:function(e,t){var n=this.getObjects();for(var r=0,i=n.length;r<i;r++)e.call(t,n[r],r,n);return this},getObjects:function(e){return typeof e=="undefined"?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(e){return this._objects.indexOf(e)>-1},complexity:function(){return this._objects.reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}},fabric.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){e&&e.colorStops&&!(e instanceof fabric.Gradient)&&this.set(t,new fabric.Gradient(e))},_initPattern:function(e,t,n){!e||!e.source||e instanceof fabric.Pattern?n&&n():this.set(t,new fabric.Pattern(e,n))},_initClipping:function(e){if(!e.clipTo||typeof e.clipTo!="string")return;var t=fabric.util.getFunctionBody(e.clipTo);typeof t!="undefined"&&(this.clipTo=new Function("ctx",t))},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return typeof e=="object"?this._setObject(e):typeof t=="function"&&e!=="clipTo"?this._set(e,t(this.get(e))):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this},get:function(e){return this[e]}},function(e){var t=Math.sqrt,n=Math.atan2,r=Math.pow,i=Math.abs,s=Math.PI/180,o=Math.PI/2;fabric.util={cos:function(e){if(e===0)return 1;e<0&&(e=-e);var t=e/o;switch(t){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(e===0)return 0;var t=e/o,n=1;e<0&&(n=-1);switch(t){case 1:return n;case 2:return 0;case 3:return-n}return Math.sin(e)},removeFromArray:function(e,t){var n=e.indexOf(t);return n!==-1&&e.splice(n,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*s},radiansToDegrees:function(e){return e/s},rotatePoint:function(e,t,n){e.subtractEquals(t);var r=fabric.util.rotateVector(e,n);return(new fabric.Point(r.x,r.y)).addEquals(t)},rotateVector:function(e,t){var n=fabric.util.sin(t),r=fabric.util.cos(t),i=e.x*r-e.y*n,s=e.x*n+e.y*r;return{x:i,y:s}},transformPoint:function(e,t,n){return n?new fabric.Point(t[0]*e.x+t[2]*e.y,t[1]*e.x+t[3]*e.y):new fabric.Point(t[0]*e.x+t[2]*e.y+t[4],t[1]*e.x+t[3]*e.y+t[5])},makeBoundingBoxFromPoints:function(e){var t=[e[0].x,e[1].x,e[2].x,e[3].x],n=fabric.util.array.min(t),r=fabric.util.array.max(t),i=r-n,s=[e[0].y,e[1].y,e[2].y,e[3].y],o=fabric.util.array.min(s),u=fabric.util.array.max(s),a=u-o;return{left:n,top:o,width:i,height:a}},invertTransform:function(e){var t=1/(e[0]*e[3]-e[1]*e[2]),n=[t*e[3],-t*e[1],-t*e[2],t*e[0]],r=fabric.util.transformPoint({x:e[4],y:e[5]},n,!0);return n[4]=-r.x,n[5]=-r.y,n},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e,t){var n=/\D{0,2}$/.exec(e),r=parseFloat(e);t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(n[0]){case"mm":return r*fabric.DPI/25.4;case"cm":return r*fabric.DPI/2.54;case"in":return r*fabric.DPI;case"pt":return r*fabric.DPI/72;case"pc":return r*fabric.DPI/72*12;case"em":return r*t;default:return r}},falseFunction:function(){return!1},getKlass:function(e,t){return e=fabric.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),fabric.util.resolveNamespace(t)[e]},getSvgAttributes:function(e){var t=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":t=t.concat(["offset","stop-color","stop-opacity"])}return t},resolveNamespace:function(t){if(!t)return fabric;var n=t.split("."),r=n.length,i,s=e||fabric.window;for(i=0;i<r;++i)s=s[n[i]];return s},loadImage:function(e,t,n,r){if(!e){t&&t.call(n,e);return}var i=fabric.util.createImage(),s=function(){t&&t.call(n,i),i=i.onload=i.onerror=null};i.onload=s,i.onerror=function(){fabric.log("Error loading "+i.src),t&&t.call(n,null,!0),i=i.onload=i.onerror=null},e.indexOf("data")!==0&&r&&(i.crossOrigin=r),e.substring(0,14)==="data:image/svg"&&(i.onload=null,fabric.util.loadImageInDom(i,s)),i.src=e},loadImageInDom:function(e,t){var n=fabric.document.createElement("div");n.style.width=n.style.height="1px",n.style.left=n.style.top="-100%",n.style.position="absolute",n.appendChild(e),fabric.document.querySelector("body").appendChild(n),e.onload=function(){t(),n.parentNode.removeChild(n),n=null}},enlivenObjects:function(e,t,n,r){function i(){++o===u&&t&&t(s)}e=e||[];var s=[],o=0,u=e.length;if(!u){t&&t(s);return}e.forEach(function(e,t){if(!e||!e.type){i();return}var o=fabric.util.getKlass(e.type,n);o.fromObject(e,function(n,o){o||(s[t]=n),r&&r(e,n,o),i()})})},enlivenPatterns:function(e,t){function n(){++i===s&&t&&t(r)}e=e||[];var r=[],i=0,s=e.length;if(!s){t&&t(r);return}e.forEach(function(e,t){e&&e.source?new fabric.Pattern(e,function(e){r[t]=e,n()}):(r[t]=e,n())})},groupSVGElements:function(e,t,n){var r;return e&&e.length===1?e[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),r=new fabric.Group(e,t),typeof n!="undefined"&&(r.sourcePath=n),r)},populateWithProperties:function(e,t,n){if(n&&Object.prototype.toString.call(n)==="[object Array]")for(var r=0,i=n.length;r<i;r++)n[r]in e&&(t[n[r]]=e[n[r]])},drawDashedLine:function(e,r,i,s,o,u){var a=s-r,f=o-i,l=t(a*a+f*f),c=n(f,a),h=u.length,p=0,d=!0;e.save(),e.translate(r,i),e.moveTo(0,0),e.rotate(c),r=0;while(l>r)r+=u[p++%h],r>l&&(r=l),e[d?"lineTo":"moveTo"](r,0),d=!d;e.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(e){var t=fabric.util.createCanvasElement();return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},createImage:function(){return fabric.document.createElement("img")},clipContext:function(e,t){t.save(),t.beginPath(),e.clipTo(t),t.clip()},multiplyTransformMatrices:function(e,t,n){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],n?0:e[0]*t[4]+e[2]*t[5]+e[4],n?0:e[1]*t[4]+e[3]*t[5]+e[5]]},qrDecompose:function(e){var i=n(e[1],e[0]),o=r(e[0],2)+r(e[1],2),u=t(o),a=(e[0]*e[3]-e[2]*e[1])/u,f=n(e[0]*e[2]+e[1]*e[3],o);return{angle:i/s,scaleX:u,scaleY:a,skewX:f/s,skewY:0,translateX:e[4],translateY:e[5]}},customTransformMatrix:function(e,t,n){var r=[1,0,i(Math.tan(n*s)),1],o=[i(e),0,0,i(t)];return fabric.util.multiplyTransformMatrices(o,r,!0)},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},getFunctionBody:function(e){return(String(e).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(e,t,n,r){r>0&&(t>r?t-=r:t=0,n>r?n-=r:n=0);var i=!0,s,o,u=e.getImageData(t,n,r*2||1,r*2||1),a=u.data.length;for(s=3;s<a;s+=4){o=u.data[s],i=o<=0;if(i===!1)break}return u=null,i},parsePreserveAspectRatioAttribute:function(e){var t="meet",n="Mid",r="Mid",i=e.split(" "),s;return i&&i.length&&(t=i.pop(),t!=="meet"&&t!=="slice"?(s=t,t="meet"):i.length&&(s=i.pop())),n=s!=="none"?s.slice(1,4):"none",r=s!=="none"?s.slice(5,8):"none",{meetOrSlice:t,alignX:n,alignY:r}},clearFabricFontCache:function(e){e=(e||"").toLowerCase(),e?fabric.charWidthsCache[e]&&delete fabric.charWidthsCache[e]:fabric.charWidthsCache={}},limitDimsByArea:function(e,t){var n=Math.sqrt(t*e),r=Math.floor(t/n);return{x:Math.floor(n),y:r}},capValue:function(e,t,n){return Math.max(e,Math.min(t,n))},findScaleToFit:function(e,t){return Math.min(t.width/e.width,t.height/e.height)},findScaleToCover:function(e,t){return Math.max(t.width/e.width,t.height/e.height)}}}(typeof exports!="undefined"?exports:this),function(){function t(t,n){var r=e.call(arguments,2),i=[];for(var s=0,o=t.length;s<o;s++)i[s]=r.length?t[s][n].apply(t[s],r):t[s][n].call(t[s]);return i}function n(e,t){return s(e,t,function(e,t){return e>=t})}function r(e,t){return s(e,t,function(e,t){return e<t})}function i(e,t){var n=e.length;while(n--)e[n]=t;return e}function s(e,t,n){if(!e||e.length===0)return;var r=e.length-1,i=t?e[r][t]:e[r];if(t)while(r--)n(e[r][t],i)&&(i=e[r][t]);else while(r--)n(e[r],i)&&(i=e[r]);return i}var e=Array.prototype.slice;fabric.util.array={fill:i,invoke:t,min:r,max:n}}(),function(){function e(t,n,r){if(r)if(!fabric.isLikelyNode&&n instanceof Element)t=n;else if(n instanceof Array){t=[];for(var i=0,s=n.length;i<s;i++)t[i]=e({},n[i],r)}else if(n&&typeof n=="object")for(var o in n)n.hasOwnProperty(o)&&(t[o]=e({},n[o],r));else t=n;else for(var o in n)t[o]=n[o];return t}function t(t,n){return e({},t,n)}fabric.util.object={extend:e,clone:t},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())}function n(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(e){var t=0,n,r=[];for(t=0,n;t<e.length;t++){if((n=i(e,t))===!1)continue;r.push(n)}return r}function i(e,t){var n=e.charCodeAt(t);if(isNaN(n))return"";if(n<55296||n>57343)return e.charAt(t);if(55296<=n&&n<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";var r=e.charCodeAt(t+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";var i=e.charCodeAt(t-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:e,capitalize:t,escapeXml:n,graphemeSplit:r}}(),function(){function i(){}function s(t){var n=null,r=this;while(r.constructor.superclass){var i=r.constructor.superclass.prototype[t];if(r[t]!==i){n=i;break}r=r.constructor.superclass.prototype}return n?arguments.length>1?n.apply(this,e.call(arguments,1)):n.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}function o(){function u(){this.initialize.apply(this,arguments)}var n=null,o=e.call(arguments,0);typeof o[0]=="function"&&(n=o.shift()),u.superclass=n,u.subclasses=[],n&&(i.prototype=n.prototype,u.prototype=new i,n.subclasses.push(u));for(var a=0,f=o.length;a<f;a++)r(u,o[a],n);return u.prototype.initialize||(u.prototype.initialize=t),u.prototype.constructor=u,u.prototype.callSuper=s,u}var e=Array.prototype.slice,t=function(){},n=function(){for(var e in{toString:1})if(e==="toString")return!1;return!0}(),r=function(e,t,r){for(var i in t)i in e.prototype&&typeof e.prototype[i]=="function"&&(t[i]+"").indexOf("callSuper")>-1?e.prototype[i]=function(e){return function(){var n=this.constructor.superclass;this.constructor.superclass=r;var i=t[e].apply(this,arguments);this.constructor.superclass=n;if(e!=="initialize")return i}}(i):e.prototype[i]=t[i],n&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};fabric.util.createClass=o}(),function(){function t(e){var t=Array.prototype.slice.call(arguments,1),n,r,i=t.length;for(r=0;r<i;r++){n=typeof e[t[r]];if(!/^(?:function|object|unknown)$/.test(n))return!1}return!0}function s(e,t){return{handler:t,wrappedHandler:o(e,t)}}function o(e,t){return function(r){t.call(n(e),r||fabric.window.event)}}function u(e,t){return function(n){if(c[e]&&c[e][t]){var r=c[e][t];for(var i=0,s=r.length;i<s;i++)r[i].call(this,n||fabric.window.event)}}}function d(t){t||(t=fabric.window.event);var n=t.target||(typeof t.srcElement!==e?t.srcElement:null),r=fabric.util.getScrollLeftTop(n);return{x:v(t)+r.left,y:m(t)+r.top}}function g(e,t,n){var r=e.type==="touchend"?"changedTouches":"touches",i,s=e[r];return s&&s[0]&&(i=s[0][n]),typeof i=="undefined"&&(i=e[n]),i}var e="unknown",n,r,i=function(){var e=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+e++)}}();(function(){var e={};n=function(t){return e[t]},r=function(t,n){e[t]=n}})();var a=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),f=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),l={},c={},h,p;a?(h=function(e,t,n,r){e&&e.addEventListener(t,n,f?!1:r)},p=function(e,t,n,r){e&&e.removeEventListener(t,n,f?!1:r)}):f?(h=function(e,t,n){if(!e)return;var o=i(e);r(o,e),l[o]||(l[o]={}),l[o][t]||(l[o][t]=[]);var u=s(o,n);l[o][t].push(u),e.attachEvent("on"+t,u.wrappedHandler)},p=function(e,t,n){if(!e)return;var r=i(e),s;if(l[r]&&l[r][t])for(var o=0,u=l[r][t].length;o<u;o++)s=l[r][t][o],s&&s.handler===n&&(e.detachEvent("on"+t,s.wrappedHandler),l[r][t][o]=null)}):(h=function(e,t,n){if(!e)return;var r=i(e);c[r]||(c[r]={});if(!c[r][t]){c[r][t]=[];var s=e["on"+t];s&&c[r][t].push(s),e["on"+t]=u(r,t)}c[r][t].push(n)},p=function(e,t,n){if(!e)return;var r=i(e);if(c[r]&&c[r][t]){var s=c[r][t];for(var o=0,u=s.length;o<u;o++)s[o]===n&&s.splice(o,1)}}),fabric.util.addListener=h,fabric.util.removeListener=p;var v=function(e){return e.clientX},m=function(e){return e.clientY};fabric.isTouchSupported&&(v=function(e){return g(e,"pageX","clientX")},m=function(e){return g(e,"pageY","clientY")}),fabric.util.getPointer=d}(),function(){function e(e,t){var n=e.style;if(!n)return e;if(typeof t=="string")return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?s(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var r in t)if(r==="opacity")s(e,t[r]);else{var i=r==="float"||r==="cssFloat"?typeof n.styleFloat=="undefined"?"cssFloat":"styleFloat":r;n[i]=t[r]}return e}var t=fabric.document.createElement("div"),n=typeof t.style.opacity=="string",r=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(e){return e};n?s=function(e,t){return e.style.opacity=t,e}:r&&(s=function(e,t){var n=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(n.zoom=1),i.test(n.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",n.filter=n.filter.replace(i,t)):n.filter+=" alpha(opacity="+t*100+")",e}),fabric.util.setStyle=e}(),function(){function t(e){return typeof e=="string"?fabric.document.getElementById(e):e}function s(e,t){var n=fabric.document.createElement(e);for(var r in t)r==="class"?n.className=t[r]:r==="for"?n.htmlFor=t[r]:n.setAttribute(r,t[r]);return n}function o(e,t){e&&(" "+e.className+" ").indexOf(" "+t+" ")===-1&&(e.className+=(e.className?" ":"")+t)}function u(e,t,n){return typeof t=="string"&&(t=s(t,n)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t}function a(e){var t=0,n=0,r=fabric.document.documentElement,i=fabric.document.body||{scrollLeft:0,scrollTop:0};while(e&&(e.parentNode||e.host)){e=e.parentNode||e.host,e===fabric.document?(t=i.scrollLeft||r.scrollLeft||0,n=i.scrollTop||r.scrollTop||0):(t+=e.scrollLeft||0,n+=e.scrollTop||0);if(e.nodeType===1&&e.style.position==="fixed")break}return{left:t,top:n}}function f(e){var t,n=e&&e.ownerDocument,r={left:0,top:0},i={left:0,top:0},s,o={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return i;for(var u in o)i[o[u]]+=parseInt(l(e,u),10)||0;return t=n.documentElement,typeof e.getBoundingClientRect!="undefined"&&(r=e.getBoundingClientRect()),s=a(e),{left:r.left+s.left-(t.clientLeft||0)+i.left,top:r.top+s.top-(t.clientTop||0)+i.top}}function c(e){var t=fabric.jsdomImplForWrapper(e);return t._canvas||t._image}function h(e){if(!fabric.isLikelyNode)return;var t=fabric.jsdomImplForWrapper(e);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}var e=Array.prototype.slice,n,r=function(t){return e.call(t,0)};try{n=r(fabric.document.childNodes)instanceof Array}catch(i){}n||(r=function(e){var t=new Array(e.length),n=e.length;while(n--)t[n]=e[n];return t});var l;fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?l=function(e,t){var n=fabric.document.defaultView.getComputedStyle(e,null);return n?n[t]:undefined}:l=function(e,t){var n=e.style[t];return!n&&e.currentStyle&&(n=e.currentStyle[t]),n},function(){function n(e){return typeof e.onselectstart!="undefined"&&(e.onselectstart=fabric.util.falseFunction),t?e.style[t]="none":typeof e.unselectable=="string"&&(e.unselectable="on"),e}function r(e){return typeof e.onselectstart!="undefined"&&(e.onselectstart=null),t?e.style[t]="":typeof e.unselectable=="string"&&(e.unselectable=""),e}var e=fabric.document.documentElement.style,t="userSelect"in e?"userSelect":"MozUserSelect"in e?"MozUserSelect":"WebkitUserSelect"in e?"WebkitUserSelect":"KhtmlUserSelect"in e?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=n,fabric.util.makeElementSelectable=r}(),function(){function e(e,t){var n=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),i=!0;r.onload=r.onreadystatechange=function(e){if(i){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;i=!1,t(e||fabric.window.event),r=r.onload=r.onreadystatechange=null}},r.src=e,n.appendChild(r)}fabric.util.getScript=e}(),fabric.util.getById=t,fabric.util.toArray=r,fabric.util.makeElement=s,fabric.util.addClass=o,fabric.util.wrapElement=u,fabric.util.getScrollLeftTop=a,fabric.util.getElementOffset=f,fabric.util.getElementStyle=l,fabric.util.getNodeCanvas=c,fabric.util.cleanUpJsdomNode=h}(),fabric.log=function(){},fabric.warn=function(){},typeof console!="undefined"&&["log","warn"].forEach(function(e){typeof console[e]!="undefined"&&typeof console[e].apply=="function"&&(fabric[e]=function(){return console[e].apply(console,arguments)})}),function(){function e(){return!1}function t(t){i(function(n){t||(t={});var r=n||+(new Date),s=t.duration||500,o=r+s,u,a=t.onChange||e,f=t.abort||e,l=t.onComplete||e,c=t.easing||function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},h="startValue"in t?t.startValue:0,p="endValue"in t?t.endValue:100,d=t.byValue||p-h;t.onStart&&t.onStart(),function v(e){if(f()){l(p,1,1);return}u=e||+(new Date);var n=u>o?s:u-r,m=n/s,g=c(n,h,d,s),y=Math.abs((g-h)/d);a(g,y,m);if(u>o){t.onComplete&&t.onComplete();return}i(v)}(r)})}function i(){return n.apply(fabric.window,arguments)}function s(){return r.apply(fabric.window,arguments)}var n=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){return fabric.window.setTimeout(e,1e3/60)},r=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=t,fabric.util.requestAnimFrame=i,fabric.util.cancelAnimFrame=s}(),function(e){function n(e,t){this.x=e,this.y=t}var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=n,n.prototype={type:"point",constructor:n,add:function(e){return new n(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new n(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new n(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new n(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new n(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new n(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return typeof t=="undefined"&&(t=.5),t=Math.max(Math.min(1,t),0),new n(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new n(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new n(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=n},clone:function(){return new n(this.x,this.y)}}}(typeof exports!="undefined"?exports:this),function(e){function n(e){this.status=e,this.points=[]}var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}t.Intersection=n,t.Intersection.prototype={appendPoint:function(e){this.points.push(e)},appendPoints:function(e){this.points=this.points.concat(e)}},t.Intersection.intersectLineLine=function(e,r,i,s){var o,u=(s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x),a=(r.x-e.x)*(e.y-i.y)-(r.y-e.y)*(e.x-i.x),f=(s.y-i.y)*(r.x-e.x)-(s.x-i.x)*(r.y-e.y);if(f!==0){var l=u/f,c=a/f;0<=l&&l<=1&&0<=c&&c<=1?(o=new n("Intersection"),o.points.push(new t.Point(e.x+l*(r.x-e.x),e.y+l*(r.y-e.y)))):o=new n}else u===0||a===0?o=new n("Coincident"):o=new n("Parallel");return o},t.Intersection.intersectLinePolygon=function(e,t,r){var i=new n,s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=n.intersectLineLine(e,t,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},t.Intersection.intersectPolygonPolygon=function(e,t){var r=new n,i=e.length;for(var s=0;s<i;s++){var o=e[s],u=e[(s+1)%i],a=n.intersectLinePolygon(o,u,t);r.appendPoints(a.points)}return r.points.length>0&&(r.status="Intersection"),r},t.Intersection.intersectPolygonRectangle=function(e,r,i){var s=r.min(i),o=r.max(i),u=new t.Point(o.x,s.y),a=new t.Point(s.x,o.y),f=n.intersectLinePolygon(s,u,e),l=n.intersectLinePolygon(u,o,e),c=n.intersectLinePolygon(o,a,e),h=n.intersectLinePolygon(a,s,e),p=new n;return p.appendPoints(f.points),p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p}}(typeof exports!="undefined"?exports:this),function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,t=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=fabric.util.toFixed,i=fabric.util.transformPoint,s=fabric.util.invertTransform,o=fabric.util.getNodeCanvas,u=fabric.util.createCanvasElement,a=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:undefined,_initStatic:function(e,t){var n=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,n),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,n),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,n),t.overlayColor&&this.setOverlayColor(t.overlayColor,n),this.calcOffset()},_isRetinaScaling:function(){return fabric.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){if(!this._isRetinaScaling())return;this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,n){return this.__setBgOverlayImage("overlayImage",e,t,n)},setBackgroundImage:function(e,t,n){return this.__setBgOverlayImage("backgroundImage",e,t,n)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,n,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){if(t){var i=new fabric.Image(t,r);this[e]=i,i.canvas=this}n&&n(t)},this,r&&r.crossOrigin):(r&&t.setOptions(r),this[e]=t,t&&(t.canvas=this),n&&n(t)),this},__setBgOverlayColor:function(e,t,n){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,n),this},_createCanvasElement:function(){var e=u();if(!e)throw a;e.style||(e.style={});if(typeof e.getContext=="undefined")throw a;return e},_initOptions:function(e){var t=this.lowerCanvasEl;this._setOptions(e),this.width=this.width||parseInt(t.width,10)||0,this.height=this.height||parseInt(t.height,10)||0;if(!this.lowerCanvasEl.style)return;t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(e){e&&e.getContext?this.lowerCanvasEl=e:this.lowerCanvasEl=fabric.util.getById(e)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var n;t=t||{};for(var r in e)n=e[r],t.cssOnly||(this._setBackstoreDimension(r,e[r]),n+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(r,n);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t=this._activeObject,n,r=!1,i=!0,s,o;this.viewportTransform=e;for(s=0,o=this._objects.length;s<o;s++)n=this._objects[s],n.group||n.setCoords(r,i);return t&&t.type==="activeSelection"&&t.setCoords(r,i),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var n=e,r=this.viewportTransform.slice(0);e=i(e,s(this.viewportTransform)),r[0]=t,r[3]=t;var o=i(e,r);return r[4]+=n.x-o.x,r[5]+=n.y-o.y,this.setViewportTransform(r)},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,n=this.height,r=s(this.viewportTransform);return e.tl=i({x:0,y:0},r),e.br=i({x:t,y:n},r),e.tr=new fabric.Point(e.br.x,e.tl.y),e.bl=new fabric.Point(e.tl.x,e.br.y),this.vptCoords=e,e},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(e,t){var n=this.viewportTransform,r=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(e),this.fire("before:render",{ctx:e}),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.clipTo&&e.restore(),r&&(r.canvas=this,r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e)),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render",{ctx:e})},drawClipPathOnCanvas:function(e){var t=this.viewportTransform,n=this.clipPath;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.globalCompositeOperation="destination-in",n.transform(e),e.scale(1/n.zoomX,1/n.zoomY),e.drawImage(n._cacheCanvas,-n.cacheTranslationX,-n.cacheTranslationY),e.restore()},_renderObjects:function(e,t){var n,r;for(n=0,r=t.length;n<r;++n)t[n]&&t[n].render(e)},_renderBackgroundOrOverlay:function(e,t){var n=this[t+"Color"],r;n&&(e.fillStyle=n.toLive?n.toLive(e,this):n,e.fillRect(n.offsetX||0,n.offsetY||0,this.width,this.height)),n=this[t+"Image"],n&&(this[t+"Vpt"]&&(r=this.viewportTransform,e.save(),e.transform(r[0],r[1],r[2],r[3],r[4],r[5])),n.render(e),this[t+"Vpt"]&&e.restore())},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top))},centerObject:function(e){var t=this.getCenter();return this._centerObject(e,new fabric.Point(t.left,t.top))},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenter(),t=s(this.viewportTransform);return i({x:e.left,y:e.top},t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,n){var r=this.clipPath,i={version:fabric.version,objects:this._toObjects(t,n)};return r&&(r=r.toObject(n)),e(i,this.__serializeBgOverlay(t,n)),fabric.util.populateWithProperties(this,i,n),i},_toObjects:function(e,t){return this._objects.filter(function(e){return!e.excludeFromExport}).map(function(n){return this._toObject(n,e,t)},this)},_toObject:function(e,t,n){var r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);var i=e[t](n);return this.includeDefaultValues||(e.includeDefaultValues=r),i},__serializeBgOverlay:function(e,t){var n={},r=this.backgroundImage,i=this.overlayImage;return this.backgroundColor&&(n.background=this.backgroundColor.toObject?this.backgroundColor.toObject(t):this.backgroundColor),this.overlayColor&&(n.overlay=this.overlayColor.toObject?this.overlayColor.toObject(t):this.overlayColor),r&&!r.excludeFromExport&&(n.backgroundImage=this._toObject(r,e,t)),i&&!i.excludeFromExport&&(n.overlayImage=this._toObject(i,e,t)),n},sendToBack:function(e){if(!e)return this;var t=this._activeObject,r,i,s;if(e===t&&e.type==="activeSelection"){s=t._objects;for(r=s.length;r--;)i=s[r],n(this._objects,i),this._objects.unshift(i)}else n(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t=this._activeObject,r,i,s;if(e===t&&e.type==="activeSelection"){s=t._objects;for(r=0;r<s.length;r++)i=s[r],n(this._objects,i),this._objects.push(i)}else n(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var r=this._activeObject,i,s,o,u,a,f=0;if(e===r&&e.type==="activeSelection"){a=r._objects;for(i=0;i<a.length;i++)s=a[i],o=this._objects.indexOf(s),o>0+f&&(u=o-1,n(this._objects,s),this._objects.splice(u,0,s)),f++}else o=this._objects.indexOf(e),o!==0&&(u=this._findNewLowerIndex(e,o,t),n(this._objects,e),this._objects.splice(u,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,n){var r,i;if(n){r=t;for(i=t-1;i>=0;--i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}}else r=t-1;return r},bringForward:function(e,t){if(!e)return this;var r=this._activeObject,i,s,o,u,a,f=0;if(e===r&&e.type==="activeSelection"){a=r._objects;for(i=a.length;i--;)s=a[i],o=this._objects.indexOf(s),o<this._objects.length-1-f&&(u=o+1,n(this._objects,s),this._objects.splice(u,0,s)),f++}else o=this._objects.indexOf(e),o!==this._objects.length-1&&(u=this._findNewUpperIndex(e,o,t),n(this._objects,e),this._objects.splice(u,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,n){var r,i,s;if(n){r=t;for(i=t+1,s=this._objects.length;i<s;++i){var o=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(o){r=i;break}}}else r=t+1;return r},moveTo:function(e,t){return n(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(e){e.dispose&&e.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=undefined,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): "+"{ objects: "+this._objects.length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=u();if(!t||!t.getContext)return null;var n=t.getContext("2d");if(!n)return null;switch(e){case"getImageData":return typeof n.getImageData!="undefined";case"setLineDash":return typeof n.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var e=o(this.lowerCanvasEl);return e&&e.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){var t=o(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}(),function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians,n=fabric.util.radiansToDegrees,r=Math.atan2,i=Math.abs,s=fabric.StaticCanvas.supports("setLineDash"),o=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e=this.getActiveObjects(),t,n,r;if(e.length>0&&!this.preserveObjectStacking){n=[],r=[];for(var i=0,s=this._objects.length;i<s;i++)t=this._objects[i],e.indexOf(t)===-1?n.push(t):r.push(t);e.length>1&&(this._activeObject._objects=r),n.push.apply(n,r)}else n=this._objects;return n},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0)},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_resetCurrentTransform:function(){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,skewX:e.original.skewX,skewY:e.original.skewY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(e.target)?(e.originX!=="center"&&(e.originX==="right"?e.mouseXSign=-1:e.mouseXSign=1),e.originY!=="center"&&(e.originY==="bottom"?e.mouseYSign=-1:e.mouseYSign=1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(e,t,n){var r=!0,i=n||this.getPointer(e,r),s;return t.group&&t.group===this._activeObject&&t.group.type==="activeSelection"?s=this._normalizePointer(t.group,i):s={x:i.x,y:i.y},t.containsPoint(s)||t._findTargetCorner(i)},_normalizePointer:function(e,t){var n=e.calcTransformMatrix(),r=fabric.util.invertTransform(n),i=this.restorePointerVpt(t);return fabric.util.transformPoint(i,r)},isTargetTransparent:function(e,t,n){if(e.shouldCache()&&e._cacheCanvas){var r=this._normalizePointer(e,{x:t,y:n}),i=e.cacheTranslationX+r.x*e.zoomX,s=e.cacheTranslationY+r.y*e.zoomY,o=fabric.util.isTransparent(e._cacheContext,i,s,this.targetFindTolerance);return o}var u=this.contextCache,a=e.selectionBackgroundColor,f=this.viewportTransform;e.selectionBackgroundColor="",this.clearContext(u),u.save(),u.transform(f[0],f[1],f[2],f[3],f[4],f[5]),e.render(u),u.restore(),e===this._activeObject&&e._renderControls(u,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),e.selectionBackgroundColor=a;var o=fabric.util.isTransparent(u,t,n,this.targetFindTolerance);return o},_isSelectionKeyPressed:function(e){var t=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?t=!!this.selectionKey.find(function(t){return e[t]===!0}):t=e[this.selectionKey],t},_shouldClearSelection:function(e,t){var n=this.getActiveObjects(),r=this._activeObject;return!t||t&&r&&n.length>1&&n.indexOf(t)===-1&&r!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(e){if(!e)return;var t=this._currentTransform,n;return t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"?n=this.centeredScaling||e.centeredScaling:t.action==="rotate"&&(n=this.centeredRotation||e.centeredRotation),n?!t.altKey:t.altKey},_getOriginFromCorner:function(e,t){var n={x:e.originX,y:e.originY};if(t==="ml"||t==="tl"||t==="bl")n.x="right";else if(t==="mr"||t==="tr"||t==="br")n.x="left";if(t==="tl"||t==="mt"||t==="tr")n.y="bottom";else if(t==="bl"||t==="mb"||t==="br")n.y="top";return n},_getActionFromCorner:function(e,t,n){if(!t)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return n[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return n[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(e,n){if(!n)return;var r=this.getPointer(e),i=n._findTargetCorner(this.getPointer(e,!0)),s=this._getActionFromCorner(n,i,e),o=this._getOriginFromCorner(n,i);this._currentTransform={target:n,action:s,corner:i,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:r.x-n.left,offsetY:r.y-n.top,originX:o.x,originY:o.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:t(n.angle),width:n.width*n.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey],original:fabric.util.saveObjectTransform(n)},this._currentTransform.original.originX=o.x,this._currentTransform.original.originY=o.y,this._resetCurrentTransform(),this._beforeTransform(e)},_translateObject:function(e,t){var n=this._currentTransform,r=n.target,i=e-n.offsetX,s=t-n.offsetY,o=!r.get("lockMovementX")&&r.left!==i,u=!r.get("lockMovementY")&&r.top!==s;return o&&r.set("left",i),u&&r.set("top",s),o||u},_changeSkewTransformOrigin:function(e,t,n){var r="originX",i={0:"center"},s=t.target.skewX,o="left",u="right",a=t.corner==="mt"||t.corner==="ml"?1:-1,f=1;e=e>0?1:-1,n==="y"&&(s=t.target.skewY,o="top",u="bottom",r="originY"),i[-1]=o,i[1]=u,t.target.flipX&&(f*=-1),t.target.flipY&&(f*=-1),s===0?(t.skewSign=-a*e*f,t[r]=i[-e]):(s=s>0?1:-1,t.skewSign=s,t[r]=i[s*a*f])},_skewObject:function(e,t,n){var r=this._currentTransform,i=r.target,s=!1,o=i.get("lockSkewingX"),u=i.get("lockSkewingY");if(o&&n==="x"||u&&n==="y")return!1;var a=i.getCenterPoint(),f=i.toLocalPoint(new fabric.Point(e,t),"center","center")[n],l=i.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[n],c,h,p=i._getTransformedDimensions();return this._changeSkewTransformOrigin(f-l,r,n),c=i.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY)[n],h=i.translateToOriginPoint(a,r.originX,r.originY),s=this._setObjectSkew(c,r,n,p),r.lastX=e,r.lastY=t,i.setPositionByOrigin(h,r.originX,r.originY),s},_setObjectSkew:function(e,t,n,r){var i=t.target,s,o=!1,u=t.skewSign,a,f,l,c,h,p,d,v;return n==="x"?(l="y",c="Y",h="X",d=0,v=i.skewY):(l="x",c="X",h="Y",d=i.skewX,v=0),f=i._getTransformedDimensions(d,v),p=2*Math.abs(e)-f[n],p<=2?s=0:(s=u*Math.atan(p/i["scale"+h]/(f[l]/i["scale"+c])),s=fabric.util.radiansToDegrees(s)),o=i["skew"+h]!==s,i.set("skew"+h,s),i["skew"+c]!==0&&(a=i._getTransformedDimensions(),s=r[l]/a[l]*i["scale"+c],i.set("scale"+c,s)),o},_scaleObject:function(e,t,n){var r=this._currentTransform,i=r.target,s=i.lockScalingX,o=i.lockScalingY,u=i.lockScalingFlip;if(s&&o)return!1;var a=i.translateToOriginPoint(i.getCenterPoint(),r.originX,r.originY),f=i.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY),l=i._getTransformedDimensions(),c=!1;return this._setLocalMouse(f,r),c=this._setObjectScale(f,r,s,o,n,u,l),i.setPositionByOrigin(a,r.originX,r.originY),c},_setObjectScale:function(e,t,n,r,i,s,o){var u=t.target,a=!1,f=!1,l=!1,c,h,p,d;return p=e.x*u.scaleX/o.x,d=e.y*u.scaleY/o.y,c=u.scaleX!==p,h=u.scaleY!==d,s&&p<=0&&p<u.scaleX&&(a=!0,e.x=0),s&&d<=0&&d<u.scaleY&&(f=!0,e.y=0),i==="equally"&&!n&&!r?l=this._scaleObjectEqually(e,u,t,o):i?i==="x"&&!u.get("lockUniScaling")?a||n||u.set("scaleX",p)&&(l=l||c):i==="y"&&!u.get("lockUniScaling")&&(f||r||u.set("scaleY",d)&&(l=l||h)):(a||n||u.set("scaleX",p)&&(l=l||c),f||r||u.set("scaleY",d)&&(l=l||h)),t.newScaleX=p,t.newScaleY=d,a||f||this._flipObject(t,i),l},_scaleObjectEqually:function(e,t,n,r){var i=e.y+e.x,s=r.y*n.original.scaleY/t.scaleY+r.x*n.original.scaleX/t.scaleX,o,u=e.x<0?-1:1,a=e.y<0?-1:1;return n.newScaleX=u*Math.abs(n.original.scaleX*i/s),n.newScaleY=a*Math.abs(n.original.scaleY*i/s),o=n.newScaleX!==t.scaleX||n.newScaleY!==t.scaleY,t.set("scaleX",n.newScaleX),t.set("scaleY",n.newScaleY),o},_flipObject:function(e,t){e.newScaleX<0&&t!=="y"&&(e.originX==="left"?e.originX="right":e.originX==="right"&&(e.originX="left")),e.newScaleY<0&&t!=="x"&&(e.originY==="top"?e.originY="bottom":e.originY==="bottom"&&(e.originY="top"))},_setLocalMouse:function(e,t){var n=t.target,r=this.getZoom(),s=n.padding/r;t.originX==="right"?e.x*=-1:t.originX==="center"&&(e.x*=t.mouseXSign*2,e.x<0&&(t.mouseXSign=-t.mouseXSign)),t.originY==="bottom"?e.y*=-1:t.originY==="center"&&(e.y*=t.mouseYSign*2,e.y<0&&(t.mouseYSign=-t.mouseYSign)),i(e.x)>s?e.x<0?e.x+=s:e.x-=s:e.x=0,i(e.y)>s?e.y<0?e.y+=s:e.y-=s:e.y=0},_rotateObject:function(e,t){var i=this._currentTransform,s=i.target,o,o=s.translateToOriginPoint(s.getCenterPoint(),i.originX,i.originY);if(s.lockRotation)return!1;var u=r(i.ey-o.y,i.ex-o.x),a=r(t-o.y,e-o.x),f=n(a-u+i.theta),l=!0;if(s.snapAngle>0){var c=s.snapAngle,h=s.snapThreshold||c,p=Math.ceil(f/c)*c,d=Math.floor(f/c)*c;Math.abs(f-d)<h?f=d:Math.abs(f-p)<h&&(f=p)}return f<0&&(f=360+f),f%=360,s.angle===f?l=!1:(s.angle=f,s.setPositionByOrigin(o,i.originX,i.originY)),l},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var t=this._groupSelector,n=t.left,r=t.top,u=i(n),a=i(r);this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(t.ex-(n>0?0:-n),t.ey-(r>0?0:-r),u,a));if(!this.selectionLineWidth||!this.selectionBorderColor)return;e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1&&!s){var f=t.ex+o-(n>0?0:u),l=t.ey+o-(r>0?0:a);e.beginPath(),fabric.util.drawDashedLine(e,f,l,f+u,l,this.selectionDashArray),fabric.util.drawDashedLine(e,f,l+a-1,f+u,l+a-1,this.selectionDashArray),fabric.util.drawDashedLine(e,f,l,f,l+a,this.selectionDashArray),fabric.util.drawDashedLine(e,f+u-1,l,f+u-1,l+a,this.selectionDashArray),e.closePath(),e.stroke()}else fabric.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(t.ex+o-(n>0?0:u),t.ey+o-(r>0?0:a),u,a)},findTarget:function(e,t){if(this.skipTargetFind)return;var n=!0,r=this.getPointer(e,n),i=this._activeObject,s=this.getActiveObjects(),o,u;this.targets=[];if(s.length>1&&!t&&i===this._searchPossibleTargets([i],r))return i;if(s.length===1&&i._findTargetCorner(r))return i;if(s.length===1&&i===this._searchPossibleTargets([i],r)){if(!this.preserveObjectStacking)return i;o=i,u=this.targets,this.targets=[]}var a=this._searchPossibleTargets(this._objects,r);return e[this.altSelectionKey]&&a&&o&&a!==o&&(a=o,this.targets=u),a},_checkTarget:function(e,t,n){if(t&&t.visible&&t.evented&&this.containsPoint(null,t,e)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||!!t.isEditing)return!0;var r=this.isTargetTransparent(t,n.x,n.y);if(!r)return!0}},_searchPossibleTargets:function(e,t){var n,r=e.length,i;while(r--){var s=e[r],o=s.group&&s.group.type!=="activeSelection"?this._normalizePointer(s.group,t):t;if(this._checkTarget(o,s,t)){n=e[r],n.subTargetCheck&&n instanceof fabric.Group&&(i=this._searchPossibleTargets(n._objects,t),i&&this.targets.push(i));break}}return n},restorePointerVpt:function(e){return fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var r=e(t),i=this.upperCanvasEl,s=i.getBoundingClientRect(),o=s.width||0,u=s.height||0,a;if(!o||!u)"top"in s&&"bottom"in s&&(u=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(o=Math.abs(s.right-s.left));return this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,n||(r=this.restorePointerVpt(r)),o===0||u===0?a={width:1,height:1}:a={width:i.width/o,height:i.height/u},{x:r.x*a.width,y:r.y*a.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+e),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,n=this.height||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:n+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=n,fabric.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?e.type==="activeSelection"&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),this._hoveredTarget===e&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,t){var n=!1,r=this.getActiveObjects(),i=[],s=[],o={e:t};e.forEach(function(e){r.indexOf(e)===-1&&(n=!0,e.fire("deselected",o),s.push(e))}),r.forEach(function(t){e.indexOf(t)===-1&&(n=!0,t.fire("selected",o),i.push(t))}),e.length>0&&r.length>0?(o.selected=i,o.deselected=s,o.updated=i[0]||s[0],o.target=this._activeObject,n&&this.fire("selection:updated",o)):r.length>0?(r.length===1&&(o.target=i[0],this.fire("object:selected",o)),o.selected=i,o.target=this._activeObject,this.fire("selection:created",o)):e.length>0&&(o.deselected=s,this.fire("selection:cleared",o))},setActiveObject:function(e,t){var n=this.getActiveObjects();return this._setActiveObject(e,t),this._fireSelectionEvents(n,t),this},_setActiveObject:function(e,t){return this._activeObject===e?!1:this._discardActiveObject(t,e)?e.onSelect({e:t})?!1:(this._activeObject=e,!0):!1},_discardActiveObject:function(e,t){var n=this._activeObject;if(n){if(n.onDeselect({e:e,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var t=this.getActiveObjects();return t.length&&this.fire("before:selection:cleared",{target:t[0],e:e}),this._discardActiveObject(e),this._fireSelectionEvents(t,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(e){fabric.util.cleanUpJsdomNode(this[e]),this[e]=undefined}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,n){var r=this._realizeGroupTransformOnObject(e),i=this.callSuper("_toObject",e,t,n);return this._unwindGroupTransformOnObject(e,r),i},_realizeGroupTransformOnObject:function(e){if(e.group&&e.group.type==="activeSelection"&&this._activeObject===e.group){var t=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],n={};return t.forEach(function(t){n[t]=e[t]}),this._activeObject.realizeTransform(e),n}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,n){var r=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,n),this._unwindGroupTransformOnObject(t,r)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,e)}});for(var u in fabric.StaticCanvas)u!=="prototype"&&(fabric.Canvas[u]=fabric.StaticCanvas[u]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}(),function(){function u(e,t){return"which"in e?e.which===t:e.button===t-1}var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},t=fabric.util.addListener,n=fabric.util.removeListener,r=3,i=2,s=1,o={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(t,"add")},addOrRemove:function(e,t){e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove,o),e(this.upperCanvasEl,"mouseout",this._onMouseOut),e(this.upperCanvasEl,"mouseenter",this._onMouseEnter),e(this.upperCanvasEl,"wheel",this._onMouseWheel),e(this.upperCanvasEl,"contextmenu",this._onContextMenu),e(this.upperCanvasEl,"dblclick",this._onDoubleClick),e(this.upperCanvasEl,"touchstart",this._onMouseDown,o),e(this.upperCanvasEl,"touchmove",this._onMouseMove,o),e(this.upperCanvasEl,"dragover",this._onDragOver),e(this.upperCanvasEl,"dragenter",this._onDragEnter),e(this.upperCanvasEl,"dragleave",this._onDragLeave),e(this.upperCanvasEl,"drop",this._onDrop),typeof eventjs!="undefined"&&t in eventjs&&(eventjs[t](this.upperCanvasEl,"gesture",this._onGesture),eventjs[t](this.upperCanvasEl,"drag",this._onDrag),eventjs[t](this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs[t](this.upperCanvasEl,"shake",this._onShake),eventjs[t](this.upperCanvasEl,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(n,"remove"),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp,o),n(fabric.document,"mousemove",this._onMouseMove,o),n(fabric.document,"touchmove",this._onMouseMove,o)},_bindEvents:function(){if(this.eventsBound)return;this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:e}),this._hoveredTarget=null,t&&t.fire("mouseout",{e:e}),this._iTextInstances&&this._iTextInstances.forEach(function(e){e.isEditing&&e.hiddenTextarea.focus()})},_onMouseEnter:function(e){this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null)},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onDragOver:function(e){e.preventDefault();var t=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(t,e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},_onMouseDown:function(e){this.__onMouseDown(e),this._resetTransformEventData(),t(fabric.document,"touchend",this._onMouseUp,o),t(fabric.document,"touchmove",this._onMouseMove,o),n(this.upperCanvasEl,"mousemove",this._onMouseMove,o),n(this.upperCanvasEl,"touchmove",this._onMouseMove,o),e.type==="touchstart"?n(this.upperCanvasEl,"mousedown",this._onMouseDown):(t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove,o))},_onMouseUp:function(e){this.__onMouseUp(e),this._resetTransformEventData(),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp,o),n(fabric.document,"mousemove",this._onMouseMove,o),n(fabric.document,"touchmove",this._onMouseMove,o),t(this.upperCanvasEl,"mousemove",this._onMouseMove,o),t(this.upperCanvasEl,"touchmove",this._onMouseMove,o);if(e.type==="touchend"){var r=this;setTimeout(function(){t(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var t=this._activeObject;return!!t!=!!e||t&&e&&t!==e?!0:t&&t.isEditing?!1:!1},__onMouseUp:function(e){var t,n=this._currentTransform,o=this._groupSelector,a=!1,f=!o||o.left===0&&o.top===0;this._cacheTransformEventData(e),t=this._target,this._handleEvent(e,"up:before");if(u(e,r)){this.fireRightClick&&this._handleEvent(e,"up",r,f);return}if(u(e,i)){this.fireMiddleClick&&this._handleEvent(e,"up",i,f),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return}n&&(this._finalizeCurrentTransform(e),a=n.actionPerformed),f||(this._maybeGroupObjects(e),a||(a=this._shouldRender(t))),t&&(t.isMoving=!1),this._setCursorFromEvent(e,t),this._handleEvent(e,"up",s,f),this._groupSelector=null,this._currentTransform=null,t&&(t.__corner=0),a?this.requestRenderAll():f||this.renderTop()},_simpleEventHandler:function(e,t){var n=this.findTarget(t),r=this.targets,i={e:t,target:n,subTargets:r};this.fire(e,i),n&&n.fire(e,i);if(!r)return n;for(var s=0;s<r.length;s++)r[s].fire(e,i);return n},_handleEvent:function(e,t,n,r){var i=this._target,o=this.targets||[],u={e:e,target:i,subTargets:o,button:n||s,isClick:r||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+t,u),i&&i.fire("mouse"+t,u);for(var a=0;a<o.length;a++)o[a].fire("mouse"+t,u)},_finalizeCurrentTransform:function(e){var t=this._currentTransform,n=t.target,r,i={e:e,target:n,transform:t};n._scaling&&(n._scaling=!1),n.setCoords();if(t.actionPerformed||this.stateful&&n.hasStateChanged())t.actionPerformed&&(r=this._addEventOptions(i,t),this._fire(r,i)),this._fire("modified",i)},_addEventOptions:function(e,t){var n,r;switch(t.action){case"scaleX":n="scaled",r="x";break;case"scaleY":n="scaled",r="y";break;case"skewX":n="skewed",r="x";break;case"skewY":n="skewed",r="y";break;case"scale":n="scaled",r="equally";break;case"rotate":n="rotated";break;case"drag":n="moved"}return e.by=r,n},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=this.getPointer(e);this.freeDrawingBrush.onMouseDown(t),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=this.getPointer(e);this.freeDrawingBrush.onMouseMove(t)}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(e,"up")},__onMouseDown:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"down:before");var t=this._target;if(u(e,r)){this.fireRightClick&&this._handleEvent(e,"down",r);return}if(u(e,i)){this.fireMiddleClick&&this._handleEvent(e,"down",i);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return}if(this._currentTransform)return;var n=this._pointer;this._previousPointer=n;var s=this._shouldRender(t),o=this._shouldGroup(e,t);this._shouldClearSelection(e,t)?this.discardActiveObject(e):o&&(this._handleGrouping(e,t),t=this._activeObject),this.selection&&(!t||!t.selectable&&!t.isEditing&&t!==this._activeObject)&&(this._groupSelector={ex:n.x,ey:n.y,top:0,left:0}),t&&(t.selectable&&this.setActiveObject(t,e),t===this._activeObject&&(t.__corner||!o)&&this._setupCurrentTransform(e,t)),this._handleEvent(e,"down"),(s||o)&&this.requestRenderAll()},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState(),this.fire("before:transform",{e:e,transform:t}),t.corner&&this.onBeforeScaleRotate(t.target)},__onMouseMove:function(e){this._handleEvent(e,"move:before"),this._cacheTransformEventData(e);var t,n;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return}if(typeof e.touches!="undefined"&&e.touches.length>1)return;var r=this._groupSelector;r?(n=this._pointer,r.left=n.x-r.ex,r.top=n.y-r.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e)||null,this._setCursorFromEvent(e,t),this._fireOverOutEvents(t,e)),this._handleEvent(e,"move"),this._resetTransformEventData()},_fireOverOutEvents:function(e,t){this.fireSynteticInOutEvents(e,t,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(e,t){this.fireSynteticInOutEvents(e,t,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(e,t,n){var r,i,s=this[n.targetName],o,u,a=s!==e,f=n.canvasEvtIn,l=n.canvasEvtOut;a&&(r={e:t,target:e,previousTarget:s},i={e:t,target:s,nextTarget:e},this[n.targetName]=e),u=e&&a,o=s&&a,o&&(l&&this.fire(l,i),s.fire(n.evtOut,i)),u&&(f&&this.fire(f,r),e.fire(n.evtIn,r))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var t=this.getPointer(e),n=this._currentTransform;n.reset=!1,n.target.isMoving=!0,n.shiftKey=e.shiftKey,n.altKey=e[this.centeredKey],this._beforeScaleTransform(e,n),this._performTransformAction(e,n,t),n.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,t,n){var r=n.x,i=n.y,s=t.action,o=!1,u={target:t.target,e:e,transform:t,pointer:n};s==="rotate"?(o=this._rotateObject(r,i))&&this._fire("rotating",u):s==="scale"?(o=this._onScale(e,t,r,i))&&this._fire("scaling",u):s==="scaleX"?(o=this._scaleObject(r,i,"x"))&&this._fire("scaling",u):s==="scaleY"?(o=this._scaleObject(r,i,"y"))&&this._fire("scaling",u):s==="skewX"?(o=this._skewObject(r,i,"x"))&&this._fire("skewing",u):s==="skewY"?(o=this._skewObject(r,i,"y"))&&this._fire("skewing",u):(o=this._translateObject(r,i),o&&(this._fire("moving",u),this.setCursor(u.target.moveCursor||this.moveCursor))),t.actionPerformed=t.actionPerformed||o},_fire:function(e,t){this.fire("object:"+e,t),t.target.fire(e,t)},_beforeScaleTransform:function(e,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var n=this._shouldCenterTransform(t.target);if(n&&(t.originX!=="center"||t.originY!=="center")||!n&&t.originX==="center"&&t.originY==="center")this._resetCurrentTransform(),t.reset=!0}},_onScale:function(e,t,n,r){return this._isUniscalePossible(e,t.target)?(t.currentAction="scale",this._scaleObject(n,r)):(!t.reset&&t.currentAction==="scale"&&this._resetCurrentTransform(),t.currentAction="scaleEqually",this._scaleObject(n,r,"equally"))},_isUniscalePossible:function(e,t){return(e[this.uniScaleKey]||this.uniScaleTransform)&&!t.get("lockUniScaling")},_setCursorFromEvent:function(e,t){if(!t)return this.setCursor(this.defaultCursor),!1;var n=t.hoverCursor||this.hoverCursor,r=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,i=(!r||!r.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));i?this.setCursor(this.getCornerCursor(i,t,e)):this.setCursor(n)},getCornerCursor:function(t,n,r){return this.actionIsDisabled(t,n,r)?this.notAllowedCursor:t in e?this._getRotatedCornerCursor(t,n,r):t==="mtr"&&n.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(e,t,n){return e==="mt"||e==="mb"?n[this.altActionKey]?t.lockSkewingX:t.lockScalingY:e==="ml"||e==="mr"?n[this.altActionKey]?t.lockSkewingY:t.lockScalingX:e==="mtr"?t.lockRotation:this._isUniscalePossible(n,t)?t.lockScalingX&&t.lockScalingY:t.lockScalingX||t.lockScalingY},_getRotatedCornerCursor:function(t,n,r){var i=Math.round(n.angle%360/45);return i<0&&(i+=8),i+=e[t],r[this.altActionKey]&&e[t]%2===0&&(i+=2),i%=8,this.cursorMap[i]}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromJSON:function(e,t,n){if(!e)return;var r=typeof e=="string"?JSON.parse(e):fabric.util.object.clone(e),i=this,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(r.objects,function(e){i.clear(),i._setBgOverlay(r,function(){e.forEach(function(e,t){i.insertAt(e,t)}),i.renderOnAddRemove=s,delete r.objects,delete r.backgroundImage,delete r.overlayImage,delete r.background,delete r.overlay,i._setOptions(r),i.renderAll(),t&&t()})},n),this},_setBgOverlay:function(e,t){var n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay){t&&t();return}var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,n,r),this.__setBgOverlay("overlayImage",e.overlayImage,n,r),this.__setBgOverlay("backgroundColor",e.background,n,r),this.__setBgOverlay("overlayColor",e.overlay,n,r)},__setBgOverlay:function(e,t,n,r){var i=this;if(!t){n[e]=!0,r&&r();return}e==="backgroundImage"||e==="overlayImage"?fabric.util.enlivenObjects([t],function(t){i[e]=t[0],n[e]=!0,r&&r()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){n[e]=!0,r&&r()})},_enlivenObjects:function(e,t,n){if(!e||e.length===0){t&&t([]);return}fabric.util.enlivenObjects(e,function(e){t&&t(e)},null,n)},_toDataURL:function(e,t){this.clone(function(n){t(n.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,n){this.clone(function(r){n(r.toDataURLWithMultiplier(e,t))})}}),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.object.clone,i=t.util.toFixed,s=t.util.string.capitalize,o=t.util.degreesToRadians,u=t.StaticCanvas.supports("setLineDash"),a=!t.isLikelyNode,f=2;if(t.Object)return;t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),clipPath:undefined,inverted:!1,absolutePositioned:!1,initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var n=t.perfLimitSizeTotal,r=e.width,i=e.height,s=t.maxCacheSideLimit,o=t.minCacheSideLimit;if(r<=s&&i<=s&&r*i<=n)return r<o&&(e.width=o),i<o&&(e.height=o),e;var u=r/i,a=t.util.limitDimsByArea(u,n),f=t.util.capValue,l=f(o,a.x,s),c=f(o,a.y,s);return r>l&&(e.zoomX/=r/l,e.width=l,e.capped=!0),i>c&&(e.zoomY/=i/c,e.height=c,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.getTotalObjectScaling(),t=this._getNonTransformedDimensions(),n=e.scaleX,r=e.scaleY,i=t.x*n,s=t.y*r;return{width:i+f,height:s+f,zoomX:n,zoomY:r,x:t.x,y:t.y}},_updateCacheCanvas:function(){var e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){var n=e._currentTransform.target,r=e._currentTransform.action;if(this===n&&r.slice&&r.slice(0,5)==="scale")return!1}var i=this._cacheCanvas,s=this._limitCacheSize(this._getCacheCanvasDimensions()),o=t.minCacheSideLimit,u=s.width,a=s.height,f,l,c=s.zoomX,h=s.zoomY,p=u!==this.cacheWidth||a!==this.cacheHeight,d=this.zoomX!==c||this.zoomY!==h,v=p||d,m=0,g=0,y=!1;if(p){var b=this._cacheCanvas.width,w=this._cacheCanvas.height,E=u>b||a>w,S=(u<b*.9||a<w*.9)&&b>o&&w>o;y=E||S,E&&!s.capped&&(u>o||a>o)&&(m=u*.1,g=a*.1)}return v?(y?(i.width=Math.ceil(u+m),i.height=Math.ceil(a+g)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,i.width,i.height)),f=s.x*c/2,l=s.y*h/2,this.cacheTranslationX=Math.round(i.width/2-f)+f,this.cacheTranslationY=Math.round(i.height/2-l)+l,this.cacheWidth=u,this.cacheHeight=a,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(c,h),this.zoomX=c,this.zoomY=h,!0):!1},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initClipping(e),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t;this.group&&!this.group._transformDone?t=this.calcTransformMatrix():t=this.calcOwnMatrix(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},toObject:function(e){var n=t.Object.NUM_FRACTION_DIGITS,r={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:i(this.left,n),top:i(this.top,n),width:i(this.width,n),height:i(this.height,n),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,n),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,n),scaleX:i(this.scaleX,n),scaleY:i(this.scaleY,n),angle:i(this.angle,n),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,n),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:i(this.skewX,n),skewY:i(this.skewY,n)};return this.clipPath&&(r.clipPath=this.clipPath.toObject(e),r.clipPath.inverted=this.clipPath.inverted,r.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,r,e),this.includeDefaultValues||(r=this._removeDefaultValues(r)),r},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var n=t.util.getKlass(e.type).prototype,r=n.stateProperties;return r.forEach(function(t){e[t]===n[t]&&delete e[t];var r=Object.prototype.toString.call(e[t])==="[object Array]"&&Object.prototype.toString.call(n[t])==="[object Array]";r&&e[t].length===0&&n[t].length===0&&delete e[t]}),e},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){var e=this.scaleX,t=this.scaleY;if(this.group){var n=this.group.getObjectScaling();e*=n.scaleX,t*=n.scaleY}return{scaleX:e,scaleY:t}},getTotalObjectScaling:function(){var e=this.getObjectScaling(),t=e.scaleX,n=e.scaleY;if(this.canvas){var r=this.canvas.getZoom(),i=this.canvas.getRetinaScaling();t*=r*i,n*=r*i}return{scaleX:t,scaleY:n}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,n){var r=e==="scaleX"||e==="scaleY",i=this[e]!==n,s=!1;return r&&(n=this._constrainScale(n)),e==="scaleX"&&n<0?(this.flipX=!this.flipX,n*=-1):e==="scaleY"&&n<0?(this.flipY=!this.flipY,n*=-1):e!=="shadow"||!n||n instanceof t.Shadow?e==="dirty"&&this.group&&this.group.set("dirty",n):n=new t.Shadow(n),this[e]=n,i&&(s=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(e)>-1?(this.dirty=!0,s&&this.group.set("dirty",!0)):s&&this.stateProperties.indexOf(e)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||this.width===0&&this.height===0||!this.visible},render:function(e){if(this.isNotVisible())return;if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen())return;e.save(),this._setupCompositeOperation(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.clipTo&&t.util.clipContext(this,e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&e.restore(),e.restore()},renderCache:function(e){e=e||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return this.paintFirst==="stroke"&&typeof this.shadow=="object"?!0:this.clipPath?!0:!1},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(e){var n=this.clipPath;e.save(),n.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in";if(n.absolutePositioned){var r=t.util.invertTransform(this.calcTransformMatrix());e.transform(r[0],r[1],r[2],r[3],r[4],r[5])}n.transform(e),e.scale(1/n.zoomX,1/n.zoomY),e.drawImage(n._cacheCanvas,-n.cacheTranslationX,-n.cacheTranslationY),e.restore()},drawObject:function(e,t){t?this._setClippingProperties(e):(this._renderBackground(e),this._setStrokeStyles(e,this),this._setFillStyles(e,this)),this._render(e),this._drawClipPath(e)},_drawClipPath:function(e){var t=this.clipPath;if(!t)return;t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(e)},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!e){var t=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-n/2,t,n)}return!0}return!1},_renderBackground:function(e){if(!this.backgroundColor)return;var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){t.stroke&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,e.strokeStyle=t.stroke.toLive?t.stroke.toLive(e,this):t.stroke)},_setFillStyles:function(e,t){t.fill&&(e.fillStyle=t.fill.toLive?t.fill.toLive(e,this):t.fill)},_setClippingProperties:function(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"},_setLineDash:function(e,t,n){if(!t)return;1&t.length&&t.push.apply(t,t),u?e.setLineDash(t):n&&n(e)},_renderControls:function(e,n){var r=this.getViewportTransform(),i=this.calcTransformMatrix(),s,u,a;n=n||{},u=typeof n.hasBorders!="undefined"?n.hasBorders:this.hasBorders,a=typeof n.hasControls!="undefined"?n.hasControls:this.hasControls,i=t.util.multiplyTransformMatrices(r,i),s=t.util.qrDecompose(i),e.save(),e.translate(s.translateX,s.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),n.forActiveSelection?(e.rotate(o(s.angle)),u&&this.drawBordersInGroup(e,s,n)):(e.rotate(o(this.angle)),u&&this.drawBorders(e,n)),a&&this.drawControls(e,n),e.restore()},_setShadow:function(e){if(!this.shadow)return;var n=this.canvas&&this.canvas.viewportTransform[0]||1,r=this.canvas&&this.canvas.viewportTransform[3]||1,i=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(n*=t.devicePixelRatio,r*=t.devicePixelRatio),e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur*t.browserShadowBlurConstant*(n+r)*(i.scaleX+i.scaleY)/4,e.shadowOffsetX=this.shadow.offsetX*n*i.scaleX,e.shadowOffsetY=this.shadow.offsetY*r*i.scaleY},_removeShadow:function(e){if(!this.shadow)return;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var n=t.gradientTransform||t.patternTransform,r=-this.width/2+t.offsetX||0,i=-this.height/2+t.offsetY||0;return e.translate(r,i),n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:r,offsetY:i}},_renderPaintInOrder:function(e){this.paintFirst==="stroke"?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_renderFill:function(e){if(!this.fill)return;e.save(),this._applyPatternGradientTransform(e,this.fill),this.fillRule==="evenodd"?e.fill("evenodd"):e.fill(),e.restore()},_renderStroke:function(e){if(!this.stroke||this.strokeWidth===0)return;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(e,this.stroke),e.stroke(),e.restore()},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var n=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),n=t.util.transformPoint(n,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,n.x+=e.offsetLeft,n.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(n,"center","center")},clone:function(e,n){var r=this.toObject(n);this.constructor.fromObject?this.constructor.fromObject(r,e):t.Object._fromObject("Object",r,e)},cloneAsImage:function(e,n){var r=this.toDataURL(n);return t.util.loadImage(r,function(n){e&&e(new t.Image(n))}),this},toDataURL:function(e){e||(e={});var n=t.util,r=n.saveObjectTransform(this),i=this.shadow,s=Math.abs;e.withoutTransform&&n.resetObjectTransform(this),e.withoutShadow&&(this.shadow=null);var o=t.util.createCanvasElement(),u=this.getBoundingRect(!0,!0),a=this.shadow,f,l={x:0,y:0},c;a&&(c=a.blur,f=this.getObjectScaling(),l.x=2*Math.round((s(a.offsetX)+c)*s(f.scaleX)),l.y=2*Math.round((s(a.offsetY)+c)*s(f.scaleY))),o.width=u.width+l.x,o.height=u.height+l.y,o.width+=o.width%2?2-o.width%2:0,o.height+=o.height%2?2-o.height%2:0;var h=new t.StaticCanvas(o,{enableRetinaScaling:e.enableRetinaScaling,renderOnAddRemove:!1,skipOffscreen:!1});e.format==="jpeg"&&(h.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(h.width/2,h.height/2),"center","center");var p=this.canvas;h.add(this);var d=h.toDataURL(e);return this.shadow=i,this.set(r).setCoords(),this.canvas=p,h._objects=[],h.dispose(),h=null,d},isType:function(e){return this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},setGradient:function(e,n){n||(n={});var r={colorStops:[]};r.type=n.type||(n.r1||n.r2?"radial":"linear"),r.coords={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2};if(n.r1||n.r2)r.coords.r1=n.r1,r.coords.r2=n.r2;return r.gradientTransform=n.gradientTransform,t.Gradient.prototype.addColorStop.call(r,n.colorStops),this.set(e,t.Gradient.forObject(this,r))},setPatternFill:function(e,n){return this.set("fill",new t.Pattern(e,n))},setShadow:function(e){return this.set("shadow",e?new t.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},rotate:function(e){var t=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,n){n=n||this.canvas.getPointer(e);var r=new t.Point(n.x,n.y),i=this._getLeftTopCoords();return this.angle&&(r=t.util.rotatePoint(r,i,o(-this.angle))),{x:r.x-i.x,y:r.y-i.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),n(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(e,n,i,s){var o=t[e];n=r(n,!0),t.util.enlivenPatterns([n.fill,n.stroke],function(e){typeof e[0]!="undefined"&&(n.fill=e[0]),typeof e[1]!="undefined"&&(n.stroke=e[1]),t.util.enlivenObjects([n.clipPath],function(e){n.clipPath=e[0];var t=s?new o(n[s],n):new o(n);i&&i(t)})})},t.Object.__uid=0}(typeof exports!="undefined"?exports:this),function(){var e=fabric.util.degreesToRadians,t={left:-0.5,center:0,right:.5},n={top:-0.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(e,r,i,s,o){var u=e.x,a=e.y,f,l,c;typeof r=="string"?r=t[r]:r-=.5,typeof s=="string"?s=t[s]:s-=.5,f=s-r,typeof i=="string"?i=n[i]:i-=.5,typeof o=="string"?o=n[o]:o-=.5,l=o-i;if(f||l)c=this._getTransformedDimensions(),u=e.x+f*c.x,a=e.y+l*c.y;return new fabric.Point(u,a)},translateToCenterPoint:function(t,n,r){var i=this.translateToGivenOrigin(t,n,r,"center","center");return this.angle?fabric.util.rotatePoint(i,t,e(this.angle)):i},translateToOriginPoint:function(t,n,r){var i=this.translateToGivenOrigin(t,"center","center",n,r);return this.angle?fabric.util.rotatePoint(i,t,e(this.angle)):i},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var n=this.getCenterPoint();return this.translateToOriginPoint(n,e,t)},toLocalPoint:function(t,n,r){var i=this.getCenterPoint(),s,o;return typeof n!="undefined"&&typeof r!="undefined"?s=this.translateToGivenOrigin(i,"center","center",n,r):s=new fabric.Point(this.left,this.top),o=new fabric.Point(t.x,t.y),this.angle&&(o=fabric.util.rotatePoint(o,i,-e(this.angle))),o.subtractEquals(s)},setPositionByOrigin:function(e,t,n){var r=this.translateToCenterPoint(e,t,n),i=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(n){var r=e(this.angle),i=this.getScaledWidth(),s=fabric.util.cos(r)*i,o=fabric.util.sin(r)*i,u,a;typeof this.originX=="string"?u=t[this.originX]:u=this.originX-.5,typeof n=="string"?a=t[n]:a=n-.5,this.left+=s*(a-u),this.top+=o*(a-u),this.setCoords(),this.originX=n},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function e(e){return[new fabric.Point(e.tl.x,e.tl.y),new fabric.Point(e.tr.x,e.tr.y),new fabric.Point(e.br.x,e.br.y),new fabric.Point(e.bl.x,e.bl.y)]}var t=fabric.util.degreesToRadians,n=fabric.util.multiplyTransformMatrices,r=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,n){this.oCoords||this.setCoords();var r=t?this.aCoords:this.oCoords;return e(n?this.calcCoords(t):r)},intersectsWithRect:function(e,t,n,r){var i=this.getCoords(n,r),s=fabric.Intersection.intersectPolygonRectangle(i,e,t);return s.status==="Intersection"},intersectsWithObject:function(e,t,n){var r=fabric.Intersection.intersectPolygonPolygon(this.getCoords(t,n),e.getCoords(t,n));return r.status==="Intersection"||e.isContainedWithinObject(this,t,n)||this.isContainedWithinObject(e,t,n)},isContainedWithinObject:function(e,t,n){var r=this.getCoords(t,n),i=0,s=e._getImageLines(n?e.calcCoords(t):t?e.aCoords:e.oCoords);for(;i<4;i++)if(!e.containsPoint(r[i],s))return!1;return!0},isContainedWithinRect:function(e,t,n,r){var i=this.getBoundingRect(n,r);return i.left>=e.x&&i.left+i.width<=t.x&&i.top>=e.y&&i.top+i.height<=t.y},containsPoint:function(e,t,n,r){var t=t||this._getImageLines(r?this.calcCoords(n):n?this.aCoords:this.oCoords),i=this._findCrossPoints(e,t);return i!==0&&i%2===1},isOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,r=this.getCoords(!0,e),i;for(var s=0;s<4;s++){i=r[s];if(i.x<=n.x&&i.x>=t.x&&i.y<=n.y&&i.y>=t.y)return!0}return this.intersectsWithRect(t,n,!0,e)?!0:this._containsCenterOfCanvas(t,n,e)},_containsCenterOfCanvas:function(e,t,n){var r={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return this.containsPoint(r,null,!0,n)?!0:!1},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br;return this.intersectsWithRect(t,n,!0,e)?!0:this._containsCenterOfCanvas(t,n,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var n,r,i,s,o,u=0,a;for(var f in t){a=t[f];if(a.o.y<e.y&&a.d.y<e.y)continue;if(a.o.y>=e.y&&a.d.y>=e.y)continue;a.o.x===a.d.x&&a.o.x>=e.x?o=a.o.x:(n=0,r=(a.d.y-a.o.y)/(a.d.x-a.o.x),i=e.y-n*e.x,s=a.o.y-r*a.o.x,o=-(i-s)/(n-r)),o>=e.x&&(u+=1);if(u===2)break}return u},getBoundingRect:function(e,t){var n=this.getCoords(e,t);return fabric.util.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e===0?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var n=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/n)},scaleToHeight:function(e,t){var n=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/n)},calcCoords:function(e){var i=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),o=n(s,i),u=this.getViewportTransform(),a=e?o:n(u,o),f=this._getTransformedDimensions(),l=f.x/2,c=f.y/2,h=r({x:-l,y:-c},a),p=r({x:l,y:-c},a),d=r({x:-l,y:c},a),v=r({x:l,y:c},a);if(!e){var m=this.padding,g=t(this.angle),y=fabric.util.cos(g),b=fabric.util.sin(g),w=y*m,E=b*m,S=w+E,x=w-E;m&&(h.x-=x,h.y-=S,p.x+=S,p.y-=x,d.x-=S,d.y+=x,v.x+=x,v.y+=S);var T=new fabric.Point((h.x+d.x)/2,(h.y+d.y)/2),N=new fabric.Point((p.x+h.x)/2,(p.y+h.y)/2),C=new fabric.Point((v.x+p.x)/2,(v.y+p.y)/2),k=new fabric.Point((v.x+d.x)/2,(v.y+d.y)/2),L=new fabric.Point(N.x+b*this.rotatingPointOffset,N.y-y*this.rotatingPointOffset)}var A={tl:h,tr:p,br:v,bl:d};return e||(A.ml=T,A.mt=N,A.mr=C,A.mb=k,A.mtr=L),A},setCoords:function(e,t){return this.oCoords=this.calcCoords(e),t||(this.aCoords=this.calcCoords(!0)),e||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var e=t(this.angle),n=fabric.util.cos(e),r=fabric.util.sin(e);return[n,r,-r,n,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="_",n="";return!e&&this.group&&(n=this.group.transformMatrixKey(e)+t),n+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){if(e)return this.calcOwnMatrix();var t=this.transformMatrixKey(),r=this.matrixCache||(this.matrixCache={});if(r.key===t)return r.value;var i=this.calcOwnMatrix();return this.group&&(i=n(this.group.calcTransformMatrix(),i)),r.key=t,r.value=i,i},calcOwnMatrix:function(){var e=this.transformMatrixKey(!0),t=this.ownMatrixCache||(this.ownMatrixCache={});if(t.key===e)return t.value;var r=this._calcTranslateMatrix(),i,s=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(i=this._calcRotateMatrix(),r=n(r,i)),r=n(r,s),t.key=e,t.value=r,r},_calcDimensionsTransformMatrix:function(e,r,i){var s,o=this.scaleX*(i&&this.flipX?-1:1),u=this.scaleY*(i&&this.flipY?-1:1),a=[o,0,0,u,0,0];return e&&(s=[1,0,Math.tan(t(e)),1],a=n(a,s,!0)),r&&(s=[1,Math.tan(t(r)),0,1],a=n(a,s,!0)),a},_getNonTransformedDimensions:function(){var e=this.strokeWidth,t=this.width+e,n=this.height+e;return{x:t,y:n}},_getTransformedDimensions:function(e,t){typeof e=="undefined"&&(e=this.skewX),typeof t=="undefined"&&(t=this.skewY);var n=this._getNonTransformedDimensions();if(e===0&&t===0)return{x:n.x*this.scaleX,y:n.y*this.scaleY};var r=n.x/2,i=n.y/2,s=[{x:-r,y:-i},{x:r,y:-i},{x:-r,y:i},{x:r,y:i}],o,u=this._calcDimensionsTransformMatrix(e,t,!1),a;for(o=0;o<s.length;o++)s[o]=fabric.util.transformPoint(s[o],u);return a=fabric.util.makeBoundingBoxFromPoints(s),{x:a.width,y:a.height}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions(),n=fabric.util.transformPoint(t,e,!0);return n.scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),s.requestRenderAll(),i()},onComplete:function(){e.setCoords(),r()}}),this},fxCenterObjectV:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),s.requestRenderAll(),i()},onComplete:function(){e.setCoords(),r()}}),this},fxRemove:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){e.set("opacity",t),s.requestRenderAll(),i()},onComplete:function(){s.remove(e),r()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var e=[],t,n;for(t in arguments[0])e.push(t);for(var r=0,i=e.length;r<i;r++)t=e[r],n=r!==i-1,this._animate(t,arguments[0][t],arguments[1],n)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,n,r){var i=this,s;t=t.toString(),n?n=fabric.util.object.clone(n):n={},~e.indexOf(".")&&(s=e.split("."));var o=s?this.get(s[0])[s[1]]:this.get(e);"from"in n||(n.from=o),~t.indexOf("=")?t=o+parseFloat(t.replace("=","")):t=parseFloat(t),fabric.util.animate({startValue:n.from,endValue:t,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(){return n.abort.call(i)},onChange:function(t,o,u){s?i[s[0]][s[1]]=t:i.set(e,t);if(r)return;n.onChange&&n.onChange(t,o,u)},onComplete:function(e,t,s){if(r)return;i.setCoords(),n.onComplete&&n.onComplete(e,t,s)}})}}),function(e){var t=fabric.util.object.extend;e.fabric||(e.fabric={});if(e.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(e,t){t||(t={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",t),this._initElement(e,t)},getElement:function(){return this._element||{}},setElement:function(e,t){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=e,this._originalElement=e,this._initConfig(t),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(e){var t=fabric.filterBackend;t&&t.evictCachesForKey&&t.evictCachesForKey(e)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=undefined,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(e){fabric.util.cleanUpJsdomNode(this[e]),this[e]=undefined}.bind(this))},setCrossOrigin:function(e){return this.crossOrigin=e,this._element.crossOrigin=e,this},getOriginalSize:function(){var e=this.getElement();return{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}},_stroke:function(e){if(!this.stroke||this.strokeWidth===0)return;var t=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-t,-n),e.lineTo(t,-n),e.lineTo(t,n),e.lineTo(-t,n),e.lineTo(-t,-n),e.closePath()},_renderDashedStroke:function(e){var t=-this.width/2,n=-this.height/2,r=this.width,i=this.height;e.save(),this._setStrokeStyles(e,this),e.beginPath(),fabric.util.drawDashedLine(e,t,n,t+r,n,this.strokeDashArray),fabric.util.drawDashedLine(e,t+r,n,t+r,n+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t+r,n+i,t,n+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t,n+i,t,n,this.strokeDashArray),e.closePath(),e.restore()},toObject:function(e){var n=[];this.filters.forEach(function(e){e&&n.push(e.toObject())});var r=t(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(e)),{src:this.getSrc(),filters:n});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},getSrc:function(e){var t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():t.src:this.src||""},setSrc:function(e,t,n){return fabric.util.loadImage(e,function(e){this.setElement(e,n),this._setWidthHeight(),t(this)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,t=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),r=n.scaleX,i=n.scaleY,s=this._filteredEl||this._originalElement;this.group&&this.set("dirty",!0);if(!e||r>t&&i>t){this._element=s,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,this._lastScaleY=i;return}fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var o=fabric.util.createCanvasElement(),u=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,a=s.width,f=s.height;o.width=a,o.height=f,this._element=o,this._lastScaleX=e.scaleX=r,this._lastScaleY=e.scaleY=i,fabric.filterBackend.applyFilters([e],s,a,f,this._element,u),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height},applyFilters:function(e){e=e||this.filters||[],e=e.filter(function(e){return e&&!e.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered");if(e.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,n=t.naturalWidth||t.width,r=t.naturalHeight||t.height;if(this._element===this._originalElement){var i=fabric.util.createCanvasElement();i.width=n,i.height=r,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,r),this._lastScaleX=1,this._lastScaleY=1;fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(e,this._originalElement,n,r,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height;return this},_render:function(e){this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)},shouldCache:function(){return this.ownCaching=this.objectCaching&&this.needsItsOwnCache(),this.ownCaching},_renderFill:function(e){var t=this.width,n=this.height,r=t*this._filterScalingX,i=n*this._filterScalingY,s=-t/2,o=-n/2,u=this._element;u&&e.drawImage(u,s,o,t,n)},_needsResize:function(){var e=this.getTotalObjectScaling();return e.scaleX!==this._lastScaleX||e.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(e,t){this.setElement(fabric.util.getById(e),t),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(e,t){e&&e.length?fabric.util.enlivenObjects(e,function(e){t&&t(e)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){e||(e={});var t=this.getElement();this.width=e.width||t.naturalWidth||t.width||0,this.height=e.height||t.naturalHeight||t.height||0},parsePreserveAspectRatioAttribute:function(){var e=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),t=this._element.width,n=this._element.height,r=1,i=1,s=0,o=0,u=0,a=0,f,l=this.width,c=this.height,h={width:l,height:c};return!e||e.alignX==="none"&&e.alignY==="none"?(r=l/t,i=c/n):(e.meetOrSlice==="meet"&&(r=i=fabric.util.findScaleToFit(this._element,h),f=(l-t*r)/2,e.alignX==="Min"&&(s=-f),e.alignX==="Max"&&(s=f),f=(c-n*i)/2,e.alignY==="Min"&&(o=-f),e.alignY==="Max"&&(o=f)),e.meetOrSlice==="slice"&&(r=i=fabric.util.findScaleToCover(this._element,h),f=t-l/r,e.alignX==="Mid"&&(u=f/2),e.alignX==="Max"&&(u=f),f=n-c/i,e.alignY==="Mid"&&(a=f/2),e.alignY==="Max"&&(a=f),t=l/r,n=c/i)),{width:t,height:n,scaleX:r,scaleY:i,offsetLeft:s,offsetTop:o,cropX:u,cropY:a}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(e,t){var n=fabric.util.object.clone(e);fabric.util.loadImage(n.src,function(e,r){if(r){t&&t(null,r);return}fabric.Image.prototype._initFilters.call(n,n.filters,function(r){n.filters=r||[],fabric.Image.prototype._initFilters.call(n,[n.resizeFilter],function(r){n.resizeFilter=r[0],fabric.util.enlivenObjects([n.clipPath],function(r){n.clipPath=r[0];var i=new fabric.Image(e,n);t(i)})})})},null,n.crossOrigin)},fabric.Image.fromURL=function(e,t,n){fabric.util.loadImage(e,function(e){t&&t(new fabric.Image(e,n))},null,n&&n.crossOrigin)}}(typeof exports!="undefined"?exports:this),define("view/GlazeView",["require","jquery","underscore","utils/Logger","utils/Events","backbone","view/ElementView","text!view/GlazeView.html","jqueryUI","utils/PostMessageManager","utils/ConditionChecker","utils/TrackingManager","utils/MiscUtils","mobiledetect","fabric","Settings","AppModel"],function(require){var $=require("jquery"),_=require("underscore"),Logger=require("utils/Logger"),Events=require("utils/Events"),Backbone=require("backbone"),ElementView=require("view/ElementView"),template=require("text!view/GlazeView.html"),jqueryUI=require("jqueryUI"),PostMessageManager=require("utils/PostMessageManager"),ConditionChecker=require("utils/ConditionChecker"),TrackingManager=require("utils/TrackingManager"),MiscUtils=require("utils/MiscUtils"),mobiledetect=require("mobiledetect"),fabric=require("fabric"),Settings=require("Settings"),md=new mobiledetect(window.navigator.userAgent);return Backbone.View.extend({className:"glaze-exclude glaze-layer",attributes:{role:"dialog",tabindex:-1,"aria-labelledby":function(){return"title-trick-"+Date.now()}()},contentIntentDone:null,appData:null,currentScreenSize:null,elements:[],canvas:null,isShown:!1,isReadyToShow:!1,isImpressionTracked:!1,isAbandonTracked:!1,isClickTracked:!1,canvasReady:null,canvasLoading:null,autoscrollStarted:null,deferredConditions:[],rolledElement:null,triggeredOnScroll:0,abHasGlaze:1,transitionRunning:!1,transitionScrollTop:null,waitingForElementInteval:null,savedDimensions:null,initialize:function(e){_.extend(this,e),this.appData=require("AppModel"),this.listenTo(this,"releaseDeferredCondition",_.bind(this._releaseDeferredCondition,this)),this.selectVariant(),Backbone.View.prototype.initialize.apply(this,arguments)},events:{"click button.close":"clickCloseIcon","keydown .glaze-space-press":"handleSpace"},selectVariant:function(){var e=_.sortBy(this.model.get("variants"),function(e){return!e.screen_size.max||e.screen_size.max==0?1e6:Number(e.screen_size.max)}),t=_.sortBy(this.model.get("variants"),function(e){return e.screen_size.min}),n=_.find(this.model.get("variants"),function(e){return e.screen_size.is_default==1||!e.screen_size.max||e.screen_size.max==0}),r=$(window).width(),i;i=_.find(e,function(e){var t=e.screen_size.max&&e.screen_size.max!=0?e.screen_size.max:1e6;return Number(t)>=r}),i||(this.model.get("campaign_is_mobile_first")==1&&t&&t.length?i=t[0]:i=n),this.currentScreenSize=i.screen_size,Logger.log("Glaze: variant select - "+this.currentScreenSize.title),this.model.set("variant",new(Backbone.Model.extend({getXpath:function(e){var t=this.get("xpath"),n=_.isUndefined(e)?0:e;return t[n]?t[n]:null},getSelector:function(e){var t=this.get("selector"),n=_.isUndefined(e)?0:e,r=this.get("promoted_product")||{};t=t[n]?t[n]:null;if(!t)return null;var i=[{placeholder:"{PROMOTED_PRODUCT.PID}",value:r.pid}];return _.each(i,function(e){t=t.replace(e.placeholder,e.value)}),t}}))(i));var s=i.json?JSON.parse(i.json):{};s.settings=i.settings?JSON.parse(i.settings):{},this.model.get("variant").set(_.omit(s,"shape_id")),this.model.get("variant").set("promoted_product",this.model.get("promoted_product")),(_.isString(s.xpath)||!s.xpath)&&this.model.get("variant").set("xpath",{0:s.xpath}),(_.isString(s.selector)||!s.selector)&&this.model.get("variant").set("selector",{0:s.selector})},render:function(){return this.$el.html(_.template(template)({data:this,settings:this._getSettings()})),this.renderElements(),this},renderElements:function(){_.each(this.model.get("variant").get("elements"),_.bind(function(e){var t=(new ElementView({model:new Backbone.Model(e),parent:this})).render();this.$(".glaze-elements").append(t.$el),t.initControls(),this.elements.push(t)},this))},initCanvas:function(){this.canvasReady=null;if(this.canvasLoading)return;this.canvasLoading=!0,this.canvas=new fabric.Canvas("canvas-shape-"+this.cid);var e=this.model.get("variant").get("canvasJSON");if(e&&e.objects&&e.objects.length){var t=_.find(this.appData.get("shapes"),_.bind(function(e){return Number(e.id)===Number(this.model.get("variant").get("shape_id"))},this));e.objects[0].src=t.base64src}e?this.canvas.loadFromJSON(e,_.bind(function(){this.canvas.renderAll.bind(this.canvas),e.objects.length||(this.updateGlazePosition(),this.canvasReady=!0)},this),_.bind(function(e,t){t.on("added",_.bind(function(){this.updateGlazePosition(),this.canvasReady=!0},this))},this)):Logger.log("Glaze: Canvas JSON not found"),this.$(".glaze-wrapper").css("opacity",this.model.get("variant").get("background_opacity"))},updateGlazeDimensions:function(e,t){this.canvas||this.initCanvas(),this.canvas.setDimensions({width:e,height:t}),this.canvas.calcOffset()},clickVoid:function(e){e&&e.preventDefault();var t=this.model.get("variant").getSelector(0),n=this._getSettings();if(n.a11y_shape_btn_active_element)$(n.a11y_shape_btn_active_element)[0].click(),this.clickShape(e,{clickInVoid:!0});else if(t&&$(t).length)$(t)[0].click(),this.clickShape(e,{clickInVoid:!0});else{var r=this.$(".glaze-shape-button").position(),i=r.left+this.$(".glaze-shape-button").outerWidth()/2,s=r.top+this.$(".glaze-shape-button").outerHeight()/2;document.elementFromPoint(i,s).click()}},handleSpace:function(e){e.keyCode===32&&(e.preventDefault(),window.location=$(e.currentTarget).attr("href"))},updateGlazePosition:function(){var e=this.model.get("variant").get("shapeOffset"),t=this.model.get("variant").get("scaleOffset"),n=this._getSettings(),r=this.canvas&&this.canvas.getObjects().length,i,s,o;_.times(r,_.bind(function(n){i=this.canvas.item(n),s=this.model.get("variant").getXpath(n),o=this.model.get("variant").getSelector(n);if(i)if(s!=""||o!=""||this.rolledElement){var r=this.rolledElement||(o?$(o).get(0):document.evaluate(s,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),u=$(r);if(!u.length)return;var a=this.calculateSpotlightArea(u),f=a.width/i.get("width")+(t.scaleX?t.scaleX:0),l=a.height/i.get("height")+(t.scaleY?t.scaleY:0);i.set({left:a.left+(e.left?e.left:0),top:a.top+(e.top?e.top:0),scaleX:f,scaleY:l}),this.$el.find(".glaze-shape-button").css({left:a.left+(e.left?e.left:0),top:a.top+(e.top?e.top:0),width:i.get("width")*f+"px",height:i.get("height")*l+"px"}),i.setCoords(),this.canvas.renderAll()}},this)),this.updateXIconPosition(),this.updateGlazeElementsPosition()},updateXIconPosition:function(){if(!this.canvas)return;var e=this.model.get("variant").getXpath(0),t=this.model.get("variant").getSelector(0),n=this._getSettings(),r=this.canvas.item(0),i=this.$("span.close");if(r)if(e!=""||t!=""||this.rolledElement){var s=this.rolledElement||(t?$(t).get(0):document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),o=$(s);if(!o.length)return;var u=this.calculateSpotlightArea(o);n.x_image_position&&n.x_image_position=="void_tr"?i.css({top:u.top+5+"px",left:u.left+u.width-5+"px",position:"absolute"}):i.css({top:"15px",right:"20px",left:"auto",position:"fixed"})}},hideXIcon:function(){this.$("span.close").hide()},showXIcon:function(){var e=this._getSettings();e.close_click_x&&this.$("span.close").show()},calculateSpotlightArea:function(e){var t=this._getSettings(),n={left:99999999999,top:99999999999,bottom:0,right:0},r=t.spotlight_areas?$(t.spotlight_areas).add(e):e;return r.each(function(){var e=$(this),t=e[0].getBoundingClientRect();t.height=t.bottom-t.top,e.is(":visible")&&t.width>0&&t.height>0&&(n.left=_.min([n.left,e.offset().left]),n.top=_.min([n.top,e.offset().top]),n.right=_.max([n.right,e.offset().left+t.width]),n.bottom=_.max([n.bottom,e.offset().top+t.height]))}),n.width=n.right-n.left,n.height=n.bottom-n.top,delete n.bottom,delete n.right,n},updateGlazeElementsPosition:function(){_.each(this.elements,function(e){e.updatePosition()})},applySettings:function(e){e=e||!1;var t=this._getSettings();e||this._setDeferredConditions(t.advanced_settings),e?this.isShown||this.showGlaze(e):!t.exit_intent&&!t.content_intent&&!t.roll_on?setTimeout(_.bind(this.showGlaze,this),t.trigger_timer&&t.timer_in?t.timer_in:0):(t.exit_intent||t.content_intent)&&t.trigger_timer&&t.timer_in&&setTimeout(_.bind(function(){this.isShown||this.showGlaze()},this),t.timer_in)},showGlaze:function(e){e=e||!1;var t=this._getSettings(),n=!1;if(!this.canvasReady){this.initCanvas(),setTimeout(_.bind(function(){this.showGlaze(e)},this),300);return}var r=this._getSettings(),i=JSON.parse(this.model.get("campaign_settings")||"{}");if(!e)if(!this.parent.passAdditionalSettings(r.advanced_settings)||!this.parent.passAdditionalSettings(i.advanced_settings||[])||!this.parent.passCampaignSettings(this.model.toJSON()))return Logger.log("Glaze: glaze "+this.model.get("title")+" did not pass conditions on glaze show"),!1;if(this.deferredConditions.length){Logger.log("Glaze: ready to show, waiting for deferred conditions to complete");return}if(!this.isElementCreated()){if(!this.waitingForElementInteval){Logger.log("Glaze: ready to show, binded element not found or not created yet"),TrackingManager.notifyNoElement(this.model.get("id"),this.model.get("variant").getXpath(0)||this.model.get("variant").getSelector(0));if(t.out_viewport_action_type==="glaze"&&t.out_viewport_action_glaze){Logger.log("Glaze: open glaze by action if binded element is not found"),this.undelegateResizeListener(),this.isShown=!1,$("html,body").stop(),$("body").removeClass("glaze-effect"),this.removeAdditionalCss(),this.remove(),this.parent.openGlazeById(t.out_viewport_action_glaze,!1);return}this.isReadyToShow=!0,this.waitingForElementInteval=setInterval(_.bind(this.showGlaze,this),400)}else Logger.log("Glaze: Waiting for element to be created");return}clearInterval(this.waitingForElementInteval),this.waitingForElementInteval=null,this.parent.restartingGlaze==this.model.get("id")&&(t.autoscroll=!0,n=!0,this.parent.restartingGlaze=null);if(!this.isShapeVisible()){Logger.log("Glaze: ready to show, shape is out of the viewport"),this.isReadyToShow=!0,t.autoscroll||t.exit_intent?this.autoscroll(undefined,n):this.waitingForViewportElementInteval||(this.waitingForViewportElementInteval=setInterval(_.bind(this.showGlaze,this),400));return}this.waitingForViewportElementInteval&&(clearInterval(this.waitingForViewportElementInteval),this.waitingForViewportElementInteval=null),this.selectABVersion(),this.isReadyToShow=!1,(t.autoscroll||t.exit_intent)&&this.autoscroll(undefined,n),Logger.log("Glaze: show"),this.parent.hideRestart(),this.executePreJS(),this.beforeShow(),this.applyAdditionalCss(),this.parent.updateDimensions(),this.animateIn(t.animate_in,function(){setTimeout(_.bind(this.afterShow,this),300),t.close_timer&&t.timer_out&&setTimeout(_.bind(this.hideGlaze,this),t.timer_out)}),this.$el.parent().focus()},applyAdditionalCss:function(){var e=this._getSettings(),t=this.appData.get("website").additional_css;t&&$('<style type="text/css" id="glazeWebsiteStyles">'+t+"</style>").appendTo("head"),e.campaign_css_rules&&$('<style type="text/css" id="glazeCampaignStyles">'+e.campaign_css_rules+"</style>").appendTo("head"),e.css_rules&&$('<style type="text/css" id="glazeStyles">'+e.css_rules+"</style>").appendTo("head")},removeAdditionalCss:function(){$("head").find("#glazeStyles").remove(),$("head").find("#glazeCampaignStyles").remove(),$("head").find("#glazeWebsiteStyles").remove()},selectABVersion:function(){var e=(this._getSettings().show_percent||100)/100,t=this.parent.randomSeedAB,n=this.parent.abHasGlaze;n!=-1?this.abHasGlaze=n:(this.abHasGlaze=e>=t?1:0,Logger.log("Glaze: version without glaze percent: "+this._getSettings().show_percent),TrackingManager.setAB(this.model.get("campaign_id"),this.abHasGlaze),this.parent.abHasGlaze=this.abHasGlaze),this.abHasGlaze==0&&!this.appData.get("preview")?(Logger.log("Glaze: A/B testing, version without glaze"),this.$el.css({visibility:"hidden",pointerEvents:"none"}),_.each(this.elements,function(e){e.$el.css({visibility:"hidden",pointerEvents:"none"})}),this.parent.renderAllAvailableGlazes(this.model.get("id"))):Logger.log("Glaze: A/B testing, version with glaze")},actionOnGlazeOpen:function(){var settings=this._getSettings(),actionCode=settings.open_action_js;if(actionCode){actionCode=actionCode.replace(/GLAZE_ID/g,"'"+this.model.get("id")+"'"),actionCode=actionCode.replace(/GLAZE_TITLE/g,"'"+this.model.get("title")+"'"),actionCode=actionCode.replace(/CAMPAIGN_ID/g,"'"+this.model.get("campaign_id")+"'"),actionCode=actionCode.replace(/[‘’]+/g,"'"),Logger.log("Glaze: execute action on glaze open "+actionCode);try{eval(actionCode)}catch(err){console.warn("Error in Action on Glaze Open"),console.warn(err)}}var singleTagAction=settings.universal_action_js;if(singleTagAction){singleTagAction=MiscUtils.prepareActionCode(singleTagAction,"GLAZE_OPEN",this.model.get("id"),this.model.get("title"),this.model.get("campaign_id"),this.model.get("campaign_title"),this.abHasGlaze),Logger.log("Glaze: execute single tag action on glaze open "+singleTagAction);try{eval(singleTagAction)}catch(err){console.warn("Error in Single Tag Action on Glaze Open"),console.warn(err)}}Events.dispatch("glazeActivated",{glaze_id:this.model.get("id"),campaign_id:this.model.get("campaign_id"),campaign_title:this.model.get("campaign_title"),glaze_title:this.model.get("title"),glaze_visible:this.abHasGlaze?"yes":"no"})},executePreJS:function(){this.appData.get("website").prejs&&eval(this.appData.get("website").prejs)},executePostJS:function(){this.appData.get("website").postjs&&eval(this.appData.get("website").postjs)},animateIn:function(e,t){var e=e&&e!=="null"?e:"none",n=this._getSettings();n.z_index&&this.parent.$el.css("zIndex",n.z_index),Logger.log("Glaze: animate in - "+e);switch(e){case"Dissolve":this.$el.fadeIn(700,_.bind(t,this));break;case"Move left to right":this.$el.css({left:"-100%",display:"block"}).animate({left:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move right to left":this.$el.css({left:"100%",display:"block"}).animate({left:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move top to bottom":this.$el.css({top:"-100%",display:"block"}).animate({top:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move bottom to top":this.$el.css({top:"100%",display:"block"}).animate({top:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move top left to bottom right":this.$el.css({top:"-100%",left:"-100%",display:"block"}).animate({top:0,left:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move top right to bottom left":this.$el.css({top:"-100%",left:"100%",display:"block"}).animate({top:0,left:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move bottom left to top right":this.$el.css({top:"100%",left:"-100%",display:"block"}).animate({top:0,left:0},1e3,"easeOutCirc",_.bind(t,this));break;case"Move bottom right to top left":this.$el.css({top:"100%",left:"100%",display:"block"}).animate({top:0,left:0},1e3,"easeOutCirc",_.bind(t,this));break;case"none":this.$el.css({display:"block"})&&t.call(this);break;default:this.$el.show(e.toLowerCase(),1e3,_.bind(t,this))}},animateOut:function(e,t){var e=e&&e!=="null"?e:"none";this.parent.$el.css("zIndex",9e3),Logger.log("Glaze: animate out - "+e);switch(e){case"Dissolve":this.$el.fadeOut(700,_.bind(t,this));break;case"Move left to right":this.$el.css({left:0,display:"block"}).animate({left:"100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move right to left":this.$el.css({left:0,display:"block"}).animate({left:"-100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move top to bottom":this.$el.css({top:0,display:"block"}).animate({top:"100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move bottom to top":this.$el.css({top:0,display:"block"}).animate({top:"-100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move top left to bottom right":this.$el.css({top:0,left:0,display:"block"}).animate({top:"100%",left:"100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move top right to bottom left":this.$el.css({top:0,left:0,display:"block"}).animate({top:"100%",left:"-100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move bottom left to top right":this.$el.css({top:0,left:0,display:"block"}).animate({top:"-100%",left:"100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"Move bottom right to top left":this.$el.css({top:0,left:0,display:"block"}).animate({top:"-100%",left:"-100%"},1e3,"easeOutCirc",_.bind(t,this));break;case"none":this.$el.css({display:"none"})&&t.call(this);break;default:this.$el.hide(e.toLowerCase(),1e3,_.bind(t,this))}},autoscroll:function(e,t){t=t||!1;var n=this,r=this._getSettings();if(this.abHasGlaze==0)return;if(t||!this.autoscrollStarted&&!r.roll_on&&(r.autoscroll||r.exit_intent)){var i=this.canvas.item(0),s=null;r.autoscroll_element_enable&&(r.autoscroll_element||r.autoscroll_element_selector)&&(s=r.autoscroll_element_selector?$(document).find(r.autoscroll_element_selector):$(document.evaluate(r.autoscroll_element,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue));if(i||s){if(!s){var o=i.getBoundingRect();e=_.isUndefined(e)?o.top:e}else e=_.isUndefined(e)?s.offset().top:e;if(this.model.get("variant").getSelector(0)&&!s){var u=$(this.model.get("variant").getSelector(0));if(!u.length||!u.is(":visible")){Logger.log("Glaze: binded element not created or not visible, autoscroll impossible");return}}var a=Number(r.autoscroll_speed||Settings.glazeAutoScrollSpeed),f=r.autoscroll_offset||Settings.glazeAutoScrollOffset;r.exit_intent&&(f=r.exit_autoscroll_offset);var l=parseInt(e-parseInt($(window).height()*(f/100)));l=l>0?l:0,l>=0&&(Logger.log("Glaze: autoscroll to the void: ("+a+"ms)"),this.autoscrollStarted=!0,$("html,body").animate({scrollTop:l},a,_.bind(function(){this.autoscrollStarted=!1,this.updateGlazePosition()},this)))}}},beforeShow:function(){var e=this.model.get("variant");if(e.get("blur")!=0||e.get("grayscale")!=0){var t=[];e.get("grayscale")&&t.push("grayscale("+e.get("grayscale")+"%)"),e.get("blur")&&t.push("blur("+e.get("blur")+"px)");var n=this.model.get("variant").getSelector(0);if(n){var r=$(n);r.addClass("glaze-exclude").addClass("glaze-bind-element"),r.children().addClass("glaze-exclude"),r.parents().addClass("glaze-exclude");var i='<style type="text/css">body.glaze-effect :not(.glaze-exclude){-webkit-filter: '+t.join(" ")+";"+"-moz-filter: "+t.join(" ")+";"+"filter: "+t.join(" ")+";}"+"</style>";$("head").append(i),$("body").addClass("glaze-effect")}}this.applyPreAccessibility()},afterShow:function(){var e=this._getSettings();if(!this.canvasReady){setTimeout(_.bind(this.afterShow,this),300);return}this.parent.updateDimensions(),e.deactivate_links?this.$el.css("pointerEvents","all"):this.$el.css("pointerEvents","none"),this.isShown=!0,this.applyPostAccessibility(),this.delegateResizeListener(),this.trackImpression(),this.initGlazeElements(),this.actionOnGlazeOpen()},applyPreAccessibility:function(){var e="title-trick-"+Date.now();this.$el.find('[id="'+this.attributes["aria-labelledby"]+'"]').attr("id",e),this.$("#glazeLabel").length?this.$el.attr("aria-labelledby","glazeLabel"):(this.attributes["aria-labelledby"]=e,this.$el.attr("aria-labelledby",e))},applyPostAccessibility:function(){var e=this._getSettings();this.$el.focus(),this.model.get("variant").get("shape_id")!==-1&&(this.$(".glaze-shape-button")[0].onclick=_.bind(this.clickVoid,this)),this.$(".glaze-shape-button span").html(e.a11y_shape_btn_text||"Enregistrer l'offre d'emploi dans MEMO (Ouvre une fenêtre popup)")},initGlazeElements:function(){_.each(this.elements,function(e){e.start()})},delegateResizeListener:function(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,this.updateFrame=window.requestAnimationFrame(_.bind(this.checkDimensionChanges,this))},checkDimensionChanges:function(){var e=[];_.each(this.model.get("variant").get("selector"),_.bind(function(t,n){t=this.model.get("variant").getSelector(n);var r=this.calculateSpotlightArea($(t));_.each(r,function(e,t){r[t]=Math.round(e)}),e.push(r)},this)),this.savedDimensions!==JSON.stringify(e)&&(this.savedDimensions=JSON.stringify(e),this.updateGlazePosition()),this.isShown&&(this.updateFrame=window.requestAnimationFrame(_.bind(this.checkDimensionChanges,this)))},undelegateResizeListener:function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;e(this.updateFrame)},hideGlaze:function(cb,converted,options){converted=converted||!1,options=options||{};var settings=this._getSettings();if(!this.isShown)return;if(settings.close_action_type&&(!settings.close_action_condition||settings.close_action_condition==="not_convert"&&!converted||settings.close_action_condition==="convert"&&converted)){if(settings.close_action_type==="glaze"&&!options.forceClose&&settings.close_action_glaze_transition&&settings.close_action_glaze_transition==="smooth"){this.removeAdditionalCss(),this.smoothTransitionGlaze(settings.close_action_glaze),this.trackAbandon();return}if(settings.close_action_type==="conditional"&&!options.forceClose){this.removeAdditionalCss();var isSuccess=eval(settings.close_action_condition_js);this.trackAbandon();if(isSuccess)return}}Logger.log("Glaze: hide"),TrackingManager.setWaitingVTC(this.model),this.animateOut(settings.animate_out,function(){this.undelegateResizeListener(),this.isShown=!1,$("html,body").stop(),$("body").removeClass("glaze-effect"),this.removeAdditionalCss(),this.executePostJS(),this.parent.onCloseGlaze(this.model,converted),this.trackAbandon(),_.isFunction(cb)&&cb()})},smoothTransitionGlaze:function(id){Logger.log("Glaze: smooth hide"),_.each(this.elements,function(e){e.remove(),e=null}),this.removeAdditionalCss(),this.elements=[];var settings=this._getSettings();settings.close_action_js&&(Logger.log("Glaze: execute close javascript action"),eval(settings.close_action_js));var singleTagAction=settings.universal_action_js;if(singleTagAction){singleTagAction=MiscUtils.prepareActionCode(singleTagAction,"GLAZE_CLOSE",this.model.get("id"),this.model.get("title"),this.model.get("campaign_id"),this.model.get("campaign_title"),this.abHasGlaze),Logger.log("Glaze: execute single tag action on glaze close "+singleTagAction);try{eval(singleTagAction)}catch(err){console.warn("Error in Single Tag Action on Glaze Close"),console.warn(err)}}var glaze=_.find(this.parent.appData.get("glazes"),function(e){return e.id==parseInt(id,10)});this.undelegateResizeListener(),this.isImpressionTracked=!1,this.model.set(glaze),this.selectVariant();var xpath=this.model.get("variant").getXpath(0),selector=this.model.get("variant").getSelector(0);if(!xpath&&!selector)throw new Error("Glaze: Binded element is not selected!");if(!this.canvas)throw new Error("Glaze: Canvas is not initialized!");if(!this.canvas.item||!this.canvas.item.length)throw new Error("Glaze: No shape found!");var element=selector?$(selector)[0]:document.evaluate(xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,shape=this.canvas.item(0),shapeOffset=this.model.get("variant").get("shapeOffset"),scaleOffset=this.model.get("variant").get("scaleOffset"),size=element.getBoundingClientRect(),position=$(element).offset(),top=position.top+(shapeOffset.top?shapeOffset.top:0),fixedPosition=!1;$(element).parents().each(function(){$(this).css("position")=="fixed"&&(fixedPosition=!0)}),size.height=size.bottom-size.top,fixedPosition||this.autoscroll(top,!0),this.transitionRunning=!0,this.transitionScrollTop=top,this.hideXIcon(),this.beforeShow(),this.applyAdditionalCss(),shape.animate({left:position.left+(shapeOffset.left?shapeOffset.left:0),top:top,scaleX:size.width/shape.get("width")+(scaleOffset.scaleX?scaleOffset.scaleX:0),scaleY:size.height/shape.get("height")+(scaleOffset.scaleY?scaleOffset.scaleY:0)},{duration:1e3,easing:MiscUtils.easeInOutQuad,onChange:this.canvas.renderAll.bind(this.canvas),onComplete:_.bind(function(){this.transitionRunning=!1,this.renderElements(),this.afterShow(),this.updateXIconPosition(),this.showXIcon(),this.updateGlazePosition()},this)})},clickShape:function(e,t){t=t||{};if(this.transitionRunning){e.preventDefault(),this.autoscroll(this.transitionScrollTop,!0);return}if((!e.pageX||!e.pageY)&&!t.clickInVoid)return;var n=this.canvas&&this.canvas.item(0),r=this._getSettings(),i=$(e.target).hasClass("glaze-element")||$(e.target).parents(".glaze-element").length,s;if(!this.isShown)return;if(!r.roll_on){var o=n&&n.getBoundingRect()||{},u=!1;if(!t.clickInVoid)if(!n||!(e.pageX>o.left&&e.pageX<o.left+o.width)||!(e.pageY>o.top&&e.pageY<o.top+o.height)){!i&&this.isShapeVisible()&&(u=TrackingManager.checkEngagementConversion(this.model.get("id"),"glaze_layer")),(r.close_click_overlay||!r.close_click_void&&!r.close_click_x&&!r.close_timer&&!r.close_click_element)&&!i&&(Logger.log("Glaze: click overlay close"),this.hideGlaze(null,u)),r.deactivate_links&&e&&e.preventDefault(),r.close_click_element&&(r.click_element||r.click_element_selector)&&(s=r.click_element_selector?$(r.click_element_selector)[0]:document.evaluate(r.click_element,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,s==e.target&&(Logger.log("Glaze: click close element"),this.hideGlaze(null,u)));return}if(r.close_click_element&&(r.click_element||r.click_element_selector)){s=r.click_element_selector?$(r.click_element_selector)[0]:document.evaluate(r.click_element,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(s==e.target){Logger.log("Glaze: click close element"),this.hideGlaze(null,u);return}}u=TrackingManager.checkEngagementConversion(this.model.get("id"),"void"),r.close_click_void&&(r.close_click_void_url&&r.close_click_void_url.trim()!==""?(Logger.log("Glaze: click void redirect"),window.location.href=r.close_click_void_url):(Logger.log("Glaze: click void close"),this.hideGlaze(null,u)))}},clickCloseIcon:function(e){e&&e.preventDefault(),this.hideGlaze()},exitIntent:function(e){var t=this._getSettings();t.exit_intent&&!t.roll_on&&(this.isShown||this.showGlaze())},contentIntent:function(e){var t=this._getSettings();if(t.content_intent&&!this.contentIntentDone&&!t.roll_on){var n=t.content_intent_bounds,r=t.content_intent_selector,i=r?$(r)[0]:document.evaluate(n,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,s=e.clientX,o=e.clientY,u=$(i).offset(),a={width:$(i).outerWidth(),height:$(i).outerHeight()};if(u&&s>=u.left&&s<=u.left+a.width&&o>=u.top-$(window).scrollTop()&&o<=u.top-$(window).scrollTop()+a.height){Logger.log("Glaze: show content intent"),this.showGlaze(),this.contentIntentDone=!0;if(!!md.phone()||!!md.tablet()){var f=t.timer_mobile_intent_out||Settings.glazeMobileIntentTimeout,l=t.url_mobile_intent;l&&setTimeout(function(){window.location.href=l},f)}}}},rollOn:function(e){var t=this,n=this._getSettings();if(n.roll_on&&(n.roll_element||n.roll_selector)){var r=e.clientX,i=e.clientY,s=null,o;n.roll_element?o=$(document.evaluate(n.roll_element,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):n.roll_selector&&(o=$(n.roll_selector)),o.each(function(){var e=$(this).offset(),t={width:$(this).width(),height:$(this).height()};!s&&r>e.left&&r<e.left+t.width&&i>e.top-$(window).scrollTop()&&i<e.top-$(window).scrollTop()+t.height&&(s=$(this))}),s?(n.roll_encompass&&(this.rolledElement=s[0],this.updateGlazePosition()),this.isShown?this.$el.is(":visible")||(Logger.log("Glaze: show roll on"),this.$el.show(),_.each(this.elements,function(e){e.onGlazeShow()})):(Logger.log("Glaze: show roll on"),this.showGlaze())):this.isShown&&this.$el.is(":visible")&&(Logger.log("Glaze: show roll off"),this.$el.hide(),_.each(this.elements,function(e){e.onGlazeHide()}))}},trackClick:function(e){e=e||"VOID";if(!this.appData.isTrackingAllowed()||this.isClickTracked)return;this.isClickTracked=!0},areElementsVisible:function(){return _.some(this.elements,function(e){return e.isVisible()})},isShapeVisible:function(e){e=e||{};if(!this.canvas)return!1;var t=this.canvas.item(0),n=this._getSettings();if(n.trigger_out_viewport)return Logger.log("Glaze: allowed to trigger if shape is out of viewport"),!0;var r=this.model.get("variant").getSelector(0);if(r){var i=$(r),s=i[0],o=i.offset(),u=i.width(),a=i.height(),f=[],l=!1;$(s).parents(':not("html,body")').each(function(){$(this).css("position")==="fixed"&&(l=!0);var e=!!~["hidden","auto"].indexOf($(this).css("overflow"));if(e){var t=!!~["absolute","fixed"].indexOf($(this).css("position")),n=$(this).offset(),r=$(this).width(),i=$(this).height(),s=t?i:i+n.top,c=t?r:r+n.left;if(o.top<0||o.left<0||o.top>s||o.left>c||o.top+a>s||o.left+u>c){var h=o.top+a-s,p=o.left+u-c;f.push($(this))}}});if(n.check_parents_overflow&&f.length)return!1;if(l){var c=s.getBoundingClientRect(),h=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(c.bottom<0||c.top-h>=0)&&!(c.left<0)&&c.width!==0&&c.height!==0}}if(!s)return!0;var p=s.getBoundingClientRect(),d=$(window).scrollTop(),v=$(window).scrollLeft(),m=$(window).height(),g=$(window).width();return(n.trigger_out_partial||e.forcePartial)&&(d<=parseInt(p.top)&&d+m>parseInt(p.top)||d<=parseInt(p.height)+parseInt(p.top)&&d+m>parseInt(p.height)+parseInt(p.top))?!0:d+m>parseInt(p.height)+parseInt(p.top)&&parseInt(p.top)>=0&&v+g>parseInt(p.width)+parseInt(p.left)&&parseInt(p.left)>=0&&$(s).visible()?!0:!1},isElementCreated:function(){var e=this.model.get("variant").getXpath(0),t=this.model.get("variant").getSelector(0);if(!e&&!t)return!0;var n=this.rolledElement||(t?$(t).get(0):document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),r=$(n);return!!r.length},checkBindedElement:function(){this.isElementCreated()&&this.isReadyToShow&&(this.isShown||this.showGlaze())},checkVisibility:function(){var e=this._getSettings();this.trackImpression(),this.isShapeVisible()&&this.isReadyToShow&&(this.isShown?this.$el.hasClass("invisible")&&e.trigger_on_scroll&&(!e.trigger_on_scroll_times||Number(e.trigger_on_scroll_times)>this.triggeredOnScroll)&&(this.triggeredOnScroll++,this.$el.removeClass("invisible"),_.each(this.elements,function(e){e.onGlazeShow()})):this.showGlaze()),!this.areElementsVisible()&&!this.isShapeVisible({forcePartial:!0})&&this.isShown&&!this.autoscrollStarted&&!this.$el.hasClass("invisible")&&(!e.trigger_on_scroll||e.trigger_on_scroll_times&&Number(e.trigger_on_scroll_times)===this.triggeredOnScroll?this.hideGlaze():(this.$el.addClass("invisible"),this.trackAbandon(),_.each(this.elements,function(e){e.onGlazeHide()}),this.isReadyToShow=!0))},trackImpression:function(){if(!this.appData.isTrackingAllowed()||this.isImpressionTracked||!this.isShown)return;if(this.isShapeVisible()){this.isImpressionTracked=!0;var e=Number(TrackingManager.getViewedGlazesNumber(this.model.get("campaign_id"))||0),t=this.abHasGlaze==1?"yes":"no";e++,TrackingManager.setViewedGlazesNumber(this.model.get("campaign_id"),e),$.ajax({type:"post",url:Settings.apiHost+Settings.api.trackingShow,data:{glaze_id:this.model.get("id"),glaze_variant_id:this.model.get("variant").get("id"),_glz_sid:this.appData.get("_glz_sid"),_glz_psid:this.appData.get("_glz_psid"),glz_shown:t,page_url_hash:this.appData.get("page_url_hash"),is_first:TrackingManager.isImpressed(this.model.get("id"))?0:1},success:_.bind(function(e){e&&e.status=="ok"&&(Logger.log("Glaze tracking: show"),TrackingManager.setWaitingConversion(this.model,t,this),TrackingManager.setImpression(this.model.get("id"),this.model.get("campaign_id")))},this)})}},trackAbandon:function(){if(!this.appData.isTrackingAllowed()||this.isAbandonTracked)return;Events.dispatch("glazeClosed",{glaze_id:this.model.get("id"),campaign_id:this.model.get("campaign_id"),campaign_title:this.model.get("campaign_title"),glaze_title:this.model.get("title")}),TrackingManager.setClosedCampaign(this.model.get("campaign_id")),$.ajax({type:"post",url:Settings.apiHost+Settings.api.trackingAbandon,data:{glaze_id:this.model.get("id"),_glz_psid:this.appData.get("_glz_psid")},success:_.bind(function(e){e&&e.status==="ok"&&(this.isAbandonTracked=!0,Logger.log("Glaze tracking: abandon"))},this)})},_getSettings:function(){var e=_.extend(_.clone(Settings.defaultGlazeSettings),JSON.parse(this.model.get("campaign_settings"))),t=_.clone(this.appData.extendSettings(e,this.model.get("variant").get("settings")));return t.z_index=t.z_index||this.appData.get("website").z_index,t.campaign_css_rules=e.css_rules,t},_setDeferredConditions:function(e){e=e||[],_.each(e,_.bind(function(e,t){e.code?this._setDeferredConditions(e.code):t&&!e.type?this._setDeferredConditions(e):e.type&&e.deferred&&this._setDeferredCondition(e)},this))},_setDeferredCondition:function(e){this.deferredConditions.push(e),ConditionChecker.checkDeferredCondition(e,this)},_releaseDeferredCondition:function(e){Logger.log("Glaze: deferred condition completed - "+e.type),this.deferredConditions=_.without(this.deferredConditions,e),this.showGlaze()},remove:function(){this.parent.glazeViews.splice(this.parent.glazeViews.indexOf(this),1),Backbone.View.prototype.remove.apply(this,arguments)}})}),define("text!view/MainView.html",[],function(){return'<% if(data.appData.get(\'is_free\')) { %>\r\n    <a href="<%= data.Settings.apiHost %>" class="branding" target="_blank"></a>\r\n<% } %>\r\n<button class="glaze-restart" data-content="Show again" aria-hidden="true"></button>\r\n<% if(data.appData.get(\'preview\')) { %>\r\n    <div class="glaze-stop-preview">Stop Glaze Preview</div>\r\n<% } %>'}),!function(e,t){if("function"!=typeof e.createEvent)return!1;var n,r,i,s,o,u,a,f,l="undefined"!=typeof jQuery,c=function(e){var t=e.toLowerCase(),n="MS"+e;return navigator.msPointerEnabled?n:t},h=!1,p={touchstart:c("PointerDown")+" touchstart",touchend:c("PointerUp")+" touchend",touchmove:c("PointerMove")+" touchmove"},d=function(e,t,n){for(var r=t.split(" "),i=r.length;i--;)e.addEventListener(r[i],n,!1)},v=function(e){return e.targetTouches?e.targetTouches[0]:e},m=function(){return(new Date).getTime()},g=function(t,i,s,o){var u=e.createEvent("Event");if(u.originalEvent=s,o=o||{},o.x=n,o.y=r,o.distance=o.distance,l&&(u=jQuery.Event(i,{originalEvent:s}),jQuery(t).trigger(u,o)),u.initEvent){for(var a in o)u[a]=o[a];u.initEvent(i,!0,!0),t.dispatchEvent(u)}for(;t;)t["on"+i]&&t["on"+i](u),t=t.parentNode},y=function(e){if("mousedown"!==e.type&&(h=!0),"mousedown"!==e.type||!h){var t=v(e);i=n=t.pageX,s=r=t.pageY,f=setTimeout(function(){g(e.target,"longtap",e),u=e.target},T),o=m(),k++}},b=function(e){if("mouseup"===e.type&&h)return void (h=!1);var t=[],l=m(),c=s-r,p=i-n;if(clearTimeout(a),clearTimeout(f),-E>=p&&t.push("swiperight"),p>=E&&t.push("swipeleft"),-E>=c&&t.push("swipedown"),c>=E&&t.push("swipeup"),t.length){for(var d=0;d<t.length;d++){var v=t[d];g(e.target,v,e,{distance:{x:Math.abs(p),y:Math.abs(c)}})}k=0}else i>=n-N&&n+N>=i&&s>=r-N&&r+N>=s&&o+S-l>=0&&(g(e.target,k>=2&&u===e.target?"dbltap":"tap",e),u=e.target),a=setTimeout(function(){k=0},x)},w=function(e){if("mousemove"!==e.type||!h){var t=v(e);n=t.pageX,r=t.pageY}},E=t.SWIPE_THRESHOLD||100,S=t.TAP_THRESHOLD||150,x=t.DBL_TAP_THRESHOLD||200,T=t.LONG_TAP_THRESHOLD||1e3,N=t.TAP_PRECISION/2||30,C=t.JUST_ON_TOUCH_DEVICES,k=0;d(e,p.touchstart+(C?"":" mousedown"),y),d(e,p.touchend+(C?"":" mouseup"),b),d(e,p.touchmove+(C?"":" mousemove"),w)}(document,window),define("tocca",function(){}),define("view/MainView",["require","jquery","underscore","utils/Logger","utils/Events","backbone","view/GlazeView","utils/ConditionChecker","utils/TrackingManager","text!view/MainView.html","Settings","mobiledetect","webfontloader","tocca","utils/MiscUtils","cookie","uri","utils/FontLoader","AppModel"],function(require){var $=require("jquery"),_=require("underscore"),Logger=require("utils/Logger"),Events=require("utils/Events"),Backbone=require("backbone"),GlazeView=require("view/GlazeView"),ConditionChecker=require("utils/ConditionChecker"),TrackingManager=require("utils/TrackingManager"),template=require("text!view/MainView.html"),Settings=require("Settings"),mobiledetect=require("mobiledetect"),WebFont=require("webfontloader"),tocca=require("tocca"),MiscUtils=require("utils/MiscUtils"),md=new mobiledetect(window.navigator.userAgent),Cookie=require("cookie"),URI=require("uri"),FontLoader=require("utils/FontLoader");return Backbone.View.extend({appData:null,className:"glaze-view glaze-exclude",glazeViews:[],docHeight:null,docWidth:null,lastGlaze:null,observer:null,campaignSplitTraffic:{},availableGlazes:[],randomSeedTraffic:null,randomSeedAB:null,abHasGlaze:null,restartingGlaze:null,checkVisibilityTimeout:null,attributes:{},events:{"click .glaze-restart":"openLastGlaze","keydown .glaze-restart":"keydownRestart","click .glaze-stop-preview":"stopPreview",keydown:"handleTab"},initialize:function(){this.appData=require("AppModel"),this.Settings=Settings,this.randomSeedTraffic=Math.random(),this.randomSeedAB=Math.random(),Logger.log("Glaze: random seed for split traffic = "+this.randomSeedTraffic),Logger.log("Glaze: random seed for A/B testing = "+this.randomSeedAB),Backbone.View.prototype.initialize.apply(this,arguments),$("body").on("mouseout",_.bind(this.mouseOut,this)),$("body").on("mousemove",_.bind(this.mouseOver,this)),$("body").on("keyup",_.bind(this.keyUp,this)),$("*").on("scroll",_.bind(this.scrollOrResize,this)),$(window).on("scroll",_.bind(this.scrollOrResize,this)),$(window).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",_.bind(this.onTransition,this)),$(document).on("mouseleave",_.bind(this.exitIntent,this));if(!md.tablet()&&!md.phone())window.addEventListener("click",_.bind(this.clickShape,this),!0);else{window.addEventListener("click",_.bind(this.clickShape,this),!0);var e=window.navigator.userAgent,t=e.match(/iP(ad|hone)/i),n=e.match(/WebKit/i);t&&n&&!e.match(/CriOS/i)&&(document.body.style.cursor="pointer")}this.setClearCommand()},render:function(){return this.$el.html(_.template(template)({data:this})),this.afterRender(),this},afterRender:function(){if(this.appData.get("website")&&this.appData.get("website").excluded){Logger.log("Glaze: you are excluded from this website Glaze visitors. Clear cookies to get back.");return}var e=this.selectGlaze();e&&e.length?(this.$el.css({display:"block"}),this.renderGlaze(e)):this.$el.css({display:"none"})},renderGlaze:function(e,t,n){t=t||!1,n=n||!1,this.glazeViews.length&&!n&&_.each(this.glazeViews,function(e){e&&e.remove()});var r=_.all(e,_.bind(function(e){var t=this.preSelectGlazeVariant(e),n=t&&JSON.parse(t.settings);return n&&n.roll_on},this));_.each(e,_.bind(function(e,n){if(r||n==0){this.abHasGlaze===null&&(this.abHasGlaze=TrackingManager.getAB(e.campaign_id)||-1,this.abHasGlaze!=-1&&Logger.log("Glaze: A/B testing, saved A/B version - "+(this.abHasGlaze==1?"with glaze":"without glaze")));if(e.forceRestart&&!t){Logger.log("Glaze: restart from",e);var i=new Backbone.Model(e),s=this.preSelectGlazeVariant(e),o=JSON.parse(s.json);o.settings=s.settings?JSON.parse(s.settings):{};var u=new Backbone.Model(o);i.set("variant",u),this.onCloseGlaze(i)}else{Logger.log("Glaze: rendering",e),Events.dispatch("glazeSelected",{glaze_id:e.id,campaign_id:e.campaign_id,campaign_title:e.campaign_title,glaze_title:e.title});var a=new GlazeView({model:new Backbone.Model(e),parent:this});a.render().$el.appendTo(this.$el),a.applySettings(t),this.glazeViews.push(a)}}},this)),window.glaze.API("setActiveGlazes",this.glazeViews)},renderAllAvailableGlazes:function(e){if(this.renderedAllAvailableGlazes)return;this.renderedAllAvailableGlazes=!0,_.each(this.availableGlazes,_.bind(function(t){e!=t.id&&this.renderGlaze([t],!1,!0)},this))},updateDimensions:function(){if(this.$el.css("position")=="absolute"){if($(document).height()!=this.docHeight||this.$(".glaze-layer").height()!=this.docHeight)this.docHeight=$(document).height(),this.$(".glaze-layer").css("height",0),this.$(".glaze-layer").css("height",this.docHeight);this.$(".glaze-layer").width()!=this.docWidth&&(this.docWidth=this.$(".glaze-layer").width()),_.each(this.glazeViews,_.bind(function(e){e&&(e.updateGlazeDimensions(this.$(".glaze-layer").width(),this.$(".glaze-layer").height()),e.updateGlazePosition())},this))}},selectGlaze:function(){if(!this.appData.get("glazes")||!this.appData.get("glazes").length)return!1;_.each(this.appData.get("glazes"),_.bind(function(e){this.appData.get("previewGlaze")&&e.hash===this.appData.get("previewGlaze")&&(e.preview=!0,MiscUtils.localStorage().setItem("preview_campaign",e.campaign_id))},this));var e=this.appData.getSortedGlazes(TrackingManager.getLastSeenCampaignId());return e=_.filter(e,_.bind(function(e){var t=this.preSelectGlazeVariant(e),n=JSON.parse(e.campaign_settings||"{}"),r=t&&JSON.parse(t.settings);e.forceRestart=!1,r=this.appData.extendSettings(n,r),r.restart_appearance=="every"&&TrackingManager.isCampaignClosed(e.campaign_id)&&(Logger.log("Glaze: glaze "+e.title+" force restart enabled"),e.forceRestart=!0);if(e.preview)return Logger.log("Glaze: glaze "+e.title+" preview"),this.availableGlazes.push(e),!0;if(e.previewByCampaign)return Logger.log("Glaze: glaze "+e.title+" preview by campaign"),this.availableGlazes.push(e),!0;if(t&&t.out_of_capping)return Logger.log("Glaze: glaze "+e.title+" reached frequency capping limit, skipping"),!1;if(!this.passAdditionalSettings(r.advanced_settings)||!this.passAdditionalSettings(n.advanced_settings)||!this.passAdditionalSettings(this.appData.get("website").audiences)||!this.passCampaignSettings(e))return Logger.log("Glaze: glaze "+e.title+" did not pass conditions, skipping"),!1;this.availableGlazes.push(e);if(TrackingManager.isConverted(e.id,e.conversion_round)&&this.abHasGlaze!=0){Logger.log("Glaze: glaze "+e.title+" is already converted, skipping");if(!e.forceRestart)return!1}if(TrackingManager.getLastSeenCampaignId()!=e.campaign_id){if(!this.checkSplitTraffic(e,n,this.randomSeedTraffic))return Logger.log("Glaze: glaze "+e.title+" skipped due to campaign split traffic"),!1}else Logger.log("Glaze: glaze "+e.title+" applied because of continuous campaign view");return!0},this)),e},checkSplitTraffic:function(e,t,n){if(!t.split_traffic)return!0;var r=[0,parseInt(t.split_traffic)/100];return this.campaignSplitTraffic[e.campaign_id]?r=this.campaignSplitTraffic[e.campaign_id]:(_.each(this.campaignSplitTraffic,function(e,t){r[0]+=e[1]-e[0],r[1]+=e[1]-e[0]}),this.campaignSplitTraffic[e.campaign_id]=r),n>=r[0]&&n<r[1]},preSelectGlazeVariant:function(e){var t=_.sortBy(e.variants,function(e){return!e.screen_size.max||e.screen_size.max==0?1e6:Number(e.screen_size.max)}),n=_.sortBy(e.variants,function(e){return e.screen_size.min}),r=_.find(e.variants,function(e){return e.screen_size.is_default==1||!e.screen_size.max||e.screen_size.max==0}),i=$(window).width(),s;return s=_.find(t,function(e){var t=e.screen_size.max&&e.screen_size.max!=0?e.screen_size.max:1e6;return Number(t)>=i}),s||(e.campaign_is_mobile_first==1&&n&&n.length?s=n[0]:s=r),s},openGlazeById:function(e,t){t=t||!1;var n=_.find(this.appData.get("glazes"),function(t){return t.id==parseInt(e,10)});if(!t){var r=this.preSelectGlazeVariant(n),i=JSON.parse(n.campaign_settings),s=r&&JSON.parse(r.settings);s=this.appData.extendSettings(i,s);if(!this.passAdditionalSettings(s.advanced_settings)||!this.passCampaignSettings(n))return Logger.log("Glaze: glaze "+n.title+" did not pass conditions, skipping"),!1}this.renderGlaze([n],t),this.docHeight=null,this.updateDimensions()},passCampaignSettings:function(e){var t=JSON.parse(e.campaign_settings)||{};if(t.max_glazes){var n=parseInt(t.max_glazes),r=Number(TrackingManager.getViewedGlazesNumber(this.model.get("campaign_id"))||0);if(r>=n)return!1}return t.freq_capping_cmp&&t.freq_capping_cmp_times&&TrackingManager.getImpressionsNumber(e.id)>=parseInt(t.freq_capping_cmp_times)?(Logger.log("Glaze: glaze "+e.title+" did not pass campaign level frequency capping, skipping"),!1):!0},passAdditionalSettings:function(e){if(!e)return!0;var t=_.all(e,_.bind(this.passConditionGroup,this));return t},passConditionGroup:function(e){var t=_.all(e.code,_.bind(this.passConditionSubGroup,this));return e.action&&e.action==1?t:!t},passConditionSubGroup:function(e,t){if(!t)return!0;var n=_.some(e,_.bind(this.passCondition,this));return n},passCondition:function(e,t){return t?ConditionChecker.checkCondition(e):!1},exitIntent:function(e){if(!this.glazeViews.length)return;_.each(this.glazeViews,function(t){t&&t.exitIntent(e)})},mouseOut:function(e){if(!this.glazeViews.length)return;_.each(this.glazeViews,function(t){t&&t.rollOn(e)})},mouseOver:function(e){if(!this.glazeViews.length)return;_.each(this.glazeViews,function(t){t&&(t.contentIntent(e),t.rollOn(e))})},clickShape:function(e){TrackingManager.checkClickElement(e);var t=[];_.each(this.glazeViews,function(n){n&&(n.clickShape(e),t.push(n.model.get("id")))}),TrackingManager.checkVoidVTC(t,e)},onTransition:function(e){_.each(this.glazeViews,function(e){e&&(e.updateGlazePosition(),e.checkVisibility())})},scrollOrResize:function(e){this.checkVisibilityTimeout&&(clearTimeout(this.checkVisibilityTimeout),this.checkVisibilityTimeout=null),this.checkVisibilityTimeout=setTimeout(_.bind(function(){_.each(this.glazeViews,function(e){e&&e.checkVisibility()})},this),50)},keyUp:function(e){e.keyCode===27&&_.each(this.glazeViews,function(e){e&&e.hideGlaze()});if(e.keyCode===9&&this.glazeViews.length&&!$(e.target).parents(".glaze-view").length){var t=this.glazeViews[0].$("button, [href], input, select, textarea").filter(":visible");!e.shiftKey&&t.length?t.first().focus():e.shiftKey&&t.length&&t.last().focus()}},onCloseGlaze:function(model,converted){converted=converted||!1,this.lastGlaze=model;var settings=this.appData.extendSettings(JSON.parse(this.lastGlaze.get("campaign_settings")),this.lastGlaze.get("variant").get("settings")),$restart=this.$(".glaze-restart"),glazeView=_.find(this.glazeViews,_.bind(function(e){return e&&e.model.get("id")==this.lastGlaze.get("id")},this));if(glazeView){var abHasGlaze=glazeView.abHasGlaze;this.glazeViews.splice(this.glazeViews.indexOf(glazeView),1)}settings.restart_appearance&&settings.restart_appearance==="every"&&this.lastGlaze&&TrackingManager.setRestartCampaign(this.lastGlaze.get("campaign_id"));if(settings&&settings.restart){settings.restart_image&&$restart.css("backgroundImage","url("+settings.restart_image+")"),setTimeout(function(){$restart.html(settings.restart_text).show().attr("aria-hidden",!1).focus()},0),settings.restart_text_color&&$restart.css("color",settings.restart_text_color),settings.restart_tab_color&&$restart.css("background",settings.restart_tab_color);if(settings.restart_position&&settings.restart_position!=="default")switch(settings.restart_position){case"bl":$restart.css({top:"auto",bottom:0,left:0,right:"auto"});break;case"tl":$restart.css({top:0,bottom:"auto",left:0,right:"auto"});break;case"tr":$restart.css({top:0,bottom:"auto",left:"auto",right:0})}settings.restart_text_font&&(_.isObject(settings.restart_text_font)?$restart.css({fontFamily:settings.restart_text_font.family}):$restart.css("fontFamily",settings.restart_text_font),settings.restart_text_font.customId?FontLoader.loadCustomFont(settings.restart_text_font.customId):FontLoader.loadFonts([settings.restart_text_font.family])),settings.restart_text_size&&$restart.css("fontSize",settings.restart_text_size+"px")}if(glazeView){if(settings.close_action_type&&(!settings.close_action_condition||settings.close_action_condition==="not_convert"&&!converted||settings.close_action_condition==="convert"&&converted))if(settings.close_action_type==="url")if(settings.close_action_url_blank){var win=window.open(settings.close_action_url,"_blank");win.focus()}else window.location.href=settings.close_action_url;else if(settings.close_action_type==="glaze")this.openGlazeById(settings.close_action_glaze,!0);else if(settings.close_action_type==="campaign"){var glazes=_.filter(this.appData.get("glazes"),function(e){return e.campaign_id==settings.close_action_campaign});glazes=_.sortBy(glazes,_.bind(function(e){return parseInt(e.priority)},this)),glazes&&glazes.length&&this.openGlazeById(glazes[0].id,!1)}settings.close_action_js&&(Logger.log("Glaze: execute close javascript action"),eval(settings.close_action_js));var singleTagAction=settings.universal_action_js;if(singleTagAction){singleTagAction=MiscUtils.prepareActionCode(singleTagAction,"GLAZE_CLOSE",model.get("id"),model.get("title"),model.get("campaign_id"),model.get("campaign_title"),abHasGlaze),Logger.log("Glaze: execute single tag action on glaze close "+singleTagAction);try{eval(singleTagAction)}catch(err){console.warn("Error in Single Tag Action on Glaze Close"),console.warn(err)}}}},keydownRestart:function(e){if(e.keyCode===13||e.keyCode===32)e.preventDefault(),this.openLastGlaze()},openLastGlaze:function(){if(this.lastGlaze){var e=this.appData.extendSettings(JSON.parse(this.lastGlaze.get("campaign_settings")),this.lastGlaze.get("variant").get("settings"));if(e.restart_behavior==="start"){var t=_.filter(this.appData.get("glazes"),_.bind(function(e){return e.campaign_id==this.lastGlaze.get("campaign_id")},this));t=_.sortBy(t,_.bind(function(e){return parseInt(e.priority)},this)),t&&t.length&&(this.restartingGlaze=t[0].id,this.trackRestart(t[0].id),this.openGlazeById(t[0].id,!0))}else this.restartingGlaze=this.lastGlaze.get("id"),this.trackRestart(this.lastGlaze.get("id")),this.openGlazeById(this.lastGlaze.get("id"),!0);this.hideRestart()}},hideRestart:function(){var e=this.$(".glaze-restart");e.hide().attr("aria-hidden",!0)},trackRestart:function(e){if(!this.appData.isTrackingAllowed())return;$.ajax({type:"post",url:Settings.apiHost+Settings.api.trackingRestart,data:{glaze_id:e,_glz_psid:this.appData.get("_glz_psid")},success:function(e){e&&e.status=="ok"&&Logger.log("Glaze tracking: restart")}})},stopPreview:function(e){e&&e.preventDefault(),MiscUtils.localStorage().removeItem("preview_glaze"),MiscUtils.localStorage().removeItem("preview_campaign");var t=new URI(window.location.href);t.deleteQueryParam("preview_glaze"),t.deleteQueryParam("last_account"),t.deleteQueryParam("last_url"),window.location.replace(t.toString())},setClearCommand:function(){window.glazeResetUserPE=this.clearStorage},clearStorage:function(){if(confirm("Are you sure you want to clear cookies and storage variables?")){var e=document.cookie.split(";");_.each(e,function(e){MiscUtils.eraseCookieFromAllPaths(e)}),MiscUtils.localStorage().clear(),window._glazePT=!0}},handleTab:function(e){var t=e.keyCode,n=e.shiftKey,r=$(e.target),i=this.$("button, [href], input, select, textarea").filter(":visible"),s=this.$(".glaze-restart");this.glazeViews.length?t===9&&!n&&i.last().is(r)?(e.preventDefault(),i.first().focus()):t===9&&n&&(i.first().is(r)||r.is(this.$el)||r.parent().is(this.$el))&&(e.preventDefault(),i.last().focus()):s.is(r)}})}),define("App",["require","jquery","underscore","view/MainView","utils/TrackingManager","utils/Logger","utils/Events","utils/MiscUtils","Settings","uri"],function(e){var t=e("jquery"),n=e("underscore"),r=e("view/MainView"),i=e("utils/TrackingManager"),s=e("utils/Logger"),o=e("utils/Events"),u=e("utils/MiscUtils"),a=e("Settings"),f=e("uri");return{initialData:null,slug:null,hash:null,mainView:null,start:function(e){o.dispatch("glazeInitialized"),this.initialData=e.initialData,i.trackPage(),this.mainView=new r,this.mainView.render().$el.appendTo("body"),this.mainView.updateDimensions(),t(window).on("resize",n.bind(this.mainView.updateDimensions,this.mainView)),t(window).on("resize",n.bind(this.mainView.scrollOrResize,this.mainView));var s=new f(window.location.href);s.deleteQueryParam("preview_glaze"),s.deleteQueryParam("last_account"),s.deleteQueryParam("last_url"),this.slug=s.path()+s.query(),this.hash=window.location.hash,setInterval(n.bind(this.restart,this),300)},restart:function(e){var r=new f(window.location.href);r.deleteQueryParam("preview_glaze"),r.deleteQueryParam("last_account"),r.deleteQueryParam("last_url");var s={origin:r.protocol()+"://"+r.host(),slug:r.path()+r.query(),query:r.query(),accountId:a.accountId,hash:window.location.hash};if(s.slug===this.slug&&s.hash===this.hash)return;this.slug=s.slug,this.hash=s.hash,i.trackPage(),i.checkPageConversion();var o=u.getParameterByName("preview_glaze")||u.localStorage().getItem("preview_glaze");o&&(u.localStorage().setItem("preview_glaze",o),s.preview=1),s._glz_sid=u.localStorage().getItem("_glz_sid")||"",s._glz_ssid=u.sessionStorage().getItem("_glz_ssid")||"",t.ajax({type:"get",url:a.apiHost+a.api.clientData,data:s,success:n.bind(function(e){this.initialData.set(e.result),this.mainView.afterRender(),this.mainView.updateDimensions(),this.mainView.hideRestart()},this)})}}}),define("AppInstance",["require","App"],function(e){var t=e("App");return t}),define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),function(){function e(e){return function(){return this[e]}}function t(e){return function(){return e}}function r(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t}function i(e){return"string"==typeof e}function s(e,t,n){return e.call.apply(e.bind,arguments)}function o(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:o,u.apply(null,arguments)}function a(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function f(e){function n(){}var t=Et;n.prototype=t.prototype,e.G=t.prototype,e.prototype=new n,e.F=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function l(e,t,n){this.a=e,this.b=t||1,this.f=n||1}function h(e,t){return-1!=e.indexOf(t)}function p(e,t){return e<t?-1:e>t?1:0}function w(e,t){var n;e:{n=e.length;for(var r=i(e)?e.split(""):e,s=0;s<n;s++)if(s in r&&t.call(void 0,r[s],s,e)){n=s;break e}n=-1}return 0>n?null:i(e)?e.charAt(n):e[n]}function E(e){return d.concat.apply(d,arguments)}function S(e,t,n){return 2>=arguments.length?d.slice.call(e,t):d.slice.call(e,t,n)}function M(){var e=x;if(A)return/rv\:([^\);]+)(\)|;)/.exec(e);if(L)return/Edge\/([\d\.]+)/.exec(e);if(k)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(O)return/WebKit\/(\S+)/.exec(e)}function _(){var e=n.document;return e?e.documentMode:void 0}function H(e){if(!P[e]){for(var t=0,n=c(String(D)).split("."),r=c(String(e)).split("."),i=Math.max(n.length,r.length),s=0;0==t&&s<i;s++){var o=n[s]||"",u=r[s]||"",a=RegExp("(\\d*)(\\D*)","g"),f=RegExp("(\\d*)(\\D*)","g");do{var l=a.exec(o)||["","",""],h=f.exec(u)||["","",""];if(0==l[0].length&&0==h[0].length)break;t=p(0==l[1].length?0:parseInt(l[1],10),0==h[1].length?0:parseInt(h[1],10))||p(0==l[2].length,0==h[2].length)||p(l[2],h[2])}while(0==t)}P[e]=0<=t}}function q(e,t,n,r){this.a=e,this.nodeName=n,this.nodeValue=r,this.nodeType=2,this.parentNode=this.ownerElement=t}function R(e,t){var n=I&&"href"==t.nodeName?e.getAttribute(t.nodeName,2):t.nodeValue;return new q(t,e,t.nodeName,n)}function U(e){this.b=e,this.a=0}function z(e){e=e.match(W);for(var t=0;t<e.length;t++)X.test(e[t])&&e.splice(t,1);return new U(e)}function V(e,t){return e.b[e.a+(t||0)]}function $(e){return e.b[e.a++]}function J(e){return e.b.length<=e.a}function K(e,t){if(e.contains&&1==t.nodeType)return e==t||e.contains(t);if("undefined"!=typeof e.compareDocumentPosition)return e==t||Boolean(e.compareDocumentPosition(t)&16);for(;t&&e!=t;)t=t.parentNode;return t==e}function Q(e,t){if(e==t)return 0;if(e.compareDocumentPosition)return e.compareDocumentPosition(t)&2?1:-1;if(k&&!(9<=j)){if(9==e.nodeType)return-1;if(9==t.nodeType)return 1}if("sourceIndex"in e||e.parentNode&&"sourceIndex"in e.parentNode){var r=1==e.nodeType,i=1==t.nodeType;if(r&&i)return e.sourceIndex-t.sourceIndex;var s=e.parentNode,o=t.parentNode;return s==o?Y(e,t):!r&&K(s,t)?-1*G(e,t):!i&&K(o,e)?G(t,e):(r?e.sourceIndex:s.sourceIndex)-(i?t.sourceIndex:o.sourceIndex)}return i=9==e.nodeType?e:e.ownerDocument||e.document,r=i.createRange(),r.selectNode(e),r.collapse(!0),i=i.createRange(),i.selectNode(t),i.collapse(!0),r.compareBoundaryPoints(n.Range.START_TO_END,i)}function G(e,t){var n=e.parentNode;if(n==t)return-1;for(var r=t;r.parentNode!=n;)r=r.parentNode;return Y(r,e)}function Y(e,t){for(var n=t;n=n.previousSibling;)if(n==e)return-1;return 1}function Z(e){var t=null,n=e.nodeType;1==n&&(t=e.textContent,t=void 0==t||null==t?e.innerText:t,t=void 0==t||null==t?"":t);if("string"!=typeof t)if(F&&"title"==e.nodeName.toLowerCase()&&1==n)t=e.text;else if(9==n||1==n){e=9==n?e.documentElement:e.firstChild;for(var n=0,r=[],t="";e;){do 1!=e.nodeType&&(t+=e.nodeValue),F&&"title"==e.nodeName.toLowerCase()&&(t+=e.text),r[n++]=e;while(e=e.firstChild);for(;n&&!(e=r[--n].nextSibling););}}else t=e.nodeValue;return""+t}function et(e,t,n){if(null===t)return!0;try{if(!e.getAttribute)return!1}catch(r){return!1}return I&&"class"==t&&(t="className"),null==n?!!e.getAttribute(t):e.getAttribute(t,2)==n}function tt(e,t,n,r,s){return(F?nt:rt).call(null,e,t,i(n)?n:null,i(r)?r:null,s||new at)}function nt(e,t,n,r,i){if(e instanceof Ut||8==e.b||n&&null===e.b){var s=t.all;if(!s)return i;e=ut(e);if("*"!=e&&(s=t.getElementsByTagName(e),!s))return i;if(n){for(var o=[],u=0;t=s[u++];)et(t,n,r)&&o.push(t);s=o}for(u=0;t=s[u++];)"*"==e&&"!"==t.tagName||ht(i,t);return i}return ot(e,t,n,r,i),i}function rt(e,t,n,r,i){return t.getElementsByName&&r&&"name"==n&&!k?(t=t.getElementsByName(r),m(t,function(t){e.a(t)&&ht(i,t)})):t.getElementsByClassName&&r&&"class"==n?(t=t.getElementsByClassName(r),m(t,function(t){t.className==r&&e.a(t)&&ht(i,t)})):e instanceof It?ot(e,t,n,r,i):t.getElementsByTagName&&(t=t.getElementsByTagName(e.f()),m(t,function(e){et(e,n,r)&&ht(i,e)})),i}function it(e,t,n,r,i){var s;if((e instanceof Ut||8==e.b||n&&null===e.b)&&(s=t.childNodes)){var o=ut(e);return"*"!=o&&(s=g(s,function(e){return e.tagName&&e.tagName.toLowerCase()==o}),!s)?i:(n&&(s=g(s,function(e){return et(e,n,r)})),m(s,function(e){"*"==o&&("!"==e.tagName||"*"==o&&1!=e.nodeType)||ht(i,e)}),i)}return st(e,t,n,r,i)}function st(e,t,n,r,i){for(t=t.firstChild;t;t=t.nextSibling)et(t,n,r)&&e.a(t)&&ht(i,t);return i}function ot(e,t,n,r,i){for(t=t.firstChild;t;t=t.nextSibling)et(t,n,r)&&e.a(t)&&ht(i,t),ot(e,t,n,r,i)}function ut(e){if(e instanceof It){if(8==e.b)return"!";if(null===e.b)return"*"}return e.f()}function at(){this.b=this.a=null,this.l=0}function ft(e){this.node=e,this.a=this.b=null}function lt(e,t){if(!e.a)return t;if(!t.a)return e;for(var n=e.a,r=t.a,i=null,s=null,o=0;n&&r;){var s=n.node,u=r.node;s==u||s instanceof q&&u instanceof q&&s.a==u.a?(s=n,n=n.a,r=r.a):0<Q(n.node,r.node)?(s=r,r=r.a):(s=n,n=n.a),(s.b=i)?i.a=s:e.a=s,i=s,o++}for(s=n||r;s;)s.b=i,i=i.a=s,o++,s=s.a;return e.b=i,e.l=o,e}function ct(e,t){var n=new ft(t);n.a=e.a,e.b?e.a.b=n:e.a=e.b=n,e.a=n,e.l++}function ht(e,t){var n=new ft(t);n.b=e.b,e.a?e.b.a=n:e.a=e.b=n,e.b=n,e.l++}function pt(e){return(e=e.a)?e.node:null}function dt(e){return(e=pt(e))?Z(e):""}function vt(e,t){return new mt(e,!!t)}function mt(e,t){this.f=e,this.b=(this.c=t)?e.b:e.a,this.a=null}function gt(e){var t=e.b;if(null==t)return null;var n=e.a=t;return e.b=e.c?t.b:t.a,n.node}function yt(e){switch(e.nodeType){case 1:return a(wt,e);case 9:return yt(e.documentElement);case 11:case 10:case 6:case 12:return bt;default:return e.parentNode?yt(e.parentNode):bt}}function bt(){return null}function wt(e,t){if(e.prefix==t)return e.namespaceURI||"http://www.w3.org/1999/xhtml";var n=e.getAttributeNode("xmlns:"+t);return n&&n.specified?n.value||null:e.parentNode&&9!=e.parentNode.nodeType?wt(e.parentNode,t):null}function Et(e){this.i=e,this.b=this.g=!1,this.f=null}function St(e){return"\n  "+e.toString().split("\n").join("\n  ")}function xt(e,t){e.g=t}function Tt(e,t){e.b=t}function Nt(e,t){var n=e.a(t);return n instanceof at?+dt(n):+n}function Ct(e,t){var n=e.a(t);return n instanceof at?dt(n):""+n}function kt(e,t){var n=e.a(t);return n instanceof at?!!n.l:!!n}function Lt(e,t,n){Et.call(this,e.i),this.c=e,this.h=t,this.o=n,this.g=t.g||n.g,this.b=t.b||n.b,this.c==Dt&&(n.b||n.g||4==n.i||0==n.i||!t.f?t.b||t.g||4==t.i||0==t.i||!n.f||(this.f={name:n.f.name,s:t}):this.f={name:t.f.name,s:n})}function At(e,t,n,r,i){t=t.a(r),n=n.a(r);var s;if(t instanceof at&&n instanceof at){i=vt(t);for(r=gt(i);r;r=gt(i))for(t=vt(n),s=gt(t);s;s=gt(t))if(e(Z(r),Z(s)))return!0;return!1}if(t instanceof at||n instanceof at){t instanceof at?i=t:(i=n,n=t),i=vt(i),t=typeof n;for(r=gt(i);r;r=gt(i)){switch(t){case"number":r=+Z(r);break;case"boolean":r=!!Z(r);break;case"string":r=Z(r);break;default:throw Error("Illegal primitive type for comparison.")}if(e(r,n))return!0}return!1}return i?"boolean"==typeof t||"boolean"==typeof n?e(!!t,!!n):"number"==typeof t||"number"==typeof n?e(+t,+n):e(t,n):e(+t,+n)}function Ot(e,t,n,r){this.a=e,this.w=t,this.i=n,this.m=r}function _t(e,t,n,r){if(Mt.hasOwnProperty(e))throw Error("Binary operator already created: "+e);return e=new Ot(e,t,n,r),Mt[e.toString()]=e}function Pt(e,t){if(t.a.length&&4!=e.i)throw Error("Primary expression must evaluate to nodeset if filter has predicate(s).");Et.call(this,e.i),this.c=e,this.h=t,this.g=e.g,this.b=e.b}function Ht(e,t){if(t.length<e.A)throw Error("Function "+e.j+" expects at least"+e.A+" arguments, "+t.length+" given");if(null!==e.v&&t.length>e.v)throw Error("Function "+e.j+" expects at most "+e.v+" arguments, "+t.length+" given");e.B&&m(t,function(t,n){if(4!=t.i)throw Error("Argument "+n+" to function "+e.j+" is not of type Nodeset: "+t)}),Et.call(this,e.i),this.h=e,this.c=t,xt(this,e.g||b(t,function(e){return e.g})),Tt(this,e.D&&!t.length||e.C&&!!t.length||b(t,function(e){return e.b}))}function Bt(e,t,n,r,i,s,o,u,a){this.j=e,this.i=t,this.g=n,this.D=r,this.C=i,this.m=s,this.A=o,this.v=void 0!==u?u:o,this.B=!!a}function Ft(e,t,n,r,i,s,o,u){if(jt.hasOwnProperty(e))throw Error("Function already created: "+e+".");jt[e]=new Bt(e,t,n,r,!1,i,s,o,u)}function It(e,t){this.h=e,this.c=void 0!==t?t:null,this.b=null;switch(e){case"comment":this.b=8;break;case"text":this.b=3;break;case"processing-instruction":this.b=7;break;case"node":break;default:throw Error("Unexpected argument")}}function qt(e){return"comment"==e||"text"==e||"processing-instruction"==e||"node"==e}function Rt(e){Et.call(this,3),this.c=e.substring(1,e.length-1)}function Ut(e,t){this.j=e.toLowerCase(),this.c=t?t.toLowerCase():"http://www.w3.org/1999/xhtml"}function zt(e){Et.call(this,1),this.c=e}function Wt(e,t){Et.call(this,e.i),this.h=e,this.c=t,this.g=e.g,this.b=e.b;if(1==this.c.length){var n=this.c[0];n.u||n.c!=en||(n=n.o,"*"!=n.f()&&(this.f={name:n.f(),s:null}))}}function Xt(){Et.call(this,4)}function Vt(){Et.call(this,4)}function $t(e){return"/"==e||"//"==e}function Jt(e,t){this.a=e,this.b=!!t}function Kt(e,t,n){for(n=n||0;n<e.a.length;n++)for(var r=e.a[n],i=vt(t),s=t.l,o,u=0;o=gt(i);u++){var a=e.b?s-u:u+1;o=r.a(new l(o,a,s));if("number"==typeof o)a=a==o;else if("string"==typeof o||"boolean"==typeof o)a=!!o;else{if(!(o instanceof at))throw Error("Predicate.evaluate returned an unexpected type.");a=0<o.l}if(!a){a=i,o=a.f;var f=a.a;if(!f)throw Error("Next must be called at least once before remove.");var c=f.b,f=f.a;c?c.a=f:o.a=f,f?f.b=c:o.b=c,o.l--,a.a=null}}return t}function Qt(e,t,n,r){Et.call(this,4),this.c=e,this.o=t,this.h=n||new Jt([]),this.u=!!r,t=this.h,t=0<t.a.length?t.a[0].f:null,e.b&&t&&(e=t.name,e=F?e.toLowerCase():e,this.f={name:e,s:t.s});e:{e=this.h;for(t=0;t<e.a.length;t++)if(n=e.a[t],n.g||1==n.i||0==n.i){e=!0;break e}e=!1}this.g=e}function Gt(e,t,n,r){this.j=e,this.f=t,this.a=n,this.b=r}function Zt(e,t,n,r){if(Yt.hasOwnProperty(e))throw Error("Axis already created: "+e);return t=new Gt(e,t,n,!!r),Yt[e]=t}function an(e){Et.call(this,1),this.c=e,this.g=e.g,this.b=e.b}function fn(e){Et.call(this,4),this.c=e,xt(this,b(this.c,function(e){return e.g})),Tt(this,b(this.c,function(e){return e.b}))}function ln(e,t){this.a=e,this.b=t}function cn(e){for(var t,n=[];;){hn(e,"Missing right hand side of binary expression."),t=wn(e);var r=$(e.a);if(!r)break;var i=(r=Mt[r]||null)&&r.w;if(!i){e.a.a--;break}for(;n.length&&i<=n[n.length-1].w;)t=new Lt(n.pop(),n.pop(),t);n.push(t,r)}for(;n.length;)t=new Lt(n.pop(),n.pop(),t);return t}function hn(e,t){if(J(e.a))throw Error(t)}function pn(e,t){var n=$(e.a);if(n!=t)throw Error("Bad token, expected: "+t+" got: "+n)}function dn(e){e=$(e.a);if(")"!=e)throw Error("Bad token: "+e)}function vn(e){e=$(e.a);if(2>e.length)throw Error("Unclosed literal string");return new Rt(e)}function mn(e){var t=$(e.a),n=t.indexOf(":");if(-1==n)return new Ut(t);var r=t.substring(0,n);e=e.b(r);if(!e)throw Error("Namespace prefix not declared: "+r);return t=t.substr(n+1),new Ut(t,e)}function gn(e){var t,n=[],r;if($t(V(e.a))){t=$(e.a),r=V(e.a);if("/"==t&&(J(e.a)||"."!=r&&".."!=r&&"@"!=r&&"*"!=r&&!/(?![0-9])[\w]/.test(r)))return new Xt;r=new Xt,hn(e,"Missing next location step."),t=yn(e,t),n.push(t)}else{e:{t=V(e.a),r=t.charAt(0);switch(r){case"$":throw Error("Variable reference not allowed in HTML XPath");case"(":$(e.a),t=cn(e),hn(e,'unclosed "("'),pn(e,")");break;case'"':case"'":t=vn(e);break;default:if(isNaN(+t)){if(!!qt(t)||!/(?![0-9])[\w]/.test(r)||"("!=V(e.a,1)){t=null;break e}t=$(e.a),t=jt[t]||null,$(e.a);for(r=[];")"!=V(e.a);){hn(e,"Missing function argument list."),r.push(cn(e));if(","!=V(e.a))break;$(e.a)}hn(e,"Unclosed function argument list."),dn(e),t=new Ht(t,r)}else t=new zt(+$(e.a))}"["==V(e.a)&&(r=new Jt(bn(e)),t=new Pt(t,r))}if(t){if(!$t(V(e.a)))return t;r=t}else t=yn(e,"/"),r=new Vt,n.push(t)}for(;$t(V(e.a));)t=$(e.a),hn(e,"Missing next location step."),t=yn(e,t),n.push(t);return new Wt(r,n)}function yn(e,t){var n,r,i;if("/"!=t&&"//"!=t)throw Error('Step op should be "/" or "//"');if("."==V(e.a))return r=new Qt(un,new It("node")),$(e.a),r;if(".."==V(e.a))return r=new Qt(sn,new It("node")),$(e.a),r;var s;if("@"==V(e.a))s=en,$(e.a),hn(e,"Missing attribute name");else if("::"==V(e.a,1)){if(!/(?![0-9])[\w]/.test(V(e.a).charAt(0)))throw Error("Bad token: "+$(e.a));n=$(e.a),s=Yt[n]||null;if(!s)throw Error("No axis with name: "+n);$(e.a),hn(e,"Missing node name")}else s=tn;n=V(e.a);if(/(?![0-9])[\w]/.test(n.charAt(0)))if("("==V(e.a,1)){if(!qt(n))throw Error("Invalid node type: "+n);n=$(e.a);if(!qt(n))throw Error("Invalid type name: "+n);pn(e,"("),hn(e,"Bad nodetype"),i=V(e.a).charAt(0);var o=null;if('"'==i||"'"==i)o=vn(e);hn(e,"Bad nodetype"),dn(e),n=new It(n,o)}else n=mn(e);else{if("*"!=n)throw Error("Bad token: "+$(e.a));n=mn(e)}return i=new Jt(bn(e),s.a),r||new Qt(s,n,i,"//"==t)}function bn(e){for(var t=[];"["==V(e.a);){$(e.a),hn(e,"Missing predicate expression.");var n=cn(e);t.push(n),hn(e,"Unclosed predicate expression."),pn(e,"]")}return t}function wn(e){if("-"==V(e.a))return $(e.a),new an(wn(e));var t=gn(e);if("|"!=V(e.a))e=t;else{for(t=[t];"|"==$(e.a);)hn(e,"Missing next union location path."),t.push(gn(e));e.a.a--,e=new fn(t)}return e}function En(e,n){if(!e.length)throw Error("Empty XPath expression.");var i=z(e);if(J(i))throw Error("Invalid XPath expression.");n?"function"==r(n)||(n=u(n.lookupNamespaceURI,n)):n=t(null);var s=cn(new ln(i,n));if(!J(i))throw Error("Bad token: "+$(i));this.evaluate=function(e,t){var n=s.a(new l(e));return new Sn(n,t)}}function Sn(e,t){if(0==t)if(e instanceof at)t=4;else if("string"==typeof e)t=2;else if("number"==typeof e)t=1;else{if("boolean"!=typeof e)throw Error("Unexpected evaluation result.");t=3}if(!(2==t||1==t||3==t||e instanceof at))throw Error("value could not be converted to the specified type");this.resultType=t;var n;switch(t){case 2:this.stringValue=e instanceof at?dt(e):""+e;break;case 1:this.numberValue=e instanceof at?+dt(e):+e;break;case 3:this.booleanValue=e instanceof at?0<e.l:!!e;break;case 4:case 5:case 6:case 7:var r=vt(e);n=[];for(var i=gt(r);i;i=gt(r))n.push(i instanceof q?i.a:i);this.snapshotLength=e.l,this.invalidIteratorState=!1;break;case 8:case 9:r=pt(e),this.singleNodeValue=r instanceof q?r.a:r;break;default:throw Error("Unknown XPathResult type.")}var s=0;this.iterateNext=function(){if(4!=t&&5!=t)throw Error("iterateNext called with wrong result type");return s>=n.length?null:n[s++]},this.snapshotItem=function(e){if(6!=t&&7!=t)throw Error("snapshotItem called with wrong result type");return e>=n.length||0>e?null:n[e]}}function xn(e){this.lookupNamespaceURI=yt(e)}function Tn(e){e=e||n;var t=e.document;t.evaluate||(e.XPathResult=Sn,t.evaluate=function(e,t,n,r){return(new En(e,n)).evaluate(t,r)},t.createExpression=function(e,t){return new En(e,t)},t.createNSResolver=function(e){return new xn(e)})}var n=this,c=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},d=Array.prototype,v=d.indexOf?function(e,t,n){return d.indexOf.call(e,t,n)}:function(e,t,n){n=null==n?0:0>n?Math.max(0,e.length+n):n;if(i(e))return i(t)&&1==t.length?e.indexOf(t,n):-1;for(;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},m=d.forEach?function(e,t,n){d.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,s=i(e)?e.split(""):e,o=0;o<r;o++)o in s&&t.call(n,s[o],o,e)},g=d.filter?function(e,t,n){return d.filter.call(e,t,n)}:function(e,t,n){for(var r=e.length,s=[],o=0,u=i(e)?e.split(""):e,a=0;a<r;a++)if(a in u){var f=u[a];t.call(n,f,a,e)&&(s[o++]=f)}return s},y=d.reduce?function(e,t,n,r){return r&&(t=u(t,r)),d.reduce.call(e,t,n)}:function(e,t,n,r){var i=n;return m(e,function(n,s){i=t.call(r,i,n,s,e)}),i},b=d.some?function(e,t,n){return d.some.call(e,t,n)}:function(e,t,n){for(var r=e.length,s=i(e)?e.split(""):e,o=0;o<r;o++)if(o in s&&t.call(n,s[o],o,e))return!0;return!1},x;e:{var T=n.navigator;if(T){var N=T.userAgent;if(N){x=N;break e}}x=""}var C=h(x,"Opera")||h(x,"OPR"),k=h(x,"Trident")||h(x,"MSIE"),L=h(x,"Edge"),A=h(x,"Gecko")&&(!h(x.toLowerCase(),"webkit")||!!h(x,"Edge"))&&!h(x,"Trident")&&!h(x,"MSIE")&&!h(x,"Edge"),O=h(x.toLowerCase(),"webkit")&&!h(x,"Edge"),D=function(){if(C&&n.opera){var e=n.opera.version;return"function"==r(e)?e():e}var e="",t=M();return t&&(e=t?t[1]:""),k&&(t=_(),t>parseFloat(e))?String(t):e}(),P={},B=n.document,j=B&&k?_()||("CSS1Compat"==B.compatMode?parseInt(D,10):5):void 0,F=k&&!(9<=j),I=k&&!(8<=j),W=RegExp("\\$?(?:(?![0-9-])[\\w-]+:)?(?![0-9-])[\\w-]+|\\/\\/|\\.\\.|::|\\d+(?:\\.\\d*)?|\\.\\d+|\"[^\"]*\"|'[^']*'|[!<>]=|\\s+|.","g"),X=/^\s/;!A&&!k||k&&9<=j||A&&H("1.9.1"),k&&H("9"),f(Lt),Lt.prototype.a=function(e){return this.c.m(this.h,this.o,e)},Lt.prototype.toString=function(){var e="Binary Expression: "+this.c,e=e+St(this.h);return e+=St(this.o)},Ot.prototype.toString=e("a");var Mt={};_t("div",6,1,function(e,t,n){return Nt(e,n)/Nt(t,n)}),_t("mod",6,1,function(e,t,n){return Nt(e,n)%Nt(t,n)}),_t("*",6,1,function(e,t,n){return Nt(e,n)*Nt(t,n)}),_t("+",5,1,function(e,t,n){return Nt(e,n)+Nt(t,n)}),_t("-",5,1,function(e,t,n){return Nt(e,n)-Nt(t,n)}),_t("<",4,2,function(e,t,n){return At(function(e,t){return e<t},e,t,n)}),_t(">",4,2,function(e,t,n){return At(function(e,t){return e>t},e,t,n)}),_t("<=",4,2,function(e,t,n){return At(function(e,t){return e<=t},e,t,n)}),_t(">=",4,2,function(e,t,n){return At(function(e,t){return e>=t},e,t,n)});var Dt=_t("=",3,2,function(e,t,n){return At(function(e,t){return e==t},e,t,n,!0)});_t("!=",3,2,function(e,t,n){return At(function(e,t){return e!=t},e,t,n,!0)}),_t("and",2,2,function(e,t,n){return kt(e,n)&&kt(t,n)}),_t("or",1,2,function(e,t,n){return kt(e,n)||kt(t,n)}),f(Pt),Pt.prototype.a=function(e){return e=this.c.a(e),Kt(this.h,e)},Pt.prototype.toString=function(){var e;return e="Filter:"+St(this.c),e+=St(this.h)},f(Ht),Ht.prototype.a=function(e){return this.h.m.apply(null,E(e,this.c))},Ht.prototype.toString=function(){var e="Function: "+this.h;if(this.c.length)var t=y(this.c,function(e,t){return e+St(t)},"Arguments:"),e=e+St(t);return e},Bt.prototype.toString=e("j");var jt={};Ft("boolean",2,!1,!1,function(e,t){return kt(t,e)},1),Ft("ceiling",1,!1,!1,function(e,t){return Math.ceil(Nt(t,e))},1),Ft("concat",3,!1,!1,function(e,t){var n=S(arguments,1);return y(n,function(t,n){return t+Ct(n,e)},"")},2,null),Ft("contains",2,!1,!1,function(e,t,n){return h(Ct(t,e),Ct(n,e))},2),Ft("count",1,!1,!1,function(e,t){return t.a(e).l},1,1,!0),Ft("false",2,!1,!1,t(!1),0),Ft("floor",1,!1,!1,function(e,t){return Math.floor(Nt(t,e))},1),Ft("id",4,!1,!1,function(e,t){function n(e){if(F){var t=i.all[e];if(t){if(t.nodeType&&e==t.id)return t;if(t.length)return w(t,function(t){return e==t.id})}return null}return i.getElementById(e)}var r=e.a,i=9==r.nodeType?r:r.ownerDocument,r=Ct(t,e).split(/\s+/),s=[];m(r,function(e){e=n(e),!e||0<=v(s,e)||s.push(e)}),s.sort(Q);var o=new at;return m(s,function(e){ht(o,e)}),o},1),Ft("lang",2,!1,!1,t(!1),1),Ft("last",1,!0,!1,function(e){if(1!=arguments.length)throw Error("Function last expects ()");return e.f},0),Ft("local-name",3,!1,!0,function(e,t){var n=t?pt(t.a(e)):e.a;return n?n.localName||n.nodeName.toLowerCase():""},0,1,!0),Ft("name",3,!1,!0,function(e,t){var n=t?pt(t.a(e)):e.a;return n?n.nodeName.toLowerCase():""},0,1,!0),Ft("namespace-uri",3,!0,!1,t(""),0,1,!0),Ft("normalize-space",3,!1,!0,function(e,t){return(t?Ct(t,e):Z(e.a)).replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},0,1),Ft("not",2,!1,!1,function(e,t){return!kt(t,e)},1),Ft("number",1,!1,!0,function(e,t){return t?Nt(t,e):+Z(e.a)},0,1),Ft("position",1,!0,!1,function(e){return e.b},0),Ft("round",1,!1,!1,function(e,t){return Math.round(Nt(t,e))},1),Ft("starts-with",2,!1,!1,function(e,t,n){return t=Ct(t,e),e=Ct(n,e),0==t.lastIndexOf(e,0)},2),Ft("string",3,!1,!0,function(e,t){return t?Ct(t,e):Z(e.a)},0,1),Ft("string-length",1,!1,!0,function(e,t){return(t?Ct(t,e):Z(e.a)).length},0,1),Ft("substring",3,!1,!1,function(e,t,n,r){n=Nt(n,e);if(isNaN(n)||Infinity==n||-Infinity==n)return"";r=r?Nt(r,e):Infinity;if(isNaN(r)||-Infinity===r)return"";n=Math.round(n)-1;var i=Math.max(n,0);return e=Ct(t,e),Infinity==r?e.substring(i):(t=Math.round(r),e.substring(i,n+t))},2,3),Ft("substring-after",3,!1,!1,function(e,t,n){return t=Ct(t,e),e=Ct(n,e),n=t.indexOf(e),-1==n?"":t.substring(n+e.length)},2),Ft("substring-before",3,!1,!1,function(e,t,n){return t=Ct(t,e),e=Ct(n,e),e=t.indexOf(e),-1==e?"":t.substring(0,e)},2),Ft("sum",1,!1,!1,function(e,t){for(var n=vt(t.a(e)),r=0,i=gt(n);i;i=gt(n))r+=+Z(i);return r},1,1,!0),Ft("translate",3,!1,!1,function(e,t,n,r){t=Ct(t,e),n=Ct(n,e);var i=Ct(r,e);e=[];for(r=0;r<n.length;r++){var s=n.charAt(r);s in e||(e[s]=i.charAt(r))}n="";for(r=0;r<t.length;r++)s=t.charAt(r),n+=s in e?e[s]:s;return n},3),Ft("true",2,!1,!1,t(!0),0),It.prototype.a=function(e){return null===this.b||this.b==e.nodeType},It.prototype.f=e("h"),It.prototype.toString=function(){var e="Kind Test: "+this.h;return null===this.c||(e+=St(this.c)),e},f(Rt),Rt.prototype.a=e("c"),Rt.prototype.toString=function(){return"Literal: "+this.c},Ut.prototype.a=function(e){var t=e.nodeType;return 1!=t&&2!=t?!1:"*"!=this.j&&this.j!=e.nodeName.toLowerCase()?!1:this.c==(e.namespaceURI?e.namespaceURI.toLowerCase():"http://www.w3.org/1999/xhtml")},Ut.prototype.f=e("j"),Ut.prototype.toString=function(){return"Name Test: "+("http://www.w3.org/1999/xhtml"==this.c?"":this.c+":")+this.j},f(zt),zt.prototype.a=e("c"),zt.prototype.toString=function(){return"Number: "+this.c},f(Wt),f(Xt),Xt.prototype.a=function(e){var t=new at;return e=e.a,9==e.nodeType?ht(t,e):ht(t,e.ownerDocument),t},Xt.prototype.toString=t("Root Helper Expression"),f(Vt),Vt.prototype.a=function(e){var t=new at;return ht(t,e.a),t},Vt.prototype.toString=t("Context Helper Expression"),Wt.prototype.a=function(e){var t=this.h.a(e);if(t instanceof at){e=this.c;for(var n=0,r=e.length;n<r&&t.l;n++){var i=e[n],s=vt(t,i.c.a),o;if(i.g||i.c!=rn)if(i.g||i.c!=on)for(o=gt(s),t=i.a(new l(o));null!=(o=gt(s));)o=i.a(new l(o)),t=lt(t,o);else o=gt(s),t=i.a(new l(o));else{for(o=gt(s);(t=gt(s))&&(!o.contains||o.contains(t))&&t.compareDocumentPosition(o)&8;o=t);t=i.a(new l(o))}}return t}throw Error("Filter expression must evaluate to nodeset.")},Wt.prototype.toString=function(){var e;e="Path Expression:"+St(this.h);if(this.c.length){var t=y(this.c,function(e,t){return e+St(t)},"Steps:");e+=St(t)}return e},Jt.prototype.toString=function(){return y(this.a,function(e,t){return e+St(t)},"Predicates:")},f(Qt),Qt.prototype.a=function(e){var t=e.a,n=null,n=this.f,r=null,i=null,s=0;n&&(r=n.name,i=n.s?Ct(n.s,e):null,s=1);if(this.u)if(this.g||this.c!=tn)if(e=vt((new Qt(nn,new It("node"))).a(e)),t=gt(e))for(n=this.m(t,r,i,s);null!=(t=gt(e));)n=lt(n,this.m(t,r,i,s));else n=new at;else n=tt(this.o,t,r,i),n=Kt(this.h,n,s);else n=this.m(e.a,r,i,s);return n},Qt.prototype.m=function(e,t,n,r){return e=this.c.f(this.o,e,t,n),e=Kt(this.h,e,r)},Qt.prototype.toString=function(){var e;e="Step:"+St("Operator: "+(this.u?"//":"/")),this.c.j&&(e+=St("Axis: "+this.c)),e+=St(this.o);if(this.h.a.length){var t=y(this.h.a,function(e,t){return e+St(t)},"Predicates:");e+=St(t)}return e},Gt.prototype.toString=e("j");var Yt={};Zt("ancestor",function(e,t){for(var n=new at,r=t;r=r.parentNode;)e.a(r)&&ct(n,r);return n},!0),Zt("ancestor-or-self",function(e,t){var n=new at,r=t;do e.a(r)&&ct(n,r);while(r=r.parentNode);return n},!0);var en=Zt("attribute",function(e,t){var n=new at,r=e.f();if("style"==r&&t.style&&F)return ht(n,new q(t.style,t,"style",t.style.cssText)),n;var i=t.attributes;if(i)if(e instanceof It&&null===e.b||"*"==r)for(var r=0,s;s=i[r];r++)F?s.nodeValue&&ht(n,R(t,s)):ht(n,s);else(s=i.getNamedItem(r))&&(F?s.nodeValue&&ht(n,R(t,s)):ht(n,s));return n},!1),tn=Zt("child",function(e,t,n,r,s){return(F?it:st).call(null,e,t,i(n)?n:null,i(r)?r:null,s||new at)},!1,!0);Zt("descendant",tt,!1,!0);var nn=Zt("descendant-or-self",function(e,t,n,r){var i=new at;return et(t,n,r)&&e.a(t)&&ht(i,t),tt(e,t,n,r,i)},!1,!0),rn=Zt("following",function(e,t,n,r){var i=new at;do for(var s=t;s=s.nextSibling;)et(s,n,r)&&e.a(s)&&ht(i,s),i=tt(e,s,n,r,i);while(t=t.parentNode);return i},!1,!0);Zt("following-sibling",function(e,t){for(var n=new at,r=t;r=r.nextSibling;)e.a(r)&&ht(n,r);return n},!1),Zt("namespace",function(){return new at},!1);var sn=Zt("parent",function(e,t){var n=new at;if(9==t.nodeType)return n;if(2==t.nodeType)return ht(n,t.ownerElement),n;var r=t.parentNode;return e.a(r)&&ht(n,r),n},!1),on=Zt("preceding",function(e,t,n,r){var i=new at,s=[];do s.unshift(t);while(t=t.parentNode);for(var o=1,u=s.length;o<u;o++){var a=[];for(t=s[o];t=t.previousSibling;)a.unshift(t);for(var f=0,l=a.length;f<l;f++)t=a[f],et(t,n,r)&&e.a(t)&&ht(i,t),i=tt(e,t,n,r,i)}return i},!0,!0);Zt("preceding-sibling",function(e,t){for(var n=new at,r=t;r=r.previousSibling;)e.a(r)&&ct(n,r);return n},!0);var un=Zt("self",function(e,t){var n=new at;return e.a(t)&&ht(n,t),n},!1);f(an),an.prototype.a=function(e){return-Nt(this.c,e)},an.prototype.toString=function(){return"Unary Expression: -"+St(this.c)},f(fn),fn.prototype.a=function(e){var t=new at;return m(this.c,function(n){n=n.a(e);if(!(n instanceof at))throw Error("Path expression must evaluate to NodeSet.");t=lt(t,n)}),t},fn.prototype.toString=function(){return y(this.c,function(e,t){return e+St(t)},"Union Expression:")},Sn.ANY_TYPE=0,Sn.NUMBER_TYPE=1,Sn.STRING_TYPE=2,Sn.BOOLEAN_TYPE=3,Sn.UNORDERED_NODE_ITERATOR_TYPE=4,Sn.ORDERED_NODE_ITERATOR_TYPE=5,Sn.UNORDERED_NODE_SNAPSHOT_TYPE=6,Sn.ORDERED_NODE_SNAPSHOT_TYPE=7,Sn.ANY_UNORDERED_NODE_TYPE=8,Sn.FIRST_ORDERED_NODE_TYPE=9;var Nn=["wgxpath","install"],Cn=n;Nn[0]in Cn||!Cn.execScript||Cn.execScript("var "+Nn[0]);for(var kn;Nn.length&&(kn=Nn.shift());)Nn.length||void 0===Tn?Cn[kn]?Cn=Cn[kn]:Cn=Cn[kn]={}:Cn[kn]=Tn}(),define("wgx",function(){}),function(e){var t=e(window);e.fn.visible=function(n,r,i,s){if(this.length<1)return;i=i||"both";var o=this.length>1?this.eq(0):this,u=typeof s!="undefined"&&s!==null,a=u?e(s):t,f=u?a.position():0,l=o.get(0),c=a.outerWidth(),h=a.outerHeight(),p=r===!0?l.offsetWidth*l.offsetHeight:!0;if(typeof l.getBoundingClientRect=="function"){var d=l.getBoundingClientRect(),v=u?d.top-f.top>=0&&d.top<h+f.top:d.top>=0&&d.top<h,m=u?d.bottom-f.top>0&&d.bottom<=h+f.top:d.bottom>0&&d.bottom<=h,g=u?d.left-f.left>=0&&d.left<c+f.left:d.left>=0&&d.left<c,y=u?d.right-f.left>0&&d.right<c+f.left:d.right>0&&d.right<=c,b=n?v||m:v&&m,w=n?g||y:g&&y,b=d.top<0&&d.bottom>h?!0:b,w=d.left<0&&d.right>c?!0:w;if(i==="both")return p&&b&&w;if(i==="vertical")return p&&b;if(i==="horizontal")return p&&w}else{var E=u?0:f,S=E+h,x=a.scrollLeft(),T=x+c,N=o.position(),C=N.top,k=C+o.height(),L=N.left,A=L+o.width(),O=n===!0?k:C,M=n===!0?C:k,_=n===!0?A:L,D=n===!0?L:A;if(i==="both")return!!p&&M<=S&&O>=E&&D<=T&&_>=x;if(i==="vertical")return!!p&&M<=S&&O>=E;if(i==="horizontal")return!!p&&D<=T&&_>=x}}}(jQuery),define("jqueryVisible",function(){}),require.config({urlArgs:"v="+(new Date).getTime(),paths:{jquery:"utils/jquery-fake",underscore:"../../../bower_components/underscore/underscore",underscoreprivate:"utils/underscore-private",jqueryUI:"utils/empty/emptyjqueryUI",backbone:"../../../bower_components/backbone/backbone",text:"../../../bower_components/requirejs-text/text",domReady:"../../../bower_components/domReady/domReady",cookie:"../../../bower_components/js-cookie/src/js.cookie",mobiledetect:"../../../bower_components/mobile-detect/mobile-detect",webfontloader:"../../../bower_components/webfontloader/webfontloader",uri:"../../../bower_components/jsUri/Uri",fabric:"utils/fabric",tocca:"../../../bower_components/Tocca.js/Tocca.min",wgx:"../lib/wgxpath.install",jqueryVisible:"utils/jquery.visible",empty:"utils/empty"},map:{"*":{underscore:"underscoreprivate"},underscoreprivate:{underscore:"underscore"}},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"}}}),require(["Setup","AppInstance","domReady","wgx","jqueryVisible"],function(e,t){window.wgxpath&&window.wgxpath.install(),e(function(e){t.start({initialData:e})})}),define("index-light",function(){});try{w.define=w.glzOldDefine,delete w.glzOldDefine}catch(er){}})(window);